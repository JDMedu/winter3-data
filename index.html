<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëª¨í´ ì„±ì  ì¡°íšŒ ì‹œìŠ¤í…œ (AI ë¶„ì„ í¬í•¨) - ê³ 3</title>
    <!-- Google tag (gtag.js) --> 
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-KSGCB6G9HJ"></script> 
    <script> 
    window.dataLayer = window.dataLayer || []; 
    function gtag(){dataLayer.push(arguments);} 
    gtag('js', new Date()); 
    gtag('config', 'G-KSGCB6G9HJ'); 
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 40px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #666;
            font-size: 1.1em;
        }
        
        .tab-container {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 2px solid #eee;
        }
        
        .tab {
            padding: 15px 30px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 1.1em;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* AI ë¶„ì„ ê´€ë ¨ ìŠ¤íƒ€ì¼ */
        .ai-analysis {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 15px;
            margin: 15px 0;
            position: relative;
            overflow: hidden;
        }
        
        .ai-analysis::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="30" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="40" cy="70" r="1.5" fill="rgba(255,255,255,0.1)"/><circle cx="90" cy="80" r="2" fill="rgba(255,255,255,0.1)"/></svg>');
            pointer-events: none;
        }
        
        .ai-analysis-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }
        
        .ai-icon {
            width: 35px;
            height: 35px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            backdrop-filter: blur(10px);
        }
        
        .ai-analysis h3 {
            font-size: 1.5em;
            margin: 0;
        }
        
        .ai-content {
            position: relative;
            z-index: 1;
        }
        
        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .analysis-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .analysis-card h4 {
            font-size: 1.2em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .trend-up { color: #4ade80; }
        .trend-down { color: #f87171; }
        .trend-stable { color: #fbbf24; }
        
        .progress-bar-container {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            height: 8px;
            margin: 8px 0;
            overflow: hidden;
        }
        
        .progress-bar-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.3s ease;
        }
        
        .grade-excellent { background: #ef4444; }
        .grade-good { background: #f97316; }
        .grade-average { background: #eab308; }
        .grade-needs-improvement { background: #06b6d4; }
        .grade-poor { background: #8b5cf6; }
        
        .ai-loading {
            display: flex;
            align-items: center;
            gap: 10px;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .loading-dots {
            display: flex;
            gap: 4px;
        }
        
        .loading-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.6);
            animation: pulse 1.4s infinite ease-in-out;
        }
        
        .loading-dot:nth-child(1) { animation-delay: -0.32s; }
        .loading-dot:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes pulse {
            0%, 80%, 100% { transform: scale(0); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }
        
        .ai-recommendations {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid #10b981;
        }
        
        .ai-recommendations h4 {
            margin-bottom: 15px;
            color: #10b981;
        }
        
        .recommendation-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 12px;
            margin: 8px 0;
            border-left: 3px solid rgba(255, 255, 255, 0.5);
        }
        
        .recommendation-priority {
            font-size: 0.85em;
            opacity: 0.8;
            margin-bottom: 5px;
        }
        
        /* ìƒˆë¡œìš´ êµ¬ì²´ì  ë“±ê¸‰ ìƒìŠ¹ ì „ëµ ìŠ¤íƒ€ì¼ */
        .grade-strategy {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid #4ade80;
        }
        
        .grade-strategy h4 {
    margin-bottom: 15px;
    color: #4ade80;
    font-size: 1.3em;
}
        
        .recent-tests-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin: 15px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
        }
        
        .recent-test-item {
            text-align: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
        }
        
        .recent-test-name {
            font-size: 0.85em;
            opacity: 0.8;
            margin-bottom: 5px;
        }
        
        .recent-test-grade {
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 3px;
        }
        
        .recent-test-score {
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        .target-analysis {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .target-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .target-grade {
            font-size: 1.2em;
            font-weight: bold;
        }
        
        .target-possibility {
            font-size: 0.85em;
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: bold;
        }
        
        .possibility-high { background: #10b981; color: white; }
        .possibility-medium { background: #f59e0b; color: white; }
        .possibility-low { background: #ef4444; color: white; }
        
        .subject-strategy-list {
            margin: 15px 0;
        }
        
        .subject-strategy-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            padding: 12px;
            margin: 8px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .subject-strategy-left {
            flex: 1;
        }
        
        .subject-strategy-right {
            text-align: right;
        }
        
        .subject-name {
            font-weight: bold;
            margin-bottom: 3px;
        }
        
        .subject-detail {
            font-size: 0.85em;
            opacity: 0.8;
        }
        
        .points-gain {
            font-size: 1.1em;
            font-weight: bold;
            color: #4ade80;
        }
        
        .total-strategy {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .total-points {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.1em;
            font-weight: bold;
        }
        
        /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ë“¤ ìœ ì§€... */
        .admin-check {
            background: #fff3cd;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 4px solid #ffc107;
        }
        
        .admin-check h3 {
            color: #856404;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        .admin-check p {
            color: #856404;
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .admin-password {
            width: 100%;
            padding: 12px;
            border: 2px solid #ffc107;
            border-radius: 8px;
            font-size: 1em;
            margin: 10px 0;
        }
        
        .admin-btn {
            background: #ffc107;
            color: #856404;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            margin: 5px;
        }
        
        .admin-btn:hover {
            background: #e0a800;
        }
        
        .setup-section {
            background: #e8f2ff;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 4px solid #667eea;
            display: none;
        }
        
        .setup-section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        .setup-section p {
            color: #666;
            line-height: 1.6;
            margin-bottom: 10px;
        }
        
        .setup-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 1em;
            margin: 10px 0;
        }
        
        .setup-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            margin: 5px;
        }
        
        .upload-area {
            border: 3px dashed #ccc;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            margin: 20px 0;
            background: #f9f9f9;
            transition: all 0.3s;
        }
        
        .upload-area.dragover {
            border-color: #667eea;
            background: #e8f2ff;
        }
        
        .upload-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            margin: 5px;
        }
        
        .upload-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .progress {
            margin: 20px 0;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            display: none;
        }
        
        .progress-bar {
            height: 25px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s;
            text-align: center;
            line-height: 25px;
            color: white;
            font-weight: bold;
        }
        
        .status {
            margin: 20px 0;
            padding: 15px;
            border-radius: 8px;
            display: none;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .data-summary {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            display: none;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .summary-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .summary-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
        }
        
        .summary-label {
            color: #666;
            margin-top: 5px;
        }
        
        .search-section {
            margin-bottom: 30px;
        }
        
        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .search-input {
            flex: 1;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1.1em;
            transition: border-color 0.3s;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .search-btn {
            padding: 15px 30px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em;
        }
        
        .search-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .instructions {
            background: #e8f2ff;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 4px solid #667eea;
        }
        
        .instructions h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        .instructions p {
            color: #666;
            line-height: 1.6;
            margin-bottom: 10px;
        }
        
        .student-info {
            background: #e8f2ff;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            border-left: 5px solid #667eea;
        }
        
        .student-info h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.6em;
        }
        
        .summary-table {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border-left: 5px solid #667eea;
            overflow-x: auto;
        }
        
        .summary-table h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.4em;
        }
        
        .grade-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9em;
        }
        
        .grade-table th {
            background: #f8f9fa;
            color: #333;
            font-weight: bold;
            padding: 12px 8px;
            text-align: center;
            border: 1px solid #dee2e6;
        }
        
        .grade-table td {
            padding: 10px 8px;
            text-align: center;
            border: 1px solid #dee2e6;
        }
        
        .grade-table tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .test-name {
            font-weight: bold;
            color: #667eea;
            text-align: left !important;
            min-width: 80px;
        }
        
        .grade-cell {
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .score-cell {
            font-weight: bold;
            color: #333;
        }
        
        .absent-cell {
            color: #999;
            font-style: italic;
        }
        
        .source-cell {
            font-size: 0.8em;
            color: #666;
        }
        
        .grade-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 25px;
        }
        
        .grade-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border-left: 5px solid #667eea;
        }
        
        .grade-card h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.4em;
        }
        
        .grade-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .grade-summary-item {
            text-align: center;
        }
        
        .grade-summary-value {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .grade-summary-label {
            font-size: 0.9em;
            color: #666;
        }
        
        .grade-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 10px;
        }
        
        .grade-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 3px solid #667eea;
        }
        
        .grade-label {
            color: #555;
            font-weight: 500;
            font-size: 0.9em;
        }
        
        .grade-value {
            font-weight: bold;
            color: #333;
        }
        
        .grade-1 { color: #e74c3c; }
        .grade-2 { color: #f39c12; }
        .grade-3 { color: #f1c40f; }
        .grade-4 { color: #2ecc71; }
        .grade-5 { color: #3498db; }
        .grade-6 { color: #9b59b6; }
        
        .no-results, .no-data {
            text-align: center;
            color: #666;
            font-size: 1.2em;
            margin-top: 40px;
            padding: 40px;
            background: #f8f9fa;
            border-radius: 15px;
        }

        /* ê³ 3 ì „ìš© ì„ íƒê³¼ëª© í‘œì‹œ ìŠ¤íƒ€ì¼ */
        .subject-type {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
            margin-left: 8px;
        }
        
        .subject-type.í™”ë²•ê³¼ì‘ë¬¸, .subject-type.í™”ë²•ê³¼_ì‘ë¬¸ {
                background: #10b981;
                color: white;
            }
            
            .subject-type.ì–¸ì–´ì™€ë§¤ì²´, .subject-type.ì–¸ì–´ì™€_ë§¤ì²´ {
                background: #3b82f6;
                color: white;
            }
        
        @media (max-width: 768px) {
            /* ë·°í¬íŠ¸ ë‹¨ìœ„ë¡œ ì „ì²´ í¬ê¸° ìë™ ì¡°ì • */
            .container {
                padding: 4vw; /* í™”ë©´ ë„ˆë¹„ì˜ 4% */
                font-size: 3.5vw; /* ê¸°ë³¸ í°íŠ¸ë¥¼ í™”ë©´ ë„ˆë¹„ì˜ 3.5%ë¡œ */
            }
            
            /* ì œëª©ë“¤ ë·°í¬íŠ¸ ë‹¨ìœ„ ì ìš© */
            .header h1 {
                font-size: 7vw; /* í™”ë©´ ë„ˆë¹„ì˜ 7% */
            }
            
            .header p {
                font-size: 4vw; /* í™”ë©´ ë„ˆë¹„ì˜ 4% */
            }
            
            /* íƒ­ ë²„íŠ¼ í¬ê¸° ì¡°ì • */
            .tab {
                font-size: 3.5vw;
                padding: 3vw 5vw;
            }
            
            /* ê²€ìƒ‰ ì…ë ¥ì°½ê³¼ ë²„íŠ¼ */
            .search-input {
                font-size: 4vw;
                padding: 3vw;
            }
            
            .search-btn {
                font-size: 3.5vw;
                padding: 3vw 5vw;
            }
            
            /* AI ë¶„ì„ ì„¹ì…˜ */
            .ai-analysis h3 {
                font-size: 4.5vw;
            }
            
            .ai-analysis h4 {
                font-size: 3.5vw;
            }
            
            /* í…Œì´ë¸” */
            .grade-table {
                font-size: 2.8vw;
            }
            
            /* í…Œì´ë¸” ì»¨í…Œì´ë„ˆ ì˜¤ë²„í”Œë¡œìš° í•´ê²° */
            .summary-table {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch; /* iOS ë¶€ë“œëŸ¬ìš´ ìŠ¤í¬ë¡¤ */
            }
            
            .grade-table {
                min-width: 100%;
                white-space: nowrap; /* í…ìŠ¤íŠ¸ ì¤„ë°”ê¿ˆ ë°©ì§€ */
            }
            
            .grade-table th,
            .grade-table td {
                min-width: 60px; /* ìµœì†Œ ë„ˆë¹„ ì„¤ì • */
                padding: 2vw 1vw; /* íŒ¨ë”©ì„ ë·°í¬íŠ¸ ë‹¨ìœ„ë¡œ */
                font-size: 2.5vw; /* ì¡°ê¸ˆ ë” ì‘ê²Œ */
            }
            
            .test-name {
                min-width: 80px !important; /* ì‹œí—˜ëª… ì¹¸ì€ ì¡°ê¸ˆ ë” ë„“ê²Œ */
            }
            
            /* ê¸°ì¡´ ë ˆì´ì•„ì›ƒ ì¡°ì •ë“¤ */
            .search-box {
                flex-direction: column;
            }
            
            .grade-cards {
                grid-template-columns: 1fr;
            }
            
            .tab-container {
                flex-direction: column;
            }
            
            .analysis-grid {
                grid-template-columns: 1fr;
            }
            
            .recent-tests-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            /* ê³¼ëª©ë³„ ì„±ì·¨ë„ í…Œì´ë¸” ê°œì„  */
            .summary-table div[style*="overflow-x: auto"] {
                padding-bottom: 10px; /* ìŠ¤í¬ë¡¤ë°” ì—¬ë°± */
            }
            
            .summary-table table[style*="min-width: 1200px"] {
                min-width: 800px !important; /* ëª¨ë°”ì¼ì—ì„œëŠ” 800pxë¡œ ì¶•ì†Œ */
            }
            
            /* ëŒ€ì‹œë³´ë“œ ëª¨ë°”ì¼ ìµœì í™” */
            .dashboard-grid {
                grid-template-columns: 1fr !important; /* í•œ ì—´ë¡œ ë³€ê²½ */
                gap: 15px;
            }
            
            .dashboard-card {
                padding: 15px; /* íŒ¨ë”© ì¶•ì†Œ */
                font-size: 3.2vw; /* ë·°í¬íŠ¸ ë‹¨ìœ„ ì ìš© */
            }
            
            .dashboard-card h3 {
                font-size: 4vw;
                margin-bottom: 12px;
            }
            
            .stat-item {
                padding: 2vw 0;
                font-size: 3vw;
            }
            
            .stat-label {
                font-size: 3vw;
            }
            
            .stat-value {
                font-size: 3.2vw;
            }
            
            /* D-day ì¹´ìš´í„° ëª¨ë°”ì¼ ìµœì í™” */
            .dday-counter {
                padding: 15px;
                margin: 15px 0;
            }
            
            .dday-number {
                font-size: 2.5em; /* 3emì—ì„œ ì¶•ì†Œ */
            }
            
            .dday-text {
                font-size: 4vw;
            }
            
            /* ë±ƒì§€ ì»¨í…Œì´ë„ˆ ëª¨ë°”ì¼ ìµœì í™” */
            .badge-container {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); /* 140pxì—ì„œ 120pxë¡œ ì¶•ì†Œ */
                gap: 6px;
            }
            
            .achievement-badge {
                padding: 6px 8px; /* 8px 10pxì—ì„œ ì¶•ì†Œ */
                font-size: 2.8vw; /* 0.85emì—ì„œ ë·°í¬íŠ¸ ë‹¨ìœ„ë¡œ */
                min-height: 32px; /* 36pxì—ì„œ ì¶•ì†Œ */
            }
            
            .badge-summary {
                font-size: 3vw;
                padding: 8px;
                margin: 12px 0;
            }
            
            /* ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ ëª¨ë°”ì¼ ìµœì í™” */
            .chart-container {
                height: 250px; /* 300pxì—ì„œ ì¶•ì†Œ */
                margin: 15px 0;
            }
        }

        /* ì¶”ê°€ ê¸°ëŠ¥ ìŠ¤íƒ€ì¼ */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .dashboard-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border-left: 5px solid #667eea;
        }
        
        .dashboard-card h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.95em;
        }
        
        .stat-value {
            font-weight: bold;
            color: #333;
            font-size: 1.1em;
        }
        
        .stat-positive { color: #10b981; }
        .stat-negative { color: #ef4444; }
        .stat-neutral { color: #6b7280; }
        
        .dday-counter {
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .dday-number {
            font-size: 3em;
            font-weight: bold;
            margin: 10px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .dday-text {
            font-size: 1.2em;
            margin-bottom: 5px;
        }
        
        .badge-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 8px;
            margin: 15px 0;
        }
        
        .achievement-badge {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 8px 10px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            text-align: center;
            min-height: 36px;
            color: white;
        }
        
        /* ë±ƒì§€ íƒ€ì…ë³„ ìƒ‰ìƒ */
        .achievement-badge.grade { background: linear-gradient(45deg, #ffd700, #ff8c00); }
        .achievement-badge.score { background: linear-gradient(45deg, #667eea, #764ba2); }
        .achievement-badge.trend { background: linear-gradient(45deg, #ff6b6b, #feca57); }
        .achievement-badge.improvement { background: linear-gradient(45deg, #10b981, #059669); }
        .achievement-badge.attendance { background: linear-gradient(45deg, #8b5cf6, #7c3aed); }
        .achievement-badge.special { background: linear-gradient(45deg, #f59e0b, #d97706); }
        .achievement-badge.stability { background: linear-gradient(45deg, #06b6d4, #0891b2); }
        .achievement-badge.rank { background: linear-gradient(45deg, #ef4444, #dc2626); }
        .achievement-badge.recovery { background: linear-gradient(45deg, #84cc16, #65a30d); }
        .achievement-badge.start { background: linear-gradient(45deg, #ec4899, #db2777); }
        .achievement-badge.milestone { background: linear-gradient(45deg, #f97316, #ea580c); }
        
        .badge-new {
            animation: pulse-badge 2s infinite;
        }

/* ğŸ†• ê³ ê¸‰ í•™ìŠµ ê³„íšì„œ ìŠ¤íƒ€ì¼ */
.plan-target-setting {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 25px;
    margin-bottom: 20px;
    backdrop-filter: blur(10px);
}

.target-input-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-top: 15px;
}

.target-input-item {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    padding: 15px;
}

.target-input-item label {
    display: block;
    color: rgba(255, 255, 255, 0.8);
    margin-bottom: 8px;
    font-weight: 600;
    font-size: 0.9em;
}

.target-input-item input,
.target-input-item select {
    width: 100%;
    padding: 10px;
    border: none;
    border-radius: 6px;
    background: rgba(255, 255, 255, 0.9);
    font-size: 0.95em;
}

.generate-plan-btn {
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
    color: white;
    border: none;
    padding: 15px 35px;
    border-radius: 30px;
    font-size: 1.1em;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
}

.generate-plan-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
}

/* ê³ ê¸‰ ê³„íšì„œ ê²°ê³¼ ìŠ¤íƒ€ì¼ */
.advanced-study-plan {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 15px;
    padding: 30px;
    margin-top: 25px;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.plan-document-header {
    text-align: center;
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 2px solid rgba(255, 255, 255, 0.3);
}

.plan-document-header h3 {
    font-size: 1.4em;
    margin-bottom: 10px;
    color: rgba(255, 255, 255, 0.95);
}

.student-info-banner {
    background: rgba(255, 255, 255, 0.15);
    border-radius: 10px;
    padding: 15px;
    margin: 15px 0;
}

.status-dashboard {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 30px;
}

.status-card {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 20px;
    border-left: 4px solid;
}

.current-status-card {
    border-left-color: #dc3545;
}

.target-status-card {
    border-left-color: #28a745;
}

.status-card h4 {
    margin-bottom: 15px;
    color: rgba(255, 255, 255, 0.9);
    display: flex;
    align-items: center;
    gap: 8px;
}

.status-metrics {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
    gap: 10px;
}

.metric-item {
    text-align: center;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    padding: 12px 8px;
}

.metric-value {
    font-size: 1.3em;
    font-weight: bold;
    color: rgba(255, 255, 255, 0.95);
    margin-bottom: 5px;
}

.metric-label {
    font-size: 0.8em;
    color: rgba(255, 255, 255, 0.7);
}

.improvement-analysis {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 25px;
    margin-bottom: 25px;
}

/* ëŒ€ì‹œë³´ë“œ ëª¨ë°”ì¼ ìµœì í™” */
@media (max-width: 768px) {
    .dashboard-grid {
        grid-template-columns: 1fr !important;
        gap: 15px;
        width: 100%;
        overflow-x: hidden;
    }

    .dashboard-card {
        width: 100%;
        min-width: 0;
        overflow-x: hidden;
    }

    .badge-container {
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)) !important;
        gap: 6px;
    }

    .achievement-badge {
        font-size: 2.5vw !important;
        padding: 6px 8px;
        min-width: 0;
        word-break: break-word;
    }
}

.improvement-analysis h4 {
    margin-bottom: 15px;
    color: rgba(255,255,255,0.95);
    font-size: 1.2em;
}
            
.weak-subject-card {
    background: rgba(255, 255, 255, 0.08);
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 15px;
    border-left: 4px solid;
}

.weak-subject-card.priority-high {
    border-left-color: rgba(220, 53, 69, 0.8);
}

.weak-subject-card.priority-medium {
    border-left-color: rgba(255, 193, 7, 0.8);
}

.weak-subject-card.priority-low {
    border-left-color: rgba(23, 162, 184, 0.8);
}

.subject-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.subject-name {
    font-size: 1.0em;
    font-weight: bold;
    color: rgba(255, 255, 255, 0.95);
}

.priority-badge {
    padding: 6px 12px;
    border-radius: 15px;
    font-size: 0.8em;
    font-weight: bold;
    color: white;
}

.priority-high { 
    background: rgba(220, 53, 69, 0.8);
    color: white; 
}
.priority-medium { 
    background: rgba(255, 193, 7, 0.9);
    color: #333; 
}
.priority-low { 
    background: rgba(23, 162, 184, 0.8);
    color: white; 
}

.subject-details {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 12px;
    margin-bottom: 15px;
}

.detail-metric {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 6px;
    padding: 10px;
    text-align: center;
}

.detail-value {
    font-size: 1.1em;
    font-weight: bold;
    color: rgba(255, 255, 255, 0.9);
    margin-bottom: 3px;
}

.detail-label {
    font-size: 0.8em;
    color: rgba(255, 255, 255, 0.7);
}

.study-materials {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    padding: 15px;
    margin-top: 15px;
}

.material-links {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 10px;
}

.material-link {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    text-decoration: none;
    padding: 8px 15px;
    border-radius: 20px;
    font-size: 0.9em;
    font-weight: 600;
    transition: all 0.3s ease;
}

.material-link:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    text-decoration: none;
    color: white;
}

.weekly-schedule-advanced {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 25px;
    margin-bottom: 25px;
}

.schedule-week-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 12px;
    margin-top: 20px;
}

.schedule-day {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    padding: 15px 10px;
    text-align: center;
    min-height: 120px;
}

.day-name {
    font-weight: bold;
    color: rgba(255, 255, 255, 0.9);
    margin-bottom: 10px;
    padding-bottom: 8px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.2);
}

.study-session {
    background: rgba(255, 255, 255, 0.15);
    border-radius: 6px;
    padding: 8px;
    margin-bottom: 6px;
    font-size: 0.8em;
    line-height: 1.2;
}

.session-subject {
    font-weight: bold;
    margin-bottom: 2px;
}

.session-time {
    opacity: 0.8;
}

.motivation-banner {
    background: linear-gradient(135deg, #ffd700 0%, #ff8c00 100%);
    color: #333;
    border-radius: 12px;
    padding: 25px;
    text-align: center;
    margin-bottom: 25px;
    box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
}

.motivation-banner h4 {
    font-size: 1.4em;
    margin-bottom: 15px;
    color: #333;
}

.motivation-text {
    font-size: 1.1em;
    line-height: 1.6;
    font-weight: 500;
}

.plan-actions {
    display: flex;
    gap: 15px;
    justify-content: center;
    margin-top: 30px;
}

.action-button {
    padding: 12px 25px;
    border: none;
    border-radius: 25px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 1em;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.pdf-download-btn {
    background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
    color: white;
}

.pdf-download-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(220, 53, 69, 0.4);
}

.edit-plan-btn {
    background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
    color: white;
}

.edit-plan-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(108, 117, 125, 0.4);
}
        
        @keyframes pulse-badge {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .badge-summary {
            text-align: center;
            margin: 15px 0;
            padding: 10px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 8px;
            color: #667eea;
            font-weight: bold;
        }

/* ğŸ†• í•™ìŠµ ê³„íšì„œ ëª¨ë°”ì¼ ìµœì í™” ì¶”ê°€ */
@media (max-width: 768px) {
    .target-input-grid {
        grid-template-columns: 1fr !important;
        gap: 10px;
    }
    .target-input-item {
        padding: 10px;
    }
    .target-input-item label {
        font-size: 3.2vw;
    }
    .target-input-item input,
    .target-input-item select {
        font-size: 3.5vw;
        padding: 8px;
    }
    .generate-plan-btn {
        font-size: 3.8vw;
        padding: 12px 25px;
    }
    .status-dashboard {
        grid-template-columns: 1fr !important;
    }
    .status-metrics {
        grid-template-columns: repeat(2, 1fr) !important;
    }
    .subject-details {
        grid-template-columns: repeat(2, 1fr) !important;
    }
    .schedule-week-grid {
        grid-template-columns: 1fr !important;
    }
    .material-links {
        flex-direction: column;
    }
    .material-link {
        font-size: 3vw;
        padding: 10px 15px;
    }
    .plan-actions {
        flex-direction: column;
        gap: 10px;
    }
    .action-button {
        font-size: 3.5vw;
        padding: 12px 20px;
    }
    .weak-subject-card {
        margin-bottom: 20px;
    }
    .subject-name {
        font-size: 3.8vw;
    }
    .priority-badge {
        font-size: 2.8vw;
        padding: 4px 8px;
    }
    .motivation-banner h4 {
        font-size: 4vw;
    }
    .motivation-text {
        font-size: 3.2vw;
    }
}
        
/* í•™ìŠµ ê³„íšì„œ ëª¨ë°”ì¼ ìµœì í™” */
@media (max-width: 768px) {
    .advanced-study-plan {
        padding: 12px !important;
        margin: 12px 0 !important;
        font-size: 3vw;
        overflow-x: hidden;
    }

    .plan-document-header h3 {
        font-size: 4.2vw !important;
        line-height: 1.3;
    }

    .student-info-banner {
        padding: 8px !important;
        font-size: 2.8vw;
    }

    .improvement-analysis h4 {
        font-size: 3.8vw !important;
        margin-bottom: 8px !important;
    }
}
        
.improvement-analysis {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 25px;
    margin-bottom: 25px;
}

.improvement-analysis h4 {
    margin-bottom: 15px;
    color: rgba(255,255,255,0.95);
    font-size: 1.2em;
}

/* PCìš© ë§ì¶¤í˜• í•™ìŠµ ê³„íšì„œ í¬ê¸° ê³ ì • */
.advanced-study-plan {
    font-size: 14px !important;
}

.plan-document-header h3 {
    font-size: 1.4em !important;
}

.subject-name {
    font-size: 1.0em !important;
}

.motivation-banner h4 {
    font-size: 1.3em !important;
}

.motivation-text {
    font-size: 1.0em !important;
}

.grade-strategy h4 {
    font-size: 1.1em !important;
}
        
.chart-container {
    position: relative;
    height: 300px;
    margin: 20px 0;
}
        
        .progress-ring {
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            width: 120px;
            height: 120px;
            margin: 0 auto;
        }
        
        .progress-ring svg {
            transform: rotate(-90deg);
        }
        
        .progress-ring-text {
            position: absolute;
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
        }
        
        /* ê·¸ëœë“œ ë§ˆìŠ¤í„° ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes grand-master-glow {
            0% { 
                box-shadow: 0 8px 25px rgba(255, 215, 0, 0.3);
                transform: scale(1);
            }
            100% { 
                box-shadow: 0 12px 35px rgba(255, 215, 0, 0.6);
                transform: scale(1.02);
            }
        }
        
        /* ê·¸ëœë“œ ë§ˆìŠ¤í„° ì „ìš© ìŠ¤íƒ€ì¼ */
        .grand-master-message {
            background: linear-gradient(135deg, #ffd700, #ff8c00);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            text-align: center;
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.3);
            animation: grand-master-glow 2s infinite alternate;
        }

        /* ğŸš€ ì—¬ê¸°ë¶€í„° ìƒˆë¡œìš´ CSS ì¶”ê°€! */
/* ìƒˆë¡œìš´ ë±ƒì§€ ìŠ¤íƒ€ì¼ */
.achievement-badge.single-jump { 
    background: linear-gradient(45deg, #16a085, #2ecc71); 
}
.achievement-badge.total-growth { 
    background: linear-gradient(45deg, #27ae60, #2ecc71); 
}
.achievement-badge.subject-master { 
    background: linear-gradient(45deg, #9b59b6, #8e44ad); 
}

/* ë±ƒì§€ ì„¤ëª… íˆ´íŒ ìŠ¤íƒ€ì¼ */
.badge-tooltip {
    position: fixed;                    /* absolute â†’ fixed ë³€ê²½ */
    background: rgba(0, 0, 0, 0.95);   /* 0.9 â†’ 0.95 ë³€ê²½ (ë” ì§„í•˜ê²Œ) */
    color: white;
    padding: 12px 16px;
    border-radius: 8px;
    font-size: 0.85em;
    max-width: 250px;
    z-index: 99999;                    /* 1000 â†’ 99999 ë³€ê²½ */
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    pointer-events: none;
    opacity: 0;
    transform: translateY(10px);
    transition: all 0.3s ease;
    line-height: 1.4;
}

.badge-tooltip.visible {
    opacity: 1;
    transform: translateY(0);
}

.badge-tooltip::after {
    content: '';
    position: absolute;
    top: -6px;
    left: 50%;
    transform: translateX(-50%);
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-bottom: 6px solid rgba(0, 0, 0, 0.9);
}

.achievement-badge {
    position: relative;
    cursor: pointer;
    transition: all 0.2s ease;
}

.achievement-badge:hover {
    transform: scale(1.05);
    z-index: 10;
}

/* ëª¨ë°”ì¼ì—ì„œ í´ë¦­ í”¼ë“œë°± */
.achievement-badge:active {
    transform: scale(0.95);
}

@media (max-width: 768px) {
    .badge-tooltip {
        position: fixed;
        bottom: 20px;
        left: 20px;
        right: 20px;
        max-width: none;
        text-align: center;
    }
    
    .badge-tooltip::after {
        display: none;
    }
}

.badge-new {
    animation: pulse-badge 2s infinite;
}

@keyframes pulse-badge {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}
        
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š ëª¨í´ ì„±ì  ì¡°íšŒ ì‹œìŠ¤í…œ</h1>
            <p>ì •ë™ë¯¼êµ­ì–´ë…¼ìˆ í•™ì› â€¢ ê³ 3 ëª¨ì˜ê³ ì‚¬ ì„±ì  ì¡°íšŒ â€¢ AI ë¶„ì„ í¬í•¨</p>
        </div>
        
        <div class="tab-container">
            <button class="tab active" onclick="switchTab('student')">ğŸ” ì„±ì  ì¡°íšŒ</button>
            <button class="tab" onclick="switchTab('admin')">âš™ï¸ ê´€ë¦¬ì</button>
        </div>
        
        <!-- í•™ìƒ ì¡°íšŒ íƒ­ -->
        <div id="studentTab" class="tab-content active">
            <div class="instructions">
                <h3>ğŸ“‹ ì„±ì  ì¡°íšŒ ë°©ë²• (ê³ 3)</h3>
                <p>â€¢ <strong>ì¶œê²°ë²ˆí˜¸ë¡œ ê²€ìƒ‰:</strong> ë³¸ì¸ì˜ 4ìë¦¬ ì¶œê²°ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”</p>
                <p>â€¢ ì˜ˆì‹œ: 2274, 1234, 0338 ë“±</p>
                <p>â€¢ <strong>ğŸ§  ë¶„ì„:</strong> ì„±ì  ì¡°íšŒ ì‹œ ìë™ìœ¼ë¡œ ê°œì¸ë³„ ë§ì¶¤ ë¶„ì„ì„ ì œê³µí•©ë‹ˆë‹¤</p>
                <p>â€¢ <strong>ğŸ“ ì„ íƒê³¼ëª©:</strong> í™”ë²•ê³¼ ì‘ë¬¸ / ì–¸ì–´ì™€ ë§¤ì²´ë³„ ë“±ê¸‰ì»·ì´ ë‹¤ë¥´ê²Œ ì ìš©ë©ë‹ˆë‹¤</p>
                <div id="urlInfo" style="margin-top: 15px; padding: 10px; background: #e8f5e9; border-radius: 8px; border-left: 4px solid #4caf50; display: none;">
                    <strong>ğŸ’¡ ë” ì‰¬ìš´ ì ‘ì† ë°©ë²•:</strong><br>
                    ë‹¤ìŒ URLì„ ë¶ë§ˆí¬í•˜ë©´ ì–´ë–¤ ê¸°ê¸°ì—ì„œë“  ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:<br>
                    <code id="shareableUrl" style="background: white; padding: 5px; border-radius: 4px; font-size: 0.9em;"></code>
                </div>
            </div>
            
            <div class="search-section">
                <div class="search-box">
                    <input type="text" id="searchInput" class="search-input" placeholder="ì¶œê²°ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 2274)" maxlength="4">
                    <button onclick="searchStudent()" class="search-btn" id="searchBtn">ğŸ” ì¡°íšŒ</button>
                </div>
            </div>
            
            <div id="noData" class="no-data">
                <h3>ğŸ“‹ ë°ì´í„° ìƒíƒœ</h3>
                <p id="dataStatusMessage">ì˜¨ë¼ì¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>
            
            <div id="results" style="display: none;">
                <div id="studentInfo"></div>
                
                <!-- ë¶„ì„ ì„¹ì…˜ -->
                <div id="aiAnalysis" class="ai-analysis" style="display: none;">
                    <div class="ai-analysis-header">
                        <div class="ai-icon">ğŸ§ </div>
                        <div>
                            <h3>í•™ìŠµ ë¶„ì„ ë³´ê³ ì„œ (ê³ 3)</h3>
                            <p style="opacity: 0.9; margin: 0;">ê°œì¸ë³„ ë§ì¶¤ ì„±ì  ë¶„ì„ ë° í•™ìŠµ ì „ëµ ì œì•ˆ</p>
                        </div>
                    </div>
                    
                    <div id="aiContent" class="ai-content">
                        <div class="ai-loading">
                            <span>ğŸ§  ê³ 3 ì„±ì ì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤</span>
                            <div class="loading-dots">
                                <div class="loading-dot"></div>
                                <div class="loading-dot"></div>
                                <div class="loading-dot"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ğŸ†• ìƒˆë¡œìš´ ê°„ì†Œí™”ëœ í•™ìŠµ ê³„íšì„œ ì„¹ì…˜ -->
<div id="studyPlanSection" class="ai-analysis" style="display: none; margin-top: 20px;">
    <div class="ai-analysis-header">
        <div class="ai-icon">ğŸ“‹</div>
        <div>
            <h3>ë§ì¶¤í˜• í•™ìŠµ ê³„íšì„œ</h3>
            <p style="opacity: 0.9; margin: 0;">AI ë¶„ì„ ê¸°ë°˜ ê°œì¸ë³„ ìµœì í™” í•™ìŠµ ì „ëµ</p>
        </div>
    </div>
    
    <div id="studyPlanContent" class="ai-content">
        <div id="autoGeneratedPlan" style="display: none;">
            <!-- ìë™ ìƒì„±ëœ ê³„íšì„œê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
        </div>
    </div>
</div>
                
                <div id="summaryTable"></div>
                <div id="gradeCards" class="grade-cards"></div>
            </div>
            
            <div id="noResults" class="no-results" style="display: none;">
                <h3>ğŸ” ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                <p>ì…ë ¥í•˜ì‹  ì¶œê²°ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.</p>
            </div>
        </div>
        
        <!-- ê´€ë¦¬ì íƒ­ (ê¸°ì¡´ê³¼ ë™ì¼í•˜ë¯€ë¡œ ìƒëµ) -->
        <div id="adminTab" class="tab-content">
            <!-- ê´€ë¦¬ì ì¸ì¦ ì„¹ì…˜ -->
            <div id="adminAuthSection" class="admin-check">
                <h3>ğŸ” ê´€ë¦¬ì ì¸ì¦</h3>
                <p>ê´€ë¦¬ì ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë ¤ë©´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
                <input type="password" id="adminPassword" class="admin-password" placeholder="ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" onkeypress="if(event.key==='Enter') checkAdminPassword()">
                <br>
                <button onclick="checkAdminPassword()" class="admin-btn">ğŸ”‘ ì¸ì¦</button>
                <button onclick="resetAdminAccess()" class="admin-btn" style="background: #dc3545; color: white;">ğŸ”„ ì´ˆê¸°í™”</button>
                
                
            </div>
            
            <!-- GitHub ì €ì¥ì†Œ ì„¤ì • ì„¹ì…˜ -->
            <div id="githubSetup" class="setup-section">
                <h3>ğŸ”§ GitHub ì €ì¥ì†Œ ì„¤ì •</h3>
                <p><strong>ì²˜ìŒ ì‚¬ìš© ì‹œ í•œ ë²ˆë§Œ ì„¤ì •í•˜ë©´ ë©ë‹ˆë‹¤!</strong></p>
                <p>1. GitHubì—ì„œ ìƒˆ ì €ì¥ì†Œë¥¼ ë§Œë“œì„¸ìš” (ì˜ˆ: winter3-data)</p>
                <p>2. ì €ì¥ì†Œë¥¼ Publicìœ¼ë¡œ ì„¤ì •í•˜ê³  GitHub Pagesë¥¼ í™œì„±í™”í•˜ì„¸ìš”</p>
                <p>3. ì•„ë˜ì— ì €ì¥ì†Œ ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”:</p>
                
                <input type="text" id="githubUsername" class="setup-input" placeholder="GitHub ì‚¬ìš©ìëª… (ì˜ˆ: myusername)" autocomplete="off">
                <input type="text" id="githubRepo" class="setup-input" placeholder="ì €ì¥ì†Œ ì´ë¦„ (ì˜ˆ: winter3-data)" autocomplete="off">
                <input type="password" id="githubToken" class="setup-input" placeholder="GitHub Personal Access Token (ì„ íƒì‚¬í•­)">
                
                <button onclick="saveGitHubConfig()" class="setup-btn">ì„¤ì • ì €ì¥</button>
                <button onclick="testGitHubConnection()" class="setup-btn">ì—°ê²° í…ŒìŠ¤íŠ¸</button>
                
                <p style="margin-top: 15px; font-size: 0.9em;">
                    <strong>ğŸ“Œ GitHub Token ë°œê¸‰ ë°©ë²•:</strong><br>
                    GitHub â†’ Settings â†’ Developer settings â†’ Personal access tokens â†’ Generate new token<br>
                    ê¶Œí•œ: repo (ì „ì²´ ì €ì¥ì†Œ ì ‘ê·¼ ê¶Œí•œ) ì„ íƒ
                </p>
            </div>
            
            <!-- íŒŒì¼ ì—…ë¡œë“œ ì„¹ì…˜ -->
            <div id="uploadSection" style="display: none;">
                <div class="instructions">
                    <h3>âš™ï¸ ê´€ë¦¬ì ì˜ì—­ (ê³ 3)</h3>
                    <p>â€¢ ê³ 3 ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì—¬ ì„±ì  ë°ì´í„°ë¥¼ GitHubì— ì €ì¥í•©ë‹ˆë‹¤</p>
                    <p>â€¢ ì—…ë¡œë“œëœ ë°ì´í„°ëŠ” ëª¨ë“  ê¸°ê¸°ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤</p>
                    <p>â€¢ ì§€ì› íŒŒì¼ í˜•ì‹: .xlsx, .xls</p>
                    <p>â€¢ <strong>ê³ 3 íŠ¹í™”:</strong> ì„ íƒê³¼ëª©ë³„ ë“±ê¸‰ì»· ë° ë¬¸ì œ 35-45ë²ˆ ì²˜ë¦¬</p>
                </div>
                
                <div class="upload-area" id="uploadArea">
                    <h3>ğŸ“ ê³ 3 ì—‘ì…€ íŒŒì¼ ì—…ë¡œë“œ</h3>
                    <p>íŒŒì¼ì„ ë“œë˜ê·¸ì•¤ë“œë¡­í•˜ê±°ë‚˜ ì•„ë˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”</p>
                    <input type="file" id="fileInput" accept=".xlsx,.xls" style="display: none;">
                    <button class="upload-btn" onclick="document.getElementById('fileInput').click()">íŒŒì¼ ì„ íƒ</button>
                    <button class="upload-btn" onclick="processFileAndUpload()" id="processBtn" disabled>GitHubì— ì—…ë¡œë“œ</button>
                </div>
            </div>
            
            <div class="progress" id="progressContainer">
                <div class="progress-bar" id="progressBar">0%</div>
            </div>
            
            <div class="status" id="statusMessage"></div>
            
            <div class="data-summary" id="dataSummary">
                <h3>ğŸ“Š ì—…ë¡œë“œëœ ë°ì´í„° í˜„í™©</h3>
                <div class="summary-grid" id="summaryGrid"></div>
            </div>
        </div>
    </div>

    <script>


// ğŸ†• ì •ë™ë¯¼êµ­ì–´ë…¼ìˆ í•™ì› ì‹¤ì œ êµ¬ê¸€ë“œë¼ì´ë¸Œ í•™ìŠµ ìë£Œ ë§í¬ ë°ì´í„°ë² ì´ìŠ¤ (ê³ 3ìš©)
var studyMaterialsDB = {
    "ë…ì„œ(ì¸ë¬¸ ì´ë¡ )": {
        "ê¸°ë³¸": [
            {
                name: "ë…ì„œ ì¸ë¬¸ ì² í•™ ê¸°ì´ˆ",
                url: "https://drive.google.com/file/d/1Jh6h_XVFYMbsKkljwNA3WP7ZjUg8cZ11/view?usp=drive_link",
                description: "ì¸ë¬¸Â·ì² í•™ ì§€ë¬¸ ê¸°ì´ˆ ë‹¤ì§€ê¸°"
            }
        ],
        "ì‹¬í™”": [
            {
                name: "ë…ì„œ ì¸ë¬¸ ì‚¬íšŒ ì‹¬í™”",
                url: "https://drive.google.com/file/d/1wXD1xGlMMtQn34_07Y_11jovcNvXH5gc/view?usp=drive_link",
                description: "ì¸ë¬¸Â·ì‚¬íšŒ ë³µí•© ì§€ë¬¸ ì‹¬í™” í•™ìŠµ"
            }
        ]
    },
    "ë…ì„œ(ì‚¬íšŒ)": {
        "ê¸°ë³¸": [
            {
                name: "ë…ì„œ ì‚¬íšŒ ê²½ì œ ê¸°ì´ˆ",
                url: "https://drive.google.com/file/d/1VvA5ba5egy3-cq8ekWZrKuEpVsSWw-fl/view?usp=drive_link",
                description: "ì‚¬íšŒÂ·ê²½ì œ ì§€ë¬¸ ê¸°ì´ˆ ì™„ì„±"
            }
        ],
        "ì‹¬í™”": [
            {
                name: "ë…ì„œ ì‚¬íšŒ ê²½ì œ ì‹¬í™”2",
                url: "https://drive.google.com/file/d/1F9Hogy9j6A92zwlBE8aJOU4wqb2Py7Cs/view?usp=drive_link",
                description: "ì‚¬íšŒÂ·ê²½ì œ ê³ ë‚œë„ ì§€ë¬¸ ì •ë³µ"
            }
        ]
    },
    "ë…ì„œ(ê³¼í•™)": {
        "ê¸°ë³¸": [
            {
                name: "ë…ì„œ ê³¼í•™ ê¸°ì´ˆ",
                url: "https://drive.google.com/file/d/1gcElUHAEJ6aa0aiV53HoBNd7DXc5GZah/view?usp=drive_link",
                description: "ê³¼í•™ ì§€ë¬¸ ê¸°ì´ˆ ì‹¤ë ¥ ë‹¤ì§€ê¸°"
            }
        ],
        "ì‹¬í™”": [
            {
                name: "ë…ì„œ ê³¼í•™ ì‹¬í™”",
                url: "https://drive.google.com/file/d/1aMlCh4f4xCyR81oDdHweBzauGlNh5hCB/view?usp=drive_link",
                description: "ê³¼í•™ ì§€ë¬¸ ê³ ë‚œë„ ë¬¸ì œ ì™„ì „ ì •ë³µ"
            }
        ]
    },
    "ë¬¸í•™(í˜„ëŒ€ì‹œ)": {
        "ê¸°ë³¸": [
            {
                name: "ë¬¸í•™ ì‹œ ì¢…í•© ê¸°ì´ˆ1",
                url: "https://drive.google.com/file/d/1JZCK5w2TediHz1JAv2LG-Dazkt_xgb8k/view?usp=drive_link",
                description: "í˜„ëŒ€ì‹œÂ·ê³ ì „ì‹œê°€ ê¸°ì´ˆ ì™„ì„±"
            }
        ],
        "ì‹¬í™”": [
            {
                name: "ë¬¸í•™ í˜„ëŒ€ì‹œ ì‹¬í™”",
                url: "https://drive.google.com/file/d/1CMmDDBUPRBmr63GV_y0EvnNyTsozl5u9/view?usp=drive_link",
                description: "í˜„ëŒ€ì‹œ ê³ ë‚œë„ ë¬¸ì œ ì™„ì „ ì •ë³µ"
            }
        ]
    },
    "ë¬¸í•™(í˜„ëŒ€ì†Œì„¤)": {
        "ê¸°ë³¸": [
            {
                name: "ë¬¸í•™ ì†Œì„¤ì¢…í•© ê¸°ì´ˆ",
                url: "https://drive.google.com/file/d/1pCNTOOPmLpXcaXrRpkELE0dG4wvBpsfS/view?usp=drive_link",
                description: "í˜„ëŒ€ì†Œì„¤Â·ê³ ì „ì†Œì„¤ ê¸°ì´ˆ ì™„ì„±"
            }
        ],
        "ì‹¬í™”": []
    },
    "ë¬¸í•™(ê³ ì „ì‹œê°€)": {
        "ê¸°ë³¸": [
            {
                name: "ë¬¸í•™ ê³ ì „ì‹œê°€ ê¸°ì´ˆ",
                url: "https://drive.google.com/file/d/1WDY_n8NIokdSx7xjivsMiOg01hNnJKvz/view?usp=drive_link",
                description: "ê³ ì „ì‹œê°€ ê¸°ì´ˆ ì™„ì „ ì •ë³µ"
            }
        ],
        "ì‹¬í™”": [
            {
                name: "ë¬¸í•™ ê³ ì „ì‹œê°€ ì‹¬í™”",
                url: "https://drive.google.com/file/d/1VkTFSQiRAIoyHbAmz4f7FhuXGSbSDCTI/view?usp=drive_link",
                description: "ê³ ì „ì‹œê°€ ê³ ë‚œë„ ë¬¸ì œ ì™„ì „ ì •ë³µ"
            }
        ]
    },
    "ë¬¸í•™(ê³ ì „ì†Œì„¤)": {
        "ê¸°ë³¸": [
            {
                name: "ë¬¸í•™ ê³ ì „ì†Œì„¤ ê¸°ì´ˆ",
                url: "https://drive.google.com/file/d/17-dgV_wngT5QxOYBeusMHTAFKDNrPpcc/view?usp=drive_link",
                description: "ê³ ì „ì†Œì„¤ ê¸°ì´ˆ ì™„ì „ ì •ë³µ"
            }
        ],
        "ì‹¬í™”": [
            {
                name: "ë¬¸í•™ ê³ ì „ì†Œì„¤ ì‹¬í™”",
                url: "https://drive.google.com/file/d/1qHvAH6fVK0LNzjG28TAiUw5XAv-crO1c/view?usp=drive_link",
                description: "ê³ ì „ì†Œì„¤ ê³ ë‚œë„ ë¬¸ì œ ì™„ì „ ì •ë³µ"
            }
        ]
    },
    "ì–¸ì–´ í™”ë²•": {
        "ê¸°ë³¸": [
            {
                name: "í™”ë²• ê¸°ì´ˆ",
                url: "https://drive.google.com/file/d/1asKNJifDXFQso-e5zP9DjH8HT5cxY0js/view?usp=drive_link",
                description: "í™”ë²•ì˜ ê¸°ì´ˆë¥¼ ë‹¤ì§€ëŠ” í•„ìˆ˜ ë¬¸ì œì§‘"
            }
        ],
        "ì‹¬í™”": [
            {
                name: "í™”ë²• ì‹¬í™”",
                url: "https://drive.google.com/file/d/1aMPZD1Q5OTIjrQHVx2toqzQrZfHbHEOp/view?usp=drive_link",
                description: "ê³ ë‚œë„ í™”ë²• ë¬¸ì œ ì™„ì „ ì •ë³µ"
            }
        ]
    },
    "ë§¤ì²´ ì‘ë¬¸": {
        "ê¸°ë³¸": [
            {
                name: "ì‘ë¬¸ ê¸°ì´ˆ",
                url: "https://drive.google.com/file/d/1bcUdiiC-fMD-YbWZefIem3vZhJKNtGMg/view?usp=drive_link",
                description: "ì‘ë¬¸ì˜ ê¸°ì´ˆë¥¼ ë‹¤ì§€ëŠ” í•„ìˆ˜ ë¬¸ì œì§‘"
            }
        ],
        "ì‹¬í™”": [
            {
                name: "ì‘ë¬¸ ì‹¬í™”",
                url: "https://drive.google.com/file/d/10zxhT-TtlrpRuaZ3l0Hx0hvzZ6XR0Cs2/view?usp=drive_link",
                description: "ê³ ë‚œë„ ì‘ë¬¸ ë¬¸ì œ ì™„ì „ ì •ë³µ"
            }
        ]
    },
    "ì¢…í•©ëª¨ì˜ê³ ì‚¬": {
        "ê¸°ë³¸": [
            {
                name: "ì¢…í•© ëª¨ì˜ê³ ì‚¬ ê¸°ì´ˆ",
                url: "https://drive.google.com/file/d/1qOkQKIX1lWt37tNxePyTjINXB6MNcayG/view?usp=drive_link",
                description: "ì¢…í•© ì‹¤ë ¥ ì ê²€ìš© ê¸°ì´ˆ ëª¨ì˜ê³ ì‚¬"
            }
        ],
        "ì‹¬í™”": [
            {
                name: "ì¢…í•© ë¹„ê¸°ì¶œ ëª¨ì˜ê³ ì‚¬ 1íšŒ",
                url: "https://drive.google.com/file/d/1IgMkqG6TGaqXnn6hGgN4nOeY3X0SuSlF/view?usp=sharing",
                description: "ìµœì‹  ë¹„ê¸°ì¶œ ë¬¸ì œ ì¢…í•© ëª¨ì˜ê³ ì‚¬"
            }
        ]
    },
    "ë§¤ì¼í•™ìŠµ": {
        "ê¸°ë³¸": [
            {
                name: "ë§¤ì¼ í‘¸ëŠ” ì£¼ê°„ì§€ 1",
                url: "https://drive.google.com/file/d/1bcUdiiC-fMD-YbWZefIem3vZhJKNtGMg/view?usp=drive_link",
                description: "ë§¤ì¼ ê¾¸ì¤€íˆ í’€ ìˆ˜ ìˆëŠ” í•™ìŠµì§€"
            }
        ],
        "ì‹¬í™”": [
            {
                name: "ë§¤ì¼ í‘¸ëŠ” ì£¼ê°„ì§€ 6",
                url: "https://drive.google.com/file/d/1dhjMMd3-7Nnbr515Z7RjtHFTSRTvBoJ5/view?usp=drive_link",
                description: "ì‹¬í™” ë‹¨ê³„ ë§¤ì¼ í•™ìŠµì§€"
            }
        ]
    }
};

// ğŸ†• í˜„ì¬ ì£¼ì°¨ ê³„ì‚° í•¨ìˆ˜
function getCurrentWeekNumber() {
    const now = new Date();
    const start = new Date(now.getFullYear(), 0, 1);
    const diff = now - start;
    const oneWeek = 1000 * 60 * 60 * 24 * 7;
    const weekNumber = Math.ceil(diff / oneWeek);
    
    console.log('ğŸ“… ì˜¬í•´ ' + now.getFullYear() + 'ë…„ ' + weekNumber + 'ì£¼ì°¨');
    
    return ((weekNumber - 1) % 52) + 1;
}

// ğŸ†• ë“±ê¸‰ë³„ í•™ìŠµ ê³„íš ì„¤ì • í•¨ìˆ˜
function getStudyPlanConfig(averageGrade) {
    if (averageGrade <= 2) {
        return {
            studyDays: 3,
            dailySubjects: 2,
            weekdayLimit: 60,
            weekendLimit: 50,
            dailyWorkbook: ['ì›”', 'ìˆ˜', 'ê¸ˆ']
        };
    } else if (averageGrade <= 4) {
        return {
            studyDays: 5,
            dailySubjects: 3,
            weekdayLimit: 100,
            weekendLimit: 50,
            dailyWorkbook: ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ']
        };
    } else {
        return {
            studyDays: 7,
            dailySubjects: 3,
            weekdayLimit: 100,
            weekendLimit: 50,
            dailyWorkbook: ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† ', 'ì¼']
        };
    }
}

// ğŸ†• ì²´ê³„ì ì¸ í•™ìŠµ ìë£Œ ì¶”ì²œ
function getSystematicStudyMaterials(subjectName, currentScore, isMainStudy = true) {
    const materials = [];
    const currentWeek = getCurrentWeekNumber();
    
    console.log('ğŸ” í•™ìŠµìë£Œ ê²€ìƒ‰:', subjectName, 'ì ìˆ˜:', currentScore);
    
    // ê³ 3 ê³¼ëª©ëª… ë§¤í•‘
    const subjectMapping = {
        'ë…ì„œ(ì¸ë¬¸ ì´ë¡ )': 'ë…ì„œ(ì¸ë¬¸ ì´ë¡ )',
        'ë…ì„œ(ì‚¬íšŒ)': 'ë…ì„œ(ì‚¬íšŒ)',
        'ë…ì„œ(ê³¼í•™)': 'ë…ì„œ(ê³¼í•™)',
        'ë¬¸í•™(í˜„ëŒ€ì‹œ)': 'ë¬¸í•™(í˜„ëŒ€ì‹œ)',
        'ë¬¸í•™(í˜„ëŒ€ì†Œì„¤)': 'ë¬¸í•™(í˜„ëŒ€ì†Œì„¤)',
        'ë¬¸í•™(ê³ ì „ì‹œê°€)': 'ë¬¸í•™(ê³ ì „ì‹œê°€)',
        'ë¬¸í•™(ê³ ì „ì†Œì„¤)': 'ë¬¸í•™(ê³ ì „ì†Œì„¤)',
        'ì–¸ì–´ í™”ë²•': 'ì–¸ì–´ í™”ë²•',
        'ë§¤ì²´ ì‘ë¬¸': 'ë§¤ì²´ ì‘ë¬¸'
    };
    
    const mappedSubject = subjectMapping[subjectName] || subjectName;
    console.log('ğŸ“ ë§¤í•‘ëœ ê³¼ëª©ëª…:', subjectName, 'â†’', mappedSubject);
    
    // ì£¼ êµì¬ ì¶”ì²œ
    if (isMainStudy && studyMaterialsDB[mappedSubject]) {
        let levelsToInclude = [];
        
        if (currentScore < 60) {
            levelsToInclude = ["ê¸°ë³¸"];
        } else if (currentScore <= 80) {
            levelsToInclude = ["ê¸°ë³¸", "ì‹¬í™”"];
        } else {
            levelsToInclude = ["ì‹¬í™”"];
        }
        
        levelsToInclude.forEach(level => {
            if (studyMaterialsDB[mappedSubject][level] && studyMaterialsDB[mappedSubject][level].length > 0) {
                studyMaterialsDB[mappedSubject][level].forEach((material, index) => {
                    materials.push({
                        ...material,
                        studyTime: 40,
                        type: "main"
                    });
                });
            }
        });
    }
    
    // ë§¤ì¼ í‘¸ëŠ” ì£¼ê°„ì§€ ì¶”ê°€
    if (studyMaterialsDB["ë§¤ì¼í•™ìŠµ"]) {
        const allWeeklyMaterials = [
            ...studyMaterialsDB["ë§¤ì¼í•™ìŠµ"]["ê¸°ë³¸"],
            ...studyMaterialsDB["ë§¤ì¼í•™ìŠµ"]["ì‹¬í™”"]
        ];
        
        if (allWeeklyMaterials.length > 0) {
            const weeklyIndex = (currentWeek - 1) % 10;
            materials.push({
                ...allWeeklyMaterials[weeklyIndex],
                studyTime: 20,
                type: "daily"
            });
        }
    }
    
   // ì¢…í•© ìë£Œë¡œ ëŒ€ì²´
    const hasMainMaterial = materials.some(m => m.type === "main");
    if (!hasMainMaterial && studyMaterialsDB["ì¢…í•©ëª¨ì˜ê³ ì‚¬"]) {
        const level = currentScore < 60 ? "ê¸°ë³¸" : "ì‹¬í™”";
        const generalMaterials = studyMaterialsDB["ì¢…í•©ëª¨ì˜ê³ ì‚¬"][level];
        
        if (generalMaterials && generalMaterials.length > 0) {
            generalMaterials.forEach((material, index) => {
                materials.push({
                    ...material,
                    studyTime: 30,
                    type: "general"
                });
            });
        }
    }
    
    return materials;
}

// ğŸ†• ìƒì„¸ í•™ìŠµ ê³¼ì œ ìƒì„± í•¨ìˆ˜ (ê³ 3ìš©)
function getDetailedStudyTask(subject, currentScore) {
    const tasks = {
        'ë…ì„œ(ì¸ë¬¸ ì´ë¡ )': {
            basic: 'ì² í•™ ê¸°ë³¸ ìš©ì–´(ì¡´ì¬ë¡ , ì¸ì‹ë¡ , ìœ¤ë¦¬í•™) ì •ë¦¬ â†’ ë¯¸í•™Â·ì˜ˆìˆ ë¡  ê¸°ì´ˆ ê°œë… í•™ìŠµ â†’ ì§€ë¬¸ êµ¬ì¡° íŒŒì•…(ë¬¸ì œì œê¸°â†’ë…¼ì¦â†’ê²°ë¡ ) â†’ í•µì‹¬ ë‚´ìš©ê³¼ ì„¸ë¶€ ë‚´ìš© êµ¬ë¶„ ì—°ìŠµ',
            advanced: 'ë³µì¡í•œ ë…¼ë¦¬ êµ¬ì¡°ì™€ ì¶”ë¡  ê³¼ì • ë¶„ì„ â†’ í•¨ì¶•ì  ì˜ë¯¸ì™€ í–‰ê°„ ì½ê¸° â†’ ë™ì„œì–‘ ì² í•™ ì‚¬ìƒ ë¹„êµ ë¶„ì„ â†’ ë¹ ë¥¸ ë…í•´ í›ˆë ¨(ë¶„ë‹¹ 800ì ì´ìƒ) â†’ ì‹œê°„ ë‹¨ì¶• ìŠ¤í‚¤ë° ê¸°ë²•'
        },
        'ë…ì„œ(ì‚¬íšŒ)': {
            basic: 'ê²½ì œí•™ ê¸°ë³¸ ê°œë…(ìˆ˜ìš”ê³µê¸‰, ì‹œì¥ê²½ì œ) ì •ë¦¬ â†’ ì •ì¹˜í•™Â·ì‚¬íšŒí•™Â·ë²•í•™ ê¸°ì´ˆ ìš©ì–´ í•™ìŠµ â†’ ì›ì¸-ê²°ê³¼ ê´€ê³„ ë¶„ì„ â†’ ë¬¸ì œì -í•´ê²°ë°©ì•ˆ êµ¬ì¡° ì´í•´ â†’ í†µê³„ ìë£Œ í•´ì„ ë°©ë²•',
            advanced: 'ë‹¤ì¸µì  ì‚¬íšŒ í˜„ìƒì˜ ìƒí˜¸ì‘ìš© ë¶„ì„ â†’ ì •ì±…ì˜ íš¨ê³¼ì™€ ë¶€ì‘ìš© ë¶„ì„ â†’ ì œë„ì  ë³€í™”ì˜ ë°°ê²½ê³¼ ê²°ê³¼ íŒŒì•… â†’ ë³µí•© ì‚¬íšŒ ë¬¸ì œì˜ ì¢…í•©ì  ì´í•´ â†’ ê³ ë‚œë„ ì§€ë¬¸ ì •ë³µ'
        },
        'ë…ì„œ(ê³¼í•™)': {
            basic: 'ë¬¼ë¦¬Â·í™”í•™Â·ìƒë¬¼Â·ì§€êµ¬ê³¼í•™ ê¸°ë³¸ ìš©ì–´ ì •ë¦¬ â†’ ì‹¤í—˜ ì„¤ê³„ì™€ ê³¼ì • ì´í•´ â†’ ê°€ì„¤ ì„¤ì •ê³¼ ê²€ì¦ ë°©ë²• â†’ ê´€ì°° ê²°ê³¼ ë¶„ì„ê³¼ í•´ì„ â†’ ê³¼ì • ìˆœì„œë„ ê·¸ë¦¬ê¸° ì—°ìŠµ',
            advanced: 'ë³µì¡í•œ ê³¼í•™ ì›ë¦¬ì™€ ë²•ì¹™ ì´í•´ â†’ ìµœì‹  ê³¼í•™ ê¸°ìˆ  ë™í–¥ íŒŒì•… â†’ ê³¼í•™ì‚¬ì  ë°œê²¬ê³¼ íŒ¨ëŸ¬ë‹¤ì„ ë³€í™” â†’ ê³ ë‚œë„ ì‹¤í—˜Â·ê¸°ìˆ  ì§€ë¬¸ ë¶„ì„ â†’ ì¸ê³¼ê´€ê³„ ì™„ë²½ íŒŒì•…'
        },
        'ë¬¸í•™(í˜„ëŒ€ì‹œ)': {
            basic: 'í™”ìì™€ ìƒí™© ì„¤ì • ë¶„ì„ â†’ ì£¼ìš” ì‹œì–´ì˜ í•¨ì¶•ì  ì˜ë¯¸ íŒŒì•… â†’ í™”ìì˜ ì •ì„œì™€ ì–´ì¡° ë¶„ì„ â†’ ë¹„ìœ ë²•(ì€ìœ , í™˜ìœ , ì˜ì¸ë²•) ì´í•´ â†’ ëŒ€ì¡°ë²•Â·ì ì¸µë²•Â·ì˜íƒ„ë²• í•™ìŠµ',
            advanced: 'ë‹¤ì¸µì  í™”ì ì˜ì‹ê³¼ ê´€ì  ë³€í™” ì¶”ì  â†’ ì‹œê°„Â·ê³µê°„ ì˜ì‹ ì‹¬ì¸µ ë¶„ì„ â†’ ìƒì§•ê³¼ ì€ìœ ì˜ ì‹¬ì¸µ ì˜ë¯¸ íŒŒì•… â†’ ë¬¸í•™ì‚¬ì  íë¦„ê³¼ ì‚¬ì¡° ì´í•´ â†’ ì‘ê°€ íŠ¹ìœ ì˜ ë¬¸ì²´ì™€ ê°œì„± ë¶„ì„'
        },
        'ë¬¸í•™(í˜„ëŒ€ì†Œì„¤)': {
            basic: 'ì¸ë¬¼ ê´€ê³„ë„ ì‘ì„± ë° ì„±ê²© ë¶„ì„ â†’ ì‚¬ê±´ì˜ ë°œë‹¨-ì „ê°œ-ìœ„ê¸°-ì ˆì •-ê²°ë§ ì •ë¦¬ â†’ ê°ˆë“± êµ¬ì¡°(ì¸ë¬¼ê°„Â·ë‚´ì Â·ì‚¬íšŒì ) íŒŒì•… â†’ ì‹œê³µê°„ì  ë°°ê²½ì˜ ì˜ë¯¸ â†’ ì£¼ì œ ì˜ì‹ íŒŒì•…',
            advanced: 'ì‹œì ê³¼ ì„œìˆ ìì˜ ì—­í•  ë¶„ì„ â†’ ì„œìˆ  ìˆœì„œ(ìˆœí–‰Â·ì—­í–‰Â·êµì°¨) íŒŒì•… â†’ ì˜ì‹ì˜ íë¦„Â·ë‚´ì  ë…ë°± ë¶„ì„ â†’ ë¬¸í•™ì‚¬ì  ì˜ì˜ì™€ ì‚¬ì¡° ì´í•´ â†’ ì‘ê°€ì˜ì‹ê³¼ ì‘í’ˆ ì„¸ê³„ íƒêµ¬'
        },
        'ë¬¸í•™(ê³ ì „ì‹œê°€)': {
            basic: 'ê°ˆë˜ì™€ í˜•ì‹(í–¥ê°€Â·ê³ ë ¤ê°€ìš”Â·ì‹œì¡°Â·ê°€ì‚¬) êµ¬ë¶„ â†’ ìš´ìœ¨ê³¼ ìœ¨ê²©(3Â·4ì¡°, 4Â·4ì¡°) íŒŒì•… â†’ ê³ ì–´ì˜ í˜„ëŒ€ì–´ í’€ì´ ì•”ê¸° â†’ í™”ìì˜ ì •ì„œì™€ ìƒí™© â†’ ì£¼ìš” ì†Œì¬ì˜ ê´€ìŠµì  ì˜ë¯¸',
            advanced: 'ì‹œìƒ ì „ê°œ ê³¼ì •(ì„ ê²½í›„ì •Â·ê¸°ìŠ¹ì „ê²°) ë¶„ì„ â†’ ì‹œëŒ€ë³„ ë¬¸í•™ íŠ¹ì„± ì´í•´ â†’ ì‘ê°€ì™€ ì‘í’ˆì˜ ë¬¸í•™ì‚¬ì  ì˜ì˜ â†’ ê°ˆë˜ë³„ íŠ¹ì§•ê³¼ ë³€ì²œì‚¬ â†’ ë‹¹ëŒ€ ì‚¬íšŒìƒê³¼ ì—°ê´€ ì§€ì–´ ê°ìƒ'
        },
        'ë¬¸í•™(ê³ ì „ì†Œì„¤)': {
            basic: 'ë“±ì¥ì¸ë¬¼ì˜ ì„±ê²©ê³¼ ì—­í•  íŒŒì•… â†’ ì‚¬ê±´ ì „ê°œì™€ êµ¬ì„± ì •ë¦¬ â†’ ê°ˆë“± êµ¬ì¡°ì™€ í•´ê²° ê³¼ì • â†’ ê¶Œì„ ì§•ì•… êµ¬ì¡° ì´í•´ â†’ ì‹ ë¶„ì œ ë¹„íŒ ì˜ì‹ê³¼ í˜„ì‹¤ ë¹„íŒ íŒŒì•…',
            advanced: 'ì „ì§€ì  ì„œìˆ ê³¼ ê°œì…ì  ì„œìˆ  ë¶„ì„ â†’ íŒì†Œë¦¬ê³„ ì†Œì„¤ì˜ íŠ¹ì§• â†’ ê°€ë¬¸ì†Œì„¤ê³¼ ì˜ì›…ì†Œì„¤ êµ¬ì¡° ë¹„êµ â†’ ë¬¸í•™ì‚¬ì  ê°€ì¹˜ì™€ ì˜ì˜ â†’ í˜„ëŒ€ ë¬¸í•™ê³¼ì˜ ì—°ê´€ì„± ë° ë¯¼ì¡± ë¬¸í•™ìœ¼ë¡œì„œì˜ ê°€ì¹˜'
        },
        'ì–¸ì–´ í™”ë²•': {
            basic: 'í™”ë²•ì˜ ê¸°ë³¸ ì›ë¦¬ í•™ìŠµ(ìƒí™©, ëª©ì , ì²­ì íŒŒì•…) â†’ í™”ì ì˜ë„ì™€ ì²­ì ë°˜ì‘ ë¶„ì„ â†’ ë§í•˜ê¸° ì „ëµê³¼ ê¸°ë²• â†’ í† ë¡ ê³¼ í˜‘ìƒì˜ ì›ë¦¬ â†’ ê¸°ë³¸ í™”ë²• ë¬¸ì œ íŒ¨í„´ ìµíˆê¸°',
            advanced: 'ë³µí•© í™”ë²• ìƒí™©ì˜ ë‹¤ê°ì  ìš”ì†Œ ë¶„ì„ â†’ í™”ì ì˜ë„ì™€ ì²­ì ë°˜ì‘ì˜ ì‹¬ì¸µ ë¶„ì„ â†’ ì„¤ë“ ì „ëµê³¼ ë…¼ì¦ êµ¬ì¡° â†’ ê³ ê¸‰ í† ë¡  ë° ë°œí‘œ ê¸°ë²• â†’ ì‹¤ì „ ì‹œê°„ ë‹¨ì¶• ê¸°ë²• ì—°ìŠµ'
        },
        'ë§¤ì²´ ì‘ë¬¸': {
            basic: 'ì‘ë¬¸ ê³¼ì •(ê³„íšâ†’ì‘ì„±â†’ìˆ˜ì •) ì´í•´ â†’ ê¸€ì˜ ìœ í˜•ë³„ íŠ¹ì„± íŒŒì•… â†’ ê³ ì³ì“°ê¸° ê¸°ë³¸ ì›ë¦¬ â†’ ë§¤ì²´ ì–¸ì–´ì˜ íŠ¹ì„± â†’ ê¸°ë³¸ ì‘ë¬¸ ë¬¸ì œ íŒ¨í„´ ìµíˆê¸°',
            advanced: 'ì‘ë¬¸ ìœ í˜•ë³„ ì„¸ë¶€ ì „ëµ ìˆ˜ë¦½ â†’ ê³ ì³ì“°ê¸° í•¨ì • íŒ¨í„´ ë¶„ì„ â†’ ë§¤ì²´ë³„ ì–¸ì–´ ì‚¬ìš© ì–‘ìƒ â†’ ë””ì§€í„¸ ë§¤ì²´ì˜ ì†Œí†µ ë°©ì‹ â†’ ê³ ê¸‰ ì‘ë¬¸ ë° ë§¤ì²´ ë¬¸ì œ ì •ë³µ'
        }
    };
    
    const subjectTasks = tasks[subject];
    if (!subjectTasks) return 'ê¸°ë³¸ ê°œë… í•™ìŠµ ë° ë¬¸ì œ í’€ì´ ì—°ìŠµì„ í†µí•œ ì‹¤ë ¥ í–¥ìƒ';
    
    return currentScore < 60 ? subjectTasks.basic : subjectTasks.advanced;
}

// ğŸ†• ìë™ ìƒì„±ëœ í•™ìŠµ ê³„íšì„œ í‘œì‹œ í•¨ìˆ˜
function displayAutoGeneratedPlan(planData) {
    const planContainer = document.getElementById('autoGeneratedPlan');
    const { student, weakSubjects, weeklyPlan, config, averageGrade } = planData;
    
    if (weakSubjects.length === 0) {
        displayExcellentStudentPlan(student);
        return;
    }
    
    const currentWeek = getCurrentWeekNumber();
    
    planContainer.innerHTML = `
        <div class="advanced-study-plan">
            <div class="plan-document-header">
                <h3>ğŸ“‹ ${student.name}ë‹˜ ë§ì¶¤ í•™ìŠµ ê³„íšì„œ (ê³ 3)</h3>
                <div class="student-info-banner">
                    <strong>${student.name} í•™ìƒ</strong> - ê°œì¸ë³„ ì•½ì  ë¶„ì„ ê¸°ë°˜ ìµœì í™” ê³„íš
                </div>
            </div>
            
            <div class="improvement-analysis">
                <h4 style="margin-bottom: 15px; color: rgba(255,255,255,0.95);">
                    âš ï¸ ìš°ì„  ê°œì„  ê³¼ëª© (ìƒìœ„ 3ê°œ)
                </h4>
                
                ${weakSubjects.map((subject, index) => {
                    const materials = getSystematicStudyMaterials(subject.name, subject.current, true);
                    const studyTask = getDetailedStudyTask(subject.name, subject.current);
                    return `
                        <div class="weak-subject-card priority-${subject.priority}">
                            <div class="subject-header">
                                <div class="subject-name">${subject.name}</div>
                                <div class="priority-badge priority-${subject.priority}">
                                    ${subject.priority === 'high' ? 'ğŸ”´ ìµœìš°ì„ ' : subject.priority === 'medium' ? 'ğŸŸ¡ ì¤‘ìš”' : 'ğŸ”µ ë³´í†µ'}
                                </div>
                            </div>
                            
                            <div class="subject-details">
                                <div class="detail-metric">
                                    <div class="detail-value">${subject.current}%</div>
                                    <div class="detail-label">í˜„ì¬ ì„±ì·¨ë„</div>
                                </div>
                            </div>
                            
                            <div style="background: rgba(255, 255, 255, 0.05); border-radius: 8px; padding: 15px; margin: 15px 0;">
                                <h5 style="margin-bottom: 10px; color: rgba(255,255,255,0.95);">ğŸ“‹ ì·¨ì•½ì˜ì—­ ê°œë… í´ë¦¬ë‹‰</h5>
                                <p style="color: rgba(255,255,255,0.85); line-height: 1.5; font-size: 0.9em;">${studyTask}</p>
                            </div>
                            
                            <div class="study-materials">
                                <h5 style="margin-bottom: 10px;">ğŸ“š ì¶”ì²œ í•™ìŠµ ìë£Œ ë‹¤ìš´ë¡œë“œ ë§í¬</h5>
                                <div class="material-links">
                                    ${materials.map(material => `
                                        <a href="${material.url}" target="_blank" class="material-link">
                                            â¬‡ï¸ ${material.name}
                                        </a>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    `;
                }).join('')}
            </div>
            
            ${createWeeklyScheduleHTML(weeklyPlan)}
            
            <div class="motivation-banner">
                <h4>${student.name}ë‹˜ì„ ìœ„í•œ ê²©ë ¤ ë©”ì‹œì§€</h4>
                <div class="motivation-text">
                    í˜„ì¬ ${averageGrade.toFixed(1)}ë“±ê¸‰ì—ì„œ ${Math.max(1, Math.floor(averageGrade) - 1)}ë“±ê¸‰ìœ¼ë¡œ í–¥ìƒí•˜ê¸° ìœ„í•œ
                    ì²´ê³„ì ì¸ ê³„íšì„ ìˆ˜ë¦½í–ˆìŠµë‹ˆë‹¤. ìˆ˜ëŠ¥ê¹Œì§€ ë‚¨ì€ ì‹œê°„ì„ íš¨ìœ¨ì ìœ¼ë¡œ í™œìš©í•˜ì—¬ ë°˜ë“œì‹œ ëª©í‘œë¥¼ ë‹¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤! 
                    ì •ë™ë¯¼êµ­ì–´ë…¼ìˆ í•™ì›ì´ ì—¬ëŸ¬ë¶„ì˜ ì„±ê³µì„ ì‘ì›í•©ë‹ˆë‹¤! ğŸ’ª
                </div>
            </div>
        </div>
    `;
}

// ğŸ†• ìë™ ìƒì„±ëœ í•™ìŠµ ê³„íšì„œ ìƒì„± (AI ë¶„ì„ ì§í›„ í˜¸ì¶œ)
function generateAutoStudyPlan(student) {
    console.log('ìë™ í•™ìŠµ ê³„íšì„œ ìƒì„± ì‹œì‘:', student.name);
    
    // ğŸ”§ ê³„íšì„œ ì„¹ì…˜ ë¨¼ì € í‘œì‹œ
    document.getElementById('studyPlanSection').style.display = 'block';
    
    // AI ë¶„ì„ ê²°ê³¼ ê°€ì ¸ì˜¤ê¸°
    const analysisResult = performAIAnalysis(student);
    const aiWeaknesses = analysisResult.weaknesses || [];
    
    if (aiWeaknesses.length === 0) {
        displayExcellentStudentPlan(student);
        return;
    }
    
    const grades = student.grades;
    const gradeKeys = Object.keys(grades);
    const recent4Grades = gradeKeys.slice(-4).map(key => parseInt(grades[key].grade));
    const averageGrade = recent4Grades.reduce((a, b) => a + b, 0) / recent4Grades.length;
    
    const weakSubjects = aiWeaknesses.slice(0, 3).map(weakness => ({
        name: weakness.subject,
        current: weakness.average,
        improvement: 85 - weakness.average,
        priority: weakness.urgency,
        description: weakness.description
    }));

    const weeklyPlan = generateRealisticWeeklyPlan(weakSubjects, averageGrade);
    const config = getStudyPlanConfig(averageGrade);
    
    displayAutoGeneratedPlan({
        student: student,
        weakSubjects: weakSubjects,
        weeklyPlan: weeklyPlan,
        config: config,
        averageGrade: averageGrade
    });
    
    document.getElementById('autoGeneratedPlan').style.display = 'block';
}

// ğŸ†• í˜„ì‹¤ì ì¸ ì£¼ê°„ ê³„íš ìƒì„±
function generateRealisticWeeklyPlan(weakSubjects, averageGrade) {
    const config = getStudyPlanConfig(averageGrade);
    const days = ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† ', 'ì¼'];
    const plan = {};
    
    days.forEach(day => {
        plan[day] = [];
    });
    
    const currentWeek = getCurrentWeekNumber();
    const dailyWorkbook = studyMaterialsDB["ë§¤ì¼í•™ìŠµ"] ? 
        [...studyMaterialsDB["ë§¤ì¼í•™ìŠµ"]["ê¸°ë³¸"], ...studyMaterialsDB["ë§¤ì¼í•™ìŠµ"]["ì‹¬í™”"]] : [];
    
    if (dailyWorkbook.length > 0) {
        const weeklyIndex = (currentWeek - 1) % dailyWorkbook.length;
        const selectedWorkbook = dailyWorkbook[weeklyIndex];
        
        config.dailyWorkbook.forEach(day => {
            plan[day].push({
                subject: "ë§¤ì¼ í‘¸ëŠ” ì£¼ê°„ì§€",
                material: selectedWorkbook.name,
                time: 20,
                priority: "daily",
                url: selectedWorkbook.url,
                description: selectedWorkbook.description
            });
        });
    }
    
    let dayIndex = 0;
    const studyDays = days.slice(0, config.studyDays);
    
    weakSubjects.forEach((subject, subjectIndex) => {
        const materials = getSystematicStudyMaterials(subject.name, subject.current, true);
        
        materials.forEach(material => {
            if (material.type === "main") {
                const targetDay = studyDays[dayIndex % studyDays.length];
                const isWeekend = targetDay === 'í† ' || targetDay === 'ì¼';
                const timeLimit = isWeekend ? config.weekendLimit : config.weekdayLimit;
                const currentTime = plan[targetDay].reduce((sum, item) => sum + item.time, 0);
                
                if (currentTime + material.studyTime <= timeLimit) {
                    plan[targetDay].push({
                        subject: subject.name,
                        material: material.name,
                        time: material.studyTime,
                        priority: subject.priority,
                        url: material.url,
                        description: material.description
                    });
                    
                    dayIndex++;
                }
            }
        });
    });
    
    return plan;
}

// ğŸ†• ìš°ìˆ˜ í•™ìƒìš© ê³„íšì„œ
function displayExcellentStudentPlan(student) {
    const planContainer = document.getElementById('autoGeneratedPlan');
    const currentWeek = getCurrentWeekNumber();
    
    planContainer.innerHTML = `
        <div class="advanced-study-plan">
            <div class="plan-document-header">
                <h3>ğŸŒŸ ìš°ìˆ˜ í•™ìƒ ë§ì¶¤ ê³„íšì„œ (ê³ 3)</h3>
                <div class="student-info-banner">
                    <strong>${student.name} í•™ìƒ</strong> - ëª¨ë“  ì˜ì—­ì—ì„œ ë›°ì–´ë‚œ ì„±ì·¨ë„!
                </div>
            </div>
            
            <div style="text-align: center; padding: 30px; background: rgba(40,167,69,0.1); border-radius: 12px;">
                <h4 style="color: #28a745; margin-bottom: 15px;">ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤!</h4>
                <p style="line-height: 1.6; margin-bottom: 20px;">
                    í˜„ì¬ ëª¨ë“  ê³¼ëª©ì—ì„œ ìš°ìˆ˜í•œ ì„±ì·¨ë„ë¥¼ ë³´ì´ê³  ìˆìŠµë‹ˆë‹¤.<br>
                    ìˆ˜ëŠ¥ê¹Œì§€ í˜„ì¬ ìˆ˜ì¤€ì„ ìœ ì§€í•˜ë©° ì‹¤ì „ ê°ê°ì„ ê¸°ë¥´ëŠ” ê²ƒì„ ì¶”ì²œí•©ë‹ˆë‹¤.
                </p>
                
                <div class="study-materials">
                    <h5 style="margin-bottom: 15px;">ğŸ“š ì¶”ì²œ í•™ìŠµ ìë£Œ</h5>
                    <div class="material-links">
                        ${studyMaterialsDB["ì¢…í•©ëª¨ì˜ê³ ì‚¬"]["ì‹¬í™”"].map(material => `
                            <a href="${material.url}" target="_blank" class="material-link">
                                â¬‡ï¸ ${material.name}
                            </a>
                        `).join('')}
                    </div>
                </div>
            </div>
        </div>
    `;
}

// ğŸ†• ì£¼ê°„ ìŠ¤ì¼€ì¤„ HTML ìƒì„± í•¨ìˆ˜
function createWeeklyScheduleHTML(weeklyPlan) {
    const days = ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† ', 'ì¼'];
    
    let html = `
        <div class="weekly-schedule-advanced">
            <h4 style="margin-bottom: 15px; color: rgba(255,255,255,0.95);">
                ğŸ“… ì£¼ê°„ ë§ì¶¤ í•™ìŠµ ìŠ¤ì¼€ì¤„
            </h4>
            <div style="margin-bottom: 20px; opacity: 0.9; line-height: 1.5;">
                ê³¼ëª©ë³„ ìš°ì„ ìˆœìœ„ì™€ ê°œì¸ ì•½ì ì„ ê³ ë ¤í•˜ì—¬ ìµœì í™”ëœ ì£¼ê°„ ê³„íšì…ë‹ˆë‹¤.
                ë§¤ì¼ ì •í•´ì§„ ì‹œê°„ì— ê¾¸ì¤€íˆ ì‹¤ì²œí•˜ëŠ” ê²ƒì´ í•µì‹¬ì…ë‹ˆë‹¤! í•™ìŠµ ìë£ŒëŠ” ìœ„ ì¶”ì²œí•™ìŠµìë£Œ ë‹¤ìš´ë¡œë“œ ë§í¬ë¥¼ ì´ìš©í•˜ì„¸ìš”.
            </div>
            
            <div class="schedule-week-grid">
    `;
    
    days.forEach(day => {
        html += `
            <div class="schedule-day">
                <div class="day-name">${day}ìš”ì¼</div>
        `;
        
        if (weeklyPlan[day] && weeklyPlan[day].length > 0) {
            let totalTime = 0;
            weeklyPlan[day].forEach(session => {
                const priorityColor = {
                    'high': 'rgba(220, 53, 69, 0.3)',
                    'medium': 'rgba(255, 193, 7, 0.3)',
                    'low': 'rgba(23, 162, 184, 0.3)'
                };
                
                html += `
                    <div class="study-session" style="background: ${priorityColor[session.priority] || priorityColor.medium};">
                        <div class="session-subject">${session.subject}</div>
                        <div class="session-time">${session.time}ë¶„</div>
                    </div>
                `;
                totalTime += session.time;
            });
            
            html += `<div style="margin-top: 8px; font-size: 0.75em; opacity: 0.8; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 5px;">ì´ ${totalTime}ë¶„</div>`;
        } else {
            html += `<div class="study-session">ììœ  í•™ìŠµ</div>`;
        }
        
        html += `</div>`;
    });
    
    html += `
        </div>
        <div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px; text-align: center;">
            <strong>ğŸ’¡ í•™ìŠµ íš¨ê³¼ ê·¹ëŒ€í™” íŒ</strong><br>
            ğŸ”´ ìµœìš°ì„  ê³¼ëª©ì€ ì§‘ì¤‘ë ¥ì´ ì¢‹ì€ ì €ë… ì‹œê°„ì— | ğŸŸ¡ ì¤‘ìš” ê³¼ëª©ì€ ì»¨ë””ì…˜ì´ ì¢‹ì€ ì£¼ë§ì— | í•™ìŠµ ìë£ŒëŠ” ìœ„ ì¶”ì²œí•™ìŠµìë£Œ ë‹¤ìš´ë¡œë“œ ë§í¬ë¥¼ ì´ìš©í•˜ì„¸ìš”.
        </div>
    </div>
    `;
    
    return html;
}

// ğŸ†• ë“±ê¸‰ë³„ ëª©í‘œ ì ìˆ˜ ë°˜í™˜ í•¨ìˆ˜
function getTargetScoreFromGrade(grade) {
    const scoreMap = {
        '1': 92,
        '2': 82,
        '3': 72,
        '4': 62,
        '5': 52
    };
    return scoreMap[grade] || 80;
}
    
        // í•™ì—… ìš´ì„¸ ë°ì´í„°
        var fortuneData = {
            excellent: {
                icon: "â­",
                title: "ìµœê³ ì˜ í•™ìŠµì¼!",
                stars: "â­â­â­â­â­",
                color: "from-yellow-400 to-orange-500",
                bgColor: "rgba(255, 215, 0, 0.1)",
                advice: [
                    "ìƒˆë¡œìš´ ê°œë…ì„ ë°°ìš°ê¸°ì— ìµœì ì˜ ë‚ ì…ë‹ˆë‹¤",
                    "ì–´ë ¤ìš´ ë¬¸ì œì— ë„ì „í•´ë³´ì„¸ìš”",
                    "ê·¸ë£¹ ìŠ¤í„°ë””ë‚˜ í† ë¡ ì´ íŠ¹íˆ íš¨ê³¼ì ì¼ ê²ƒì…ë‹ˆë‹¤",
                    "ì˜¤ëŠ˜ ë°°ìš´ ë‚´ìš©ì€ ì˜¤ë˜ ê¸°ì–µë  ê²ƒì…ë‹ˆë‹¤",
                    "í‰ì†Œë³´ë‹¤ 1.5ë°° ë§ì€ ë¶„ëŸ‰ì„ ì†Œí™”í•  ìˆ˜ ìˆì–´ìš”",
                    "ì°½ì˜ì ì¸ ë¬¸ì œ í•´ê²° ë°©ë²•ì„ ì‹œë„í•´ë³´ì„¸ìš”",
                    "ì„ ìƒë‹˜ê»˜ ì–´ë ¤ìš´ ì§ˆë¬¸ì„ ë˜ì ¸ë³´ì„¸ìš”",
                    "ìƒˆë¡œìš´ í•™ìŠµ ì•±ì´ë‚˜ ë„êµ¬ë¥¼ í™œìš©í•´ë³´ì„¸ìš”"
                ],
                studyTips: [
                    "ì˜¤ëŠ˜ì€ í‰ì†Œë³´ë‹¤ 30% ë” ì§‘ì¤‘í•  ìˆ˜ ìˆëŠ” ë‚ ì…ë‹ˆë‹¤!",
                    "ê°€ì¥ ì–´ë ¤ìš´ ê³¼ëª©ë¶€í„° ì‹œì‘í•´ë³´ì„¸ìš”!",
                    "ìƒˆë¡œìš´ í•™ìŠµë²•ì„ ì‹œë„í•˜ê¸° ìµœì ì˜ ë‚ ì´ì—ìš”!",
                    "ì¹œêµ¬ë“¤ê³¼ ìŠ¤í„°ë”” ê·¸ë£¹ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”!"
                ]
            },
            verygood: {
                icon: "ğŸŒŸ",
                title: "ë§¤ìš° ì¢‹ì€ í•™ìŠµ ê¸°ìš´!",
                stars: "â­â­â­â­",
                color: "from-orange-400 to-red-500",
                bgColor: "rgba(255, 140, 0, 0.1)",
                advice: [
                    "ì§‘ì¤‘ë ¥ì´ ë›°ì–´ë‚œ ë‚ ì…ë‹ˆë‹¤",
                    "ì¤‘ìš”í•œ ê°œë… ì •ë¦¬ì— ìµœì ì…ë‹ˆë‹¤",
                    "ì•”ê¸°ë³´ë‹¤ëŠ” ì´í•´ ì¤‘ì‹¬ìœ¼ë¡œ ê³µë¶€í•˜ì„¸ìš”",
                    "ì„ ìƒë‹˜ê»˜ ì§ˆë¬¸í•˜ê¸° ì¢‹ì€ ë‚ ì´ì—ìš”",
                    "ë³µì¡í•œ ê³µì‹ì´ë‚˜ ê°œë…ì„ ë§ˆìŠ¤í„°í•˜ê¸° ì¢‹ìŠµë‹ˆë‹¤",
                    "ë…¼ë¦¬ì  ì‚¬ê³ ê°€ í•„ìš”í•œ ê³¼ëª©ì— ì§‘ì¤‘í•˜ì„¸ìš”",
                    "ì˜ˆìŠµë³´ë‹¤ëŠ” ì‹¬í™” í•™ìŠµì— ì‹œê°„ì„ íˆ¬ìí•˜ì„¸ìš”",
                    "ì˜¤ëŠ˜ ì •ë¦¬í•œ ë‚´ìš©ì€ ì‹œí—˜ì— ë‚˜ì˜¬ í™•ë¥ ì´ ë†’ì•„ìš”"
                ],
                studyTips: [
                    "ê¹Šì´ ìˆëŠ” í•™ìŠµì— ì§‘ì¤‘í•´ë³´ì„¸ìš”!",
                    "ì–´ë ¤ìš´ ë¬¸ì œì§‘ì„ ë„ì „í•´ë³´ëŠ” ë‚ ì´ì—ìš”!",
                    "ê°œë… ì—°ê²° ê³ ë¦¬ë¥¼ ì°¾ì•„ë³´ì„¸ìš”!",
                    "ì˜¤ëŠ˜ ë°°ìš´ ë‚´ìš©ì„ ì¹œêµ¬ì—ê²Œ ì„¤ëª…í•´ë³´ì„¸ìš”!"
                ]
            },
            good: {
                icon: "ğŸ“ˆ",
                title: "ì¢‹ì€ í•™ìŠµ íë¦„!",
                stars: "â­â­â­â­",
                color: "from-green-400 to-blue-500",
                bgColor: "rgba(76, 175, 80, 0.1)",
                advice: [
                    "ê¾¸ì¤€í•œ ë³µìŠµì´ í° íš¨ê³¼ë¥¼ ê°€ì ¸ì˜¬ ê²ƒì…ë‹ˆë‹¤",
                    "ê³„íšì„ ì„¸ì›Œ ì²´ê³„ì ìœ¼ë¡œ ê³µë¶€í•˜ì„¸ìš”",
                    "ë…¸íŠ¸ ì •ë¦¬ê°€ íŠ¹íˆ ì˜ ë  ê²ƒì…ë‹ˆë‹¤",
                    "ì¹œêµ¬ì™€ í•¨ê»˜ ê³µë¶€í•˜ë©´ ë”ìš± íš¨ê³¼ì ì…ë‹ˆë‹¤",
                    "ì‹œê°„ ê´€ë¦¬ê°€ í‰ì†Œë³´ë‹¤ ì˜ ë  ê²ƒì…ë‹ˆë‹¤",
                    "ë‹¨ê³„ë³„ë¡œ ì°¨ê·¼ì°¨ê·¼ ì§„í–‰í•˜ëŠ” ê²ƒì´ ì¢‹ì•„ìš”",
                    "ì˜¤ë‹µë…¸íŠ¸ ì •ë¦¬í•˜ê¸°ì— ìµœì ì˜ ë‚ ì…ë‹ˆë‹¤",
                    "ì—¬ëŸ¬ ê³¼ëª©ì„ ê³¨ê³ ë£¨ ê³µë¶€í•˜ì„¸ìš”"
                ],
                studyTips: [
                    "í¬ëª¨ë„ë¡œ ê¸°ë²•(25ë¶„ ì§‘ì¤‘ + 5ë¶„ íœ´ì‹)ì„ í™œìš©í•´ë³´ì„¸ìš”!",
                    "ì»¬ëŸ¬íœìœ¼ë¡œ ì¤‘ìš”í•œ ë¶€ë¶„ì„ í‘œì‹œí•´ë³´ì„¸ìš”!",
                    "ê³„íší‘œë¥¼ ë§Œë“¤ì–´ì„œ ì²´í¬í•˜ë©° ê³µë¶€í•´ë³´ì„¸ìš”!",
                    "ë°°ê²½ìŒì•…ì„ ë“¤ìœ¼ë©° ê³µë¶€í•˜ë©´ ë” íš¨ê³¼ì ì¼ ê±°ì˜ˆìš”!"
                ]
            },
            normal: {
                icon: "ğŸ“š",
                title: "í‰ë²”í•œ í•™ìŠµì¼",
                stars: "â­â­â­",
                color: "from-blue-400 to-purple-500",
                bgColor: "rgba(33, 150, 243, 0.1)",
                advice: [
                    "ê¸°ë³¸ê¸°ë¥¼ ë‹¤ì§€ëŠ” ë° ì§‘ì¤‘í•˜ì„¸ìš”",
                    "ë¬´ë¦¬í•˜ì§€ ë§ê³  ê¾¸ì¤€íˆ ê³µë¶€í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤",
                    "íœ´ì‹ê³¼ í•™ìŠµì˜ ê· í˜•ì„ ë§ì¶”ì„¸ìš”",
                    "ê°€ë²¼ìš´ ë³µìŠµìœ¼ë¡œ ì‹œì‘í•´ë³´ì„¸ìš”",
                    "ê¸°ì´ˆ ë¬¸ì œë¶€í„° ì°¨ê·¼ì°¨ê·¼ í’€ì–´ë³´ì„¸ìš”",
                    "ë¶€ë‹´ìŠ¤ëŸ½ì§€ ì•Šì€ ë¶„ëŸ‰ìœ¼ë¡œ ê³„íšì„ ì„¸ìš°ì„¸ìš”",
                    "í‰ì†Œ ì¢‹ì•„í•˜ëŠ” ê³¼ëª©ë¶€í„° ì‹œì‘í•˜ì„¸ìš”",
                    "ì¶©ë¶„í•œ ìˆ˜ë©´ê³¼ íœ´ì‹ì„ ì·¨í•˜ë©° ê³µë¶€í•˜ì„¸ìš”"
                ],
                studyTips: [
                    "ì˜¤ëŠ˜ì€ ê°€ë²¼ìš´ ë…ì„œë‚˜ ìš”ì•½ ì •ë¦¬ê°€ ì¢‹ê² ì–´ìš”!",
                    "ê¸°ë³¸ ê°œë… ìœ„ì£¼ë¡œ ì²œì²œíˆ ê³µë¶€í•´ë³´ì„¸ìš”!",
                    "ìŠ¤íŠ¸ë ˆì¹­ì„ ìì£¼ í•˜ë©° ê³µë¶€í•˜ì„¸ìš”!",
                    "ì¢‹ì•„í•˜ëŠ” ê°„ì‹ì„ ì¤€ë¹„í•´ì„œ ê³µë¶€í•´ë³´ì„¸ìš”!"
                ]
            },
            caution: {
                icon: "âš¡",
                title: "ì£¼ì˜ê°€ í•„ìš”í•œ í•™ìŠµì¼",
                stars: "â­â­",
                color: "from-yellow-500 to-orange-600",
                bgColor: "rgba(255, 152, 0, 0.1)",
                advice: [
                    "ì‚°ë§Œí•´ì§€ê¸° ì‰¬ìš°ë‹ˆ í™˜ê²½ì„ ì •ë¦¬í•˜ì„¸ìš”",
                    "ì§§ì€ ì‹œê°„ì´ë¼ë„ ì§‘ì¤‘í•´ì„œ ê³µë¶€í•˜ì„¸ìš”",
                    "ìŠ¤ë§ˆíŠ¸í°ì„ ë©€ë¦¬ ë‘ê³  ê³µë¶€í•˜ì„¸ìš”",
                    "ê³„íšì„ ë‹¨ìˆœí•˜ê²Œ ì„¸ìš°ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤",
                    "í•œ ë²ˆì— í•œ ê³¼ëª©ë§Œ ì§‘ì¤‘í•˜ì„¸ìš”",
                    "ì¡°ìš©í•œ ì¥ì†Œì—ì„œ ê³µë¶€í•˜ëŠ” ê²ƒì´ ì¢‹ì•„ìš”",
                    "ë³µì¡í•œ ë‚´ìš©ë³´ë‹¤ ê°„ë‹¨í•œ ê²ƒë¶€í„° ì‹œì‘í•˜ì„¸ìš”",
                    "ì¹œêµ¬ë“¤ê³¼ì˜ ì¡ë‹´ì€ ì ì‹œ ë¯¸ë¤„ë‘ì„¸ìš”"
                ],
                studyTips: [
                    "ì˜¤ëŠ˜ì€ í•œ ê³¼ëª©ì—ë§Œ ì§‘ì¤‘í•´ë³´ì„¸ìš”!",
                    "íƒ€ì´ë¨¸ë¥¼ ì„¤ì •í•´ì„œ ì§§ê²Œ ì§§ê²Œ ê³µë¶€í•´ë³´ì„¸ìš”!",
                    "í•¸ë“œí°ì„ ë‹¤ë¥¸ ë°©ì— ë‘ê³  ê³µë¶€í•˜ì„¸ìš”!",
                    "ê°„ë‹¨í•œ ë¬¸ì œë¶€í„° ì°¨ê·¼ì°¨ê·¼ í’€ì–´ë³´ì„¸ìš”!"
                ]
            },
            challenging: {
                icon: "ğŸ§ ",
                title: "ì§‘ì¤‘ë ¥ í•„ìš”í•œ ë‚ ",
                stars: "â­â­",
                color: "from-purple-400 to-pink-500",
                bgColor: "rgba(156, 39, 176, 0.1)",
                advice: [
                    "ì–´ë ¤ìš´ ë‚´ìš©ì€ í”¼í•˜ê³  ì‰¬ìš´ ê²ƒë¶€í„° ì‹œì‘í•˜ì„¸ìš”",
                    "ì¹œêµ¬ë‚˜ ì„ ìƒë‹˜ê³¼ í•¨ê»˜ ê³µë¶€í•˜ë©´ ë„ì›€ì´ ë  ê²ƒì…ë‹ˆë‹¤",
                    "ì¶©ë¶„í•œ íœ´ì‹ì„ ì·¨í•˜ë©° ê³µë¶€í•˜ì„¸ìš”",
                    "ë¬´ë¦¬í•˜ì§€ ë§ê³  ê¸°ë³¸ ê°œë…ë§Œ ì ê²€í•´ë³´ì„¸ìš”",
                    "í˜¼ì í•˜ê¸° ì–´ë ¤ìš´ ë‚´ìš©ì€ ë„ì›€ì„ ìš”ì²­í•˜ì„¸ìš”",
                    "ì™„ë²½ì„ ì¶”êµ¬í•˜ê¸°ë³´ë‹¤ ì´í•´ì— ì¤‘ì ì„ ë‘ì„¸ìš”",
                    "ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ë°›ì§€ ë§ê³  ì—¬ìœ ë¡­ê²Œ ì ‘ê·¼í•˜ì„¸ìš”",
                    "í‰ì†Œë³´ë‹¤ íœ´ì‹ ì‹œê°„ì„ ëŠ˜ë ¤ê°€ë©° ê³µë¶€í•˜ì„¸ìš”"
                ],
                studyTips: [
                    "ì˜¤ëŠ˜ì€ ë³µìŠµ ìœ„ì£¼ë¡œ ê°€ë³ê²Œ ê³µë¶€í•˜ì„¸ìš”!",
                    "ì¹œêµ¬ì™€ í•¨ê»˜ ê³µë¶€í•˜ë©´ ë” ì¢‹ì„ ê±°ì˜ˆìš”!",
                    "ì–´ë ¤ìš´ ë¬¸ì œëŠ” ë‚´ì¼ë¡œ ë¯¸ë¤„ë„ ê´œì°®ì•„ìš”!",
                    "ì¶©ë¶„í•œ íœ´ì‹ì„ ì·¨í•˜ë©° ì²œì²œíˆ í•˜ì„¸ìš”!"
                ]
            },
            review: {
                icon: "ğŸ”„",
                title: "ë³µìŠµì˜ ë‚ !",
                stars: "â­â­â­",
                color: "from-indigo-400 to-purple-600",
                bgColor: "rgba(103, 58, 183, 0.1)",
                advice: [
                    "ìƒˆë¡œìš´ ë‚´ìš©ë³´ë‹¤ ê¸°ì¡´ ë‚´ìš© ì •ë¦¬ì— ì§‘ì¤‘í•˜ì„¸ìš”",
                    "ì˜¤ë‹µë…¸íŠ¸ë¥¼ ì ê²€í•˜ê¸° ì¢‹ì€ ë‚ ì…ë‹ˆë‹¤",
                    "í—·ê°ˆë¦¬ëŠ” ê°œë…ë“¤ì„ ë‹¤ì‹œ ì •ë¦¬í•´ë³´ì„¸ìš”",
                    "ì´ì „ì— ì–´ë ¤ì› ë˜ ë¬¸ì œë“¤ì„ ë‹¤ì‹œ í’€ì–´ë³´ì„¸ìš”",
                    "ì§€ë‚œì£¼ ë°°ìš´ ë‚´ìš©ì„ í›‘ì–´ë³´ì„¸ìš”",
                    "ì•”ê¸°í–ˆë˜ ë‚´ìš©ë“¤ì„ ë‹¤ì‹œ ì ê²€í•´ë³´ì„¸ìš”",
                    "ê°œë… ê°„ì˜ ì—°ê²°ê³ ë¦¬ë¥¼ ì°¾ì•„ë³´ì„¸ìš”",
                    "ì‹œí—˜ ë²”ìœ„ë¥¼ ì „ì²´ì ìœ¼ë¡œ ì •ë¦¬í•´ë³´ì„¸ìš”"
                ],
                studyTips: [
                    "ì§€ë‚œì£¼ ë°°ìš´ ë‚´ìš©ì„ í›‘ì–´ë³´ëŠ” ì‹œê°„ì„ ê°€ì ¸ë³´ì„¸ìš”!",
                    "ì˜¤ë‹µë…¸íŠ¸ë¥¼ êº¼ë‚´ì„œ ë‹¤ì‹œ í’€ì–´ë³´ì„¸ìš”!",
                    "í˜•ê´‘íœìœ¼ë¡œ ì¤‘ìš”í•œ ë¶€ë¶„ì„ ë‹¤ì‹œ ì²´í¬í•´ë³´ì„¸ìš”!",
                    "ì¹œêµ¬ì™€ ì„œë¡œ ë¬¸ì œë¥¼ ë‚´ë©° ë³µìŠµí•´ë³´ì„¸ìš”!"
                ]
            },
            creative: {
                icon: "ğŸ¨",
                title: "ì°½ì˜ì  í•™ìŠµì¼!",
                stars: "â­â­â­â­",
                color: "from-pink-400 to-red-500",
                bgColor: "rgba(233, 30, 99, 0.1)",
                advice: [
                    "ë§ˆì¸ë“œë§µìœ¼ë¡œ ê°œë…ì„ ì •ë¦¬í•´ë³´ì„¸ìš”",
                    "ë‹¤ì–‘í•œ í•™ìŠµ ë°©ë²•ì„ ì‹œë„í•´ë³´ì„¸ìš”",
                    "ê·¸ë¦¼ì´ë‚˜ ë„í‘œë¥¼ í™œìš©í•œ ì •ë¦¬ê°€ íš¨ê³¼ì ì…ë‹ˆë‹¤",
                    "ì°½ì˜ì ì¸ ë¬¸ì œ í•´ê²° ë°©ë²•ì„ ì°¾ì•„ë³´ì„¸ìš”",
                    "ìŠ¤í† ë¦¬í…”ë§ìœ¼ë¡œ ê°œë…ì„ ê¸°ì–µí•´ë³´ì„¸ìš”",
                    "ìƒ‰ê¹”ê³¼ ê¸°í˜¸ë¥¼ í™œìš©í•´ì„œ ë…¸íŠ¸ë¥¼ ì •ë¦¬í•˜ì„¸ìš”",
                    "ì•”ê¸°ë³´ë‹¤ëŠ” ì´ë¯¸ì§€ë¡œ ì—°ìƒí•´ì„œ ê¸°ì–µí•˜ì„¸ìš”",
                    "ìƒˆë¡œìš´ í•™ìŠµ ë„êµ¬ë‚˜ ì•±ì„ í™œìš©í•´ë³´ì„¸ìš”"
                ],
                studyTips: [
                    "ì˜¤ëŠ˜ì€ ìƒ‰ê¹” íœìœ¼ë¡œ ì˜ˆì˜ê²Œ ë…¸íŠ¸ ì •ë¦¬ë¥¼ í•´ë³´ì„¸ìš”!",
                    "ë§ˆì¸ë“œë§µì„ ê·¸ë ¤ê°€ë©° ê³µë¶€í•´ë³´ì„¸ìš”!",
                    "ê·¸ë¦¼ì´ë‚˜ ë‹¤ì´ì–´ê·¸ë¨ì„ ê·¸ë ¤ë³´ì„¸ìš”!",
                    "ë…¸ë˜ë‚˜ ë¦¬ë“¬ì— ë§ì¶°ì„œ ì•”ê¸°í•´ë³´ì„¸ìš”!"
                ]
            },
            motivated: {
                icon: "ğŸ”¥",
                title: "ë™ê¸°ë¶€ì—¬ ìµœê³ ì¡°!",
                stars: "â­â­â­â­â­",
                color: "from-red-500 to-pink-600",
                bgColor: "rgba(244, 67, 54, 0.1)",
                advice: [
                    "ëª©í‘œë¥¼ ë†’ê²Œ ì„¤ì •í•˜ê³  ë„ì „í•´ë³´ì„¸ìš”",
                    "í‰ì†Œ ì–´ë ¤ì›Œí–ˆë˜ ê³¼ëª©ì— ì§‘ì¤‘í•˜ì„¸ìš”",
                    "ì¥ê¸°ì ì¸ í•™ìŠµ ê³„íšì„ ì„¸ìš°ê¸° ì¢‹ì€ ë‚ ì…ë‹ˆë‹¤",
                    "ìì‹ ê°ì„ ê°€ì§€ê³  ê³µë¶€ì— ì„í•˜ì„¸ìš”",
                    "ë„ì „ì ì¸ ë¬¸ì œë“¤ì„ ì ê·¹ì ìœ¼ë¡œ í’€ì–´ë³´ì„¸ìš”",
                    "ìƒˆë¡œìš´ í•™ìŠµ ëª©í‘œë¥¼ ì„¤ì •í•´ë³´ì„¸ìš”",
                    "ê²½ìŸ ì˜ì‹ì„ í™œìš©í•´ì„œ ê³µë¶€í•´ë³´ì„¸ìš”",
                    "ì„±ì·¨ê°ì„ ëŠë‚„ ìˆ˜ ìˆëŠ” ì‘ì€ ëª©í‘œë“¤ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”"
                ],
                studyTips: [
                    "ì˜¤ëŠ˜ì€ ê¿ˆê³¼ ëª©í‘œë¥¼ ë‹¤ì‹œ í•œë²ˆ ë˜ìƒˆê²¨ë³´ì„¸ìš”!",
                    "ê°€ì¥ ì–´ë ¤ìš´ ë¬¸ì œì§‘ì„ ë„ì „í•´ë³´ì„¸ìš”!",
                    "ê³µë¶€ ì‹œê°„ì„ í‰ì†Œë³´ë‹¤ ëŠ˜ë ¤ë³´ì„¸ìš”!",
                    "ì¹œêµ¬ë“¤ê³¼ ê³µë¶€ ê²½ìŸì„ í•´ë³´ì„¸ìš”!"
                ]
            },
            calm: {
                icon: "ğŸ§˜",
                title: "ì°¨ë¶„í•œ í•™ìŠµì¼",
                stars: "â­â­â­",
                color: "from-teal-400 to-blue-600",
                bgColor: "rgba(0, 150, 136, 0.1)",
                advice: [
                    "ì°¨ë¶„í•˜ê²Œ í•œ ë‹¨ê³„ì”© ê³µë¶€í•´ë‚˜ê°€ì„¸ìš”",
                    "ëª…ìƒì´ë‚˜ ê¹Šì€ í˜¸í¡ìœ¼ë¡œ ë§ˆìŒì„ ê°€ë¼ì•‰íˆì„¸ìš”",
                    "ì¡°ìš©í•œ í™˜ê²½ì—ì„œ ì§‘ì¤‘ë ¥ì„ ë°œíœ˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤",
                    "ìŠ¤íŠ¸ë ˆìŠ¤ ì—†ì´ ì—¬ìœ ë¡­ê²Œ ê³µë¶€í•˜ì„¸ìš”",
                    "ëŠê¸‹í•˜ê²Œ ì‹œê°„ì„ ê°€ì§€ê³  ì´í•´í•˜ë©° ê³µë¶€í•˜ì„¸ìš”",
                    "ë§ˆìŒì˜ í‰ì •ì„ ìœ ì§€í•˜ë©° í•™ìŠµì— ì„í•˜ì„¸ìš”",
                    "ê¸‰í•˜ê²Œ ì„œë‘ë¥´ì§€ ë§ê³  ì°¨ê·¼ì°¨ê·¼ ì§„í–‰í•˜ì„¸ìš”",
                    "ë‚´ë©´ì˜ ì§‘ì¤‘ë ¥ì„ ëŒì–´ì˜¬ë ¤ë³´ì„¸ìš”"
                ],
                studyTips: [
                    "ì¡°ìš©í•œ ìŒì•…ì„ ë“¤ìœ¼ë©° ê³µë¶€í•´ë³´ì„¸ìš”!",
                    "ê¹Šì€ í˜¸í¡ì„ í•˜ë©° ë§ˆìŒì„ ì°¨ë¶„íˆ í•˜ì„¸ìš”!",
                    "ì²œì²œíˆ ì½ê³  ì´í•´í•˜ë©° ê³µë¶€í•´ë³´ì„¸ìš”!",
                    "ëª…ìƒì„ 5ë¶„ í•˜ê³  ê³µë¶€ë¥¼ ì‹œì‘í•´ë³´ì„¸ìš”!"
                ]
            }
        };
        
        // ì „ì²´ í–‰ìš´ì˜ ê³¼ëª© ëª©ë¡
        var allLuckySubjects = [
            "êµ­ì–´", "ë…ì„œ(ë¹„ë¬¸í•™)", "ë¬¸í•™", "í™”ë²•ê³¼ ì‘ë¬¸", "ì–¸ì–´ì™€ ë§¤ì²´", 
            "ìˆ˜í•™1", "ìˆ˜í•™2", "ë¯¸ì ë¶„", "í™•ë¥ ê³¼ í†µê³„", "ê¸°í•˜", 
            "ì˜ì–´", "ì˜ì–´ë“£ê¸°", "í•œêµ­ì‚¬", "ê³¼íƒ", "ì‚¬íƒ", 
            "ë…ì„œ(ì¸ë¬¸)", "ë…ì„œ(ê³¼í•™)", "ë…ì„œ(ì‚¬íšŒ)", 
            "í˜„ëŒ€ì‹œ", "í˜„ëŒ€ì†Œì„¤", "ê³ ì „ì‹œ", "ê³ ì „ì†Œì„¤",
            "ëª¨ë“  ê³¼ëª© ë³µìŠµ", "ëª¨ì˜ê³ ì‚¬", "ì˜ì–´ë‹¨ì–´", "ì•”ê¸°ê³¼ëª©"
        ];
        
        // í•™ì—… ìš´ì„¸ ê³„ì‚° í•¨ìˆ˜
        function calculateStudyFortune(name) {
            if (!name) return null;
            
            var sum = 0;
            for (var i = 0; i < name.length; i++) {
                sum += name.charCodeAt(i);
            }
            
            var today = new Date();
            var dateSum = today.getDate() + today.getMonth() + today.getFullYear();
            sum += dateSum;
            
            var fortuneTypes = Object.keys(fortuneData);
            var index = sum % fortuneTypes.length;
            var type = fortuneTypes[index];
            
            // ëœë¤í•˜ê²Œ ì¡°ì–¸ 3ê°œ, íŒ 1ê°œ, í–‰ìš´ì˜ ê³¼ëª© 2ê°œ, í–‰ìš´ì˜ ë²ˆí˜¸ 1ê°œ ì„ íƒ
            var selectedAdvice = fortuneData[type].advice.slice().sort(() => 0.5 - Math.random()).slice(0, 3);
            var selectedTip = fortuneData[type].studyTips[Math.floor(Math.random() * fortuneData[type].studyTips.length)];
            var selectedSubjects = allLuckySubjects.slice().sort(() => 0.5 - Math.random()).slice(0, 2);
            var luckyNumber = Math.floor(Math.random() * 5) + 1; // 1~5 ì¤‘ ëœë¤
            
            return {
                type: type,
                data: {
                    ...fortuneData[type],
                    selectedAdvice: selectedAdvice,
                    selectedTip: selectedTip,
                    selectedSubjects: selectedSubjects,
                    luckyNumber: luckyNumber
                }
            };
        }
        
        // ìš´ì„¸ í‘œì‹œ í•¨ìˆ˜
        function displayStudyFortune(name) {
            var fortune = calculateStudyFortune(name);
            if (!fortune) return '';
            
            return `
                <div class="ai-analysis" style="background: linear-gradient(135deg, ${fortune.data.bgColor}, ${fortune.data.bgColor}); color: #333; margin: 20px 0;">
                    <div class="ai-analysis-header">
                        <div class="ai-icon" style="background: ${fortune.data.bgColor}; color: #333;">
                            ${fortune.data.icon}
                        </div>
                        <div>
                            <h3 style="color: #333; font-size: 1.2em;">${name}ë‹˜ì˜ í•™ì—… ìš´ì„¸</h3>
                            <div style="font-size: 1.4em; font-weight: bold; margin-top: 6px;">
                                <span style="color: #333;">${fortune.data.title}</span>
                                <span style="color: #FFD700; text-shadow: 1px 1px 2px rgba(0,0,0,0.3); margin-left: 8px;">${fortune.data.stars}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="ai-content">
                        <div style="background: rgba(255, 255, 255, 0.3); border-radius: 10px; padding: 12px; margin: 10px 0;">
                            <h4 style="color: #444; margin-bottom: 10px;">ğŸ’¡ ì˜¤ëŠ˜ì˜ í•™ìŠµ ì¡°ì–¸</h4>
                            <ul style="margin: 0; padding-left: 20px; color: #555;">
                                ${fortune.data.selectedAdvice.map(advice => `<li style="margin-bottom: 5px;">${advice}</li>`).join('')}
                            </ul>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 15px 0;">
                            <div style="background: rgba(255, 255, 255, 0.3); border-radius: 12px; padding: 15px;">
                                <h4 style="color: #444; margin-bottom: 10px;">ğŸ“š í–‰ìš´ì˜ ê³¼ëª©</h4>
                                <div style="display: flex; flex-direction: column; gap: 8px;">
                                    ${fortune.data.selectedSubjects.map(subject => 
                                        `<span style="background: linear-gradient(45deg, #667eea, #764ba2); color: white; padding: 6px 12px; border-radius: 15px; font-size: 0.9em; font-weight: bold; text-align: center;">${subject}</span>`
                                    ).join('')}
                                </div>
                            </div>
                            
                            <div style="background: rgba(255, 255, 255, 0.3); border-radius: 12px; padding: 15px;">
                                <h4 style="color: #444; margin-bottom: 10px;">ğŸ€ í–‰ìš´ì˜ ë²ˆí˜¸</h4>
                                <div style="display: flex; justify-content: center; align-items: center; height: 60px;">
                                    <span style="
                                        background: linear-gradient(45deg, #ff6b6b, #feca57); 
                                        color: white; 
                                        font-size: 2em; 
                                        font-weight: bold; 
                                        width: 50px; 
                                        height: 50px; 
                                        border-radius: 50%; 
                                        display: flex; 
                                        align-items: center; 
                                        justify-content: center;
                                        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
                                    ">${fortune.data.luckyNumber}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div style="background: rgba(255, 255, 255, 0.3); border-radius: 12px; padding: 15px; margin: 15px 0;">
                            <h4 style="color: #444; margin-bottom: 10px;">ğŸ¯ ì˜¤ëŠ˜ì˜ í•™ìŠµ íŒ</h4>
                            <p style="color: #444; font-weight: 500; margin: 0; font-style: italic;">
                                "${fortune.data.selectedTip}"
                            </p>
                        </div>
                        
                        <div style="font-size: 0.85em; color: #666; text-align: center; margin-top: 10px;">
                            ğŸ’¡ ìš´ì„¸ëŠ” ì¬ë¯¸ë¡œë§Œ ì°¸ê³ í•˜ì„¸ìš”. ì§„ì§œ ì¤‘ìš”í•œ ê±´ ê¾¸ì¤€í•œ ë…¸ë ¥ì…ë‹ˆë‹¤!
                            <br><br>
                            <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
                                <a href="https://www.instagram.com/swwweet.daekun/" target="_blank" style="
                                    display: inline-flex; 
                                    align-items: center; 
                                    gap: 8px; 
                                    background: linear-gradient(45deg, #405DE6, #5851DB, #833AB4, #C13584, #E1306C, #FD1D1D, #F56040, #F77737, #FCAF45, #FFDC80);
                                    color: white; 
                                    text-decoration: none; 
                                    padding: 22px 42px; 
                                    border-radius: 27px; 
                                    font-weight: bold; 
                                    font-size: 1.2em;
                                    transition: transform 0.2s;
                                " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                                    ğŸ“¸ ê´€ë¦¬ì ëŒ€ê±´T Instagram
                                </a>
                                <a href="https://jdmedu.github.io/university-predictor/" target="_blank" style="
                                    display: inline-flex; 
                                    align-items: center; 
                                    gap: 8px; 
                                    background: linear-gradient(45deg, #4CAF50, #45a049, #66BB6A, #81C784);
                                    color: white; 
                                    text-decoration: none; 
                                    padding: 22px 42px; 
                                    border-radius: 27px; 
                                    font-weight: bold; 
                                    font-size: 1.2em;
                                    transition: transform 0.2s;
                                " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                                    ğŸ“ ëŒ€ì… í•©ê²© ì˜ˆì¸¡ ì‹œìŠ¤í…œ
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // ğŸ“Š í†µê³„ ê³„ì‚° í•¨ìˆ˜
        function calculateStatistics(student) {
            var grades = student.grades;
            var gradeKeys = Object.keys(grades);
            
            if (gradeKeys.length === 0) return null;
            
            var scores = [];
            var gradeValues = [];
            var recentScores = [];
            
            gradeKeys.forEach(function(testName) {
                var gradeData = grades[testName];
                if (gradeData.score) scores.push(parseInt(gradeData.score));
                if (gradeData.grade) gradeValues.push(parseInt(gradeData.grade));
            });
            
            // ìµœê·¼ 3íšŒ ì ìˆ˜
            recentScores = scores.slice(-3);
            
            var avgScore = scores.length > 0 ? Math.round(scores.reduce((a, b) => a + b) / scores.length) : 0;
            var avgGrade = gradeValues.length > 0 ? Math.round(gradeValues.reduce((a, b) => a + b) / gradeValues.length * 10) / 10 : 0;
            var bestScore = scores.length > 0 ? Math.max(...scores) : 0;
            var bestGrade = gradeValues.length > 0 ? Math.min(...gradeValues) : 0;
            var latestScore = scores.length > 0 ? scores[scores.length - 1] : 0;
            
            // ì„±ì  ë³€í™” ê³„ì‚°
            var scoreChange = 0;
            if (scores.length >= 2) {
                var recent2 = scores.slice(-2);
                scoreChange = recent2[1] - recent2[0];
            }
            
            // ìƒìœ„ í¼ì„¼íŠ¸ ê³„ì‚° (ì„ì˜ ê³„ì‚°)
            var percentile = Math.max(1, Math.min(99, Math.round((100 - avgGrade * 10) + Math.random() * 10)));
            
            return {
                avgScore: avgScore,
                avgGrade: avgGrade,
                bestScore: bestScore,
                bestGrade: bestGrade,
                latestScore: latestScore,
                scoreChange: scoreChange,
                percentile: percentile,
                testCount: gradeKeys.length,
                totalTests: window.discoveredTestSheets ? window.discoveredTestSheets.length : 12
            };
        }
        
        // ë¶„ì‚° ê³„ì‚° í—¬í¼ í•¨ìˆ˜
        function calculateVariance(numbers) {
            var mean = numbers.reduce((a, b) => a + b) / numbers.length;
            var variance = numbers.reduce((sum, num) => sum + Math.pow(num - mean, 2), 0) / numbers.length;
            return variance;
        }
        
       // ğŸ† í™•ì¥ëœ ë±ƒì§€ ì‹œìŠ¤í…œ (43ê°œ)
function generateAchievementBadges(student, stats) {
    var badges = [];
    var grades = student.grades;
    var gradeKeys = Object.keys(grades);
    
    if (!stats) return badges;
    
    // ì ìˆ˜ì™€ ë“±ê¸‰ ë°ì´í„° ì¤€ë¹„
    var scores = [];
    var gradeValues = [];
    var subjectScores = {};
    var subjectRatios = {}; // âœ… ì—¬ê¸°ì„œ ì´ˆê¸°í™”
    
    gradeKeys.forEach(function(testName) {
        var gradeData = grades[testName];
        if (gradeData.score) scores.push(parseInt(gradeData.score));
        if (gradeData.grade) gradeValues.push(parseInt(gradeData.grade));
        
        // ê³¼ëª©ë³„ ì ìˆ˜ ìˆ˜ì§‘
        if (gradeData.details) {
            Object.keys(gradeData.details).forEach(function(subject) {
                if (!subjectScores[subject]) subjectScores[subject] = [];
                subjectScores[subject].push(gradeData.details[subject]);
            });
        }
        
        // âœ… ê³¼ëª©ë³„ ë¹„ìœ¨ ìˆ˜ì§‘ ì¶”ê°€
        if (gradeData.ratios) {
            Object.keys(gradeData.ratios).forEach(function(subject) {
                if (!subjectRatios[subject]) subjectRatios[subject] = [];
                subjectRatios[subject].push(gradeData.ratios[subject]);
            });
        }
    });
    
    // ì—°ì† ìƒìŠ¹/í•˜ë½ ì²´í¬
    var consecutiveUp = 0;
    var consecutiveDown = 0;
    var maxConsecutiveUp = 0;
    var maxConsecutiveDown = 0;
    
    for (var i = 1; i < scores.length; i++) {
        if (scores[i] > scores[i-1]) {
            consecutiveUp++;
            consecutiveDown = 0;
            maxConsecutiveUp = Math.max(maxConsecutiveUp, consecutiveUp);
        } else if (scores[i] < scores[i-1]) {
            consecutiveDown++;
            consecutiveUp = 0;
            maxConsecutiveDown = Math.max(maxConsecutiveDown, consecutiveDown);
        } else {
            consecutiveUp = 0;
            consecutiveDown = 0;
        }
    }
    
    // ê³¼ëª©ë³„ ê°•ì  ì²´í¬
    var strongSubjects = 0;
    var excellentSubjects = 0;
    Object.keys(subjectScores).forEach(function(subject) {
        var avg = subjectScores[subject].reduce((a, b) => a + b) / subjectScores[subject].length;
        if (avg >= 80) strongSubjects++;
        if (avg >= 90) excellentSubjects++;
    });
    
// ğŸ† ë±ƒì§€ ì¡°ê±´ ì²´í¬ (43ê°œ ë±ƒì§€, ì¤‘ë³µ ê°€ëŠ¥)

// 1. ë“±ê¸‰ ê´€ë ¨ ë±ƒì§€ (5ê°œ)
if (stats.bestGrade === 1) {
    badges.push({ icon: "ğŸ‘‘", text: "1ë“±ê¸‰ ë‹¬ì„±", type: "grade", isNew: true });
}
if (stats.bestGrade <= 2) {
    badges.push({ icon: "ğŸ†", text: "ìƒìœ„ë“±ê¸‰ ë‹¬ì„±", type: "grade", isNew: false });
}
if (stats.bestGrade <= 3) {
    badges.push({ icon: "ğŸ¥‰", text: "3ë“±ê¸‰ ì´ë‚´", type: "grade", isNew: false });
}
if (stats.avgGrade <= 2.5) {
    badges.push({ icon: "ğŸª", text: "ìš°ìˆ˜í•œ ë“±ê¸‰", type: "grade", isNew: false });
}
if (stats.avgGrade <= 1.5) {
    badges.push({ icon: "ğŸ–ï¸", text: "ìµœìƒìœ„ ë“±ê¸‰", type: "grade", isNew: true });
}

// 2. ì ìˆ˜ ê´€ë ¨ ë±ƒì§€ (4ê°œ)
if (stats.bestScore >= 95) {
    badges.push({ icon: "ğŸ’", text: "95ì  ì´ìƒ", type: "score", isNew: true });
}
if (stats.avgScore >= 85) {
    badges.push({ icon: "ğŸŒŸ", text: "ê³ ë“ì ì", type: "score", isNew: false });
}
if (stats.bestScore >= 100) {
    badges.push({ icon: "ğŸ¯", text: "ë§Œì  ë‹¬ì„±", type: "score", isNew: true });
}
if (stats.avgScore >= 90) {
    badges.push({ icon: "âœ¨", text: "ìš°ìˆ˜í•œ í‰ê· ", type: "score", isNew: false });
}

// 3. ì„±ì  ë³€í™” ë±ƒì§€ (3ê°œ)
if (maxConsecutiveUp >= 2) {
    badges.push({ icon: "ğŸ”¥", text: "ì—°ì† ìƒìŠ¹", type: "trend", isNew: true });
}
if (maxConsecutiveUp >= 3) {
    badges.push({ icon: "ğŸš€", text: "3ì—°ì† ìƒìŠ¹", type: "trend", isNew: true });
}
if (maxConsecutiveUp >= 4) {
    badges.push({ icon: "ğŸŒªï¸", text: "4ì—°ì† í­í’ ìƒìŠ¹", type: "trend", isNew: true });
}

// 4. ì ìˆ˜ ê°œì„  ë±ƒì§€ (3ê°œ) - ìµœê·¼ ë³€í™”ëŸ‰
if (stats.scoreChange >= 15) {
    badges.push({ icon: "ğŸ“ˆ", text: "ëŒ€í­ ìƒìŠ¹", type: "improvement", isNew: true });
}
if (stats.scoreChange >= 25) {
    badges.push({ icon: "âš¡", text: "í­ë°œì  ìƒìŠ¹", type: "improvement", isNew: true });
}
if (stats.scoreChange >= 35) {
    badges.push({ icon: "ğŸ†", text: "ê¸°ì ì˜ ìƒìŠ¹", type: "improvement", isNew: true });
}

// 5. ì¶œì„ ë° ì„±ì‹¤ì„± ë±ƒì§€ (3ê°œ)
if (stats.testCount >= 5) {
    badges.push({ icon: "â­", text: "ì„±ì‹¤í•œ ì‘ì‹œ", type: "attendance", isNew: false });
}
if (stats.testCount >= 8) {
    badges.push({ icon: "ğŸ’ª", text: "ê¾¸ì¤€í•œ ë„ì „", type: "attendance", isNew: false });
}
if (stats.testCount === stats.totalTests) {
    badges.push({ icon: "ğŸ…", text: "ì™„ë²½í•œ ì¶œì„", type: "attendance", isNew: true });
}

// 7. ì•ˆì •ì„± ë±ƒì§€ (2ê°œ)
if (scores.length >= 3) {
    var scoreVariance = calculateVariance(scores);
    if (scoreVariance < 50) {
        badges.push({ icon: "ğŸ›¡ï¸", text: "ì•ˆì •ì  ì„±ì·¨", type: "stability", isNew: false });
    }
    if (scoreVariance < 25) {
        badges.push({ icon: "ğŸ°", text: "ì™„ë²½í•œ ì•ˆì •", type: "stability", isNew: true });
    }
}

// 1ë“±ê¸‰ ë§ˆìŠ¤í„° ë±ƒì§€ (ë“±ê¸‰ ê´€ë ¨ ë±ƒì§€ ì„¹ì…˜ì— ì¶”ê°€)
    var consecutiveGrade1 = 0;
    var maxConsecutiveGrade1 = 0;
    for (var i = 0; i < gradeValues.length; i++) {
        if (gradeValues[i] === 1) {
            consecutiveGrade1++;
            maxConsecutiveGrade1 = Math.max(maxConsecutiveGrade1, consecutiveGrade1);
        } else {
            consecutiveGrade1 = 0;
        }
    }
    
    if (maxConsecutiveGrade1 >= 5) {
        badges.push({ icon: "ğŸ‘‘", text: "1ë“±ê¸‰ ë§ˆìŠ¤í„°", type: "grade", isNew: true });
    }

// 9. íšŒë³µ/ì„±ì¥ ë±ƒì§€ (2ê°œ)
if (maxConsecutiveDown >= 2 && consecutiveUp >= 2) {
    badges.push({ icon: "ğŸ”„", text: "ê·¹ì  íšŒë³µ", type: "recovery", isNew: true });
}
if (scores.length >= 5 && scores[scores.length-1] > scores[0] + 20) {
    badges.push({ icon: "ğŸ“Š", text: "ì¥ê¸° ì„±ì¥", type: "recovery", isNew: false });
}

// ========== ğŸ†• ìƒˆë¡œ ì¶”ê°€ëœ ë±ƒì§€ë“¤ ==========

// 10. í•œ ë²ˆì˜ í° ì í”„ ë±ƒì§€ (3ê°œ)
var maxSingleJump = 0;
if (scores.length >= 2) {
    for (var i = 1; i < scores.length; i++) {
        var jump = scores[i] - scores[i-1];
        maxSingleJump = Math.max(maxSingleJump, jump);
    }
    
    // í•œ ë²ˆì˜ í° ì í”„ ë±ƒì§€
    if (maxSingleJump >= 35) {
        badges.push({ icon: "ğŸŒˆ", text: "ë†€ë¼ìš´ ì í”„", type: "single-jump", isNew: true });
    }
    if (maxSingleJump >= 25) {
        badges.push({ icon: "ğŸ¢", text: "í° ë„ì•½", type: "single-jump", isNew: false });
    }
    if (maxSingleJump >= 15) {
        badges.push({ icon: "ğŸ“", text: "ì„±ê³µì  ì í”„", type: "single-jump", isNew: false });
    }
}

// 11. ì „ì²´ ì„±ì¥ ë±ƒì§€ (2ê°œ)
if (scores.length >= 3) {
    // ì—­ì „ ìŠ¤í† ë¦¬ ë±ƒì§€ (í•œë²ˆ ë§ì´ ë–¨ì–´ì¡Œë‹¤ê°€ ë‹¤ì‹œ ì˜¬ë¼ì˜¨ ê²½ìš°)
    var minScore = Math.min(...scores);
    var maxScore = Math.max(...scores);
    var minIndex = scores.indexOf(minScore);
    var maxIndex = scores.lastIndexOf(maxScore);
    
    if (minIndex < maxIndex && (maxScore - minScore) >= 40) {
        badges.push({ icon: "ğŸ”„", text: "ì—­ì „ì˜ ìŠ¤í† ë¦¬", type: "total-growth", isNew: true });
    }
    
    // ì•ˆì •ì  ìƒìŠ¹ (ì „ì²´ì ìœ¼ë¡œ ê¾¸ì¤€íˆ ì˜¤ë¦„)
    var upwardCount = 0;
    for (var i = 1; i < scores.length; i++) {
        if (scores[i] >= scores[i-1]) upwardCount++;
    }
    var upwardRatio = upwardCount / (scores.length - 1);
    
    var firstScore = scores[0];
    var lastScore = scores[scores.length - 1];
    var totalChange = lastScore - firstScore;
    
    if (upwardRatio >= 0.8 && totalChange >= 15) {
        badges.push({ icon: "ğŸš€", text: "ê¾¸ì¤€í•œ ìƒìŠ¹ì„¸", type: "total-growth", isNew: false });
    }
}

   // 12. ê³¼ëª©ë³„ ë§ˆìŠ¤í„° ë±ƒì§€ (9ê°œ + 3ê°œ ì¢…í•©)
    var subjectMasters = [];
    
    var koreanSubjects = [
        'ë…ì„œ(ì¸ë¬¸ ì´ë¡ )', 'ë…ì„œ(ì‚¬íšŒ)', 'ë…ì„œ(ê³¼í•™)',
        'ë¬¸í•™(í˜„ëŒ€ì‹œ)', 'ë¬¸í•™(í˜„ëŒ€ì†Œì„¤)', 'ë¬¸í•™(ê³ ì „ì‹œê°€)', 'ë¬¸í•™(ê³ ì „ì†Œì„¤)',
        'ì–¸ì–´ í™”ë²•', 'ë§¤ì²´ ì‘ë¬¸'
    ];
    
    koreanSubjects.forEach(function(targetSubject) {
        var subjectMapping = {
            'ë…ì„œ(ì¸ë¬¸ ì´ë¡ )': ['ë…ì„œ(ì¸ë¬¸ ì´ë¡ )', 'ë…ì„œ(ì¸ë¬¸ì´ë¡ )', 'ë…ì„œì¸ë¬¸', 'ì¸ë¬¸'],
            'ë…ì„œ(ì‚¬íšŒ)': ['ë…ì„œ(ì‚¬íšŒ)', 'ë…ì„œì‚¬íšŒ', 'ì‚¬íšŒ'],
            'ë…ì„œ(ê³¼í•™)': ['ë…ì„œ(ê³¼í•™)', 'ë…ì„œê³¼í•™', 'ê³¼í•™'],
            'ë¬¸í•™(í˜„ëŒ€ì‹œ)': ['ë¬¸í•™(í˜„ëŒ€ì‹œ)', 'ë¬¸í•™í˜„ëŒ€ì‹œ', 'í˜„ëŒ€ì‹œ', 'í˜„ì‹œ'],
            'ë¬¸í•™(í˜„ëŒ€ì†Œì„¤)': ['ë¬¸í•™(í˜„ëŒ€ì†Œì„¤)', 'ë¬¸í•™í˜„ëŒ€ì†Œì„¤', 'í˜„ëŒ€ì†Œì„¤', 'í˜„ì†Œ'],
            'ë¬¸í•™(ê³ ì „ì‹œê°€)': ['ë¬¸í•™(ê³ ì „ì‹œê°€)', 'ë¬¸í•™ê³ ì „ì‹œê°€', 'ê³ ì „ì‹œê°€', 'ê³ ì‹œ'],
            'ë¬¸í•™(ê³ ì „ì†Œì„¤)': ['ë¬¸í•™(ê³ ì „ì†Œì„¤)', 'ë¬¸í•™ê³ ì „ì†Œì„¤', 'ê³ ì „ì†Œì„¤', 'ê³ ì†Œ'],
            'ì–¸ì–´ í™”ë²•': ['ì–¸ì–´ í™”ë²•', 'ì–¸ì–´í™”ë²•', 'í™”ë²•'],
            'ë§¤ì²´ ì‘ë¬¸': ['ë§¤ì²´ ì‘ë¬¸', 'ë§¤ì²´ì‘ë¬¸', 'ì‘ë¬¸']
        };
        
        var possibleNames = subjectMapping[targetSubject] || [targetSubject];
        var matchedSubject = null;
        
        for (var actualSubject in subjectRatios) {
            for (var i = 0; i < possibleNames.length; i++) {
                if (actualSubject === possibleNames[i] || 
                    actualSubject.includes(possibleNames[i]) || 
                    possibleNames[i].includes(actualSubject)) {
                    matchedSubject = actualSubject;
                    break;
                }
            }
            if (matchedSubject) break;
        }
        
        if (matchedSubject && subjectRatios[matchedSubject]) {
        var ratios = subjectRatios[matchedSubject];
        
        // ì „ì²´ ì‹œí—˜ ì¤‘ ì—°ì†ëœ 4íšŒ 100% ë‹¬ì„± ì—¬ë¶€ ì²´í¬
        var hasConsecutive4Perfect = false;
        
        if (ratios.length >= 4) {
            for (var i = 0; i <= ratios.length - 4; i++) {
                var consecutive4 = ratios.slice(i, i + 4);
                if (consecutive4.every(ratio => ratio >= 100)) {
                    hasConsecutive4Perfect = true;
                    break;
                }
            }
        }
        
        if (hasConsecutive4Perfect) {
            badges.push({ 
                icon: "ğŸ†", 
                text: targetSubject + " ë§ˆìŠ¤í„°", 
                type: "subject-master", 
                isNew: true 
            });
            subjectMasters.push(targetSubject);
        }
    }
    });
    
    // 13. ì¢…í•© ë±ƒì§€ (3ê°œ)
    if (subjectMasters.length >= 3) {
        badges.push({ icon: "ğŸ“", text: "êµ­ì–´ ì˜¬ë¼ìš´ë”", type: "subject-master", isNew: true });
    }
    if (subjectMasters.length >= 5) {
        badges.push({ icon: "ğŸ“š", text: "êµ­ì–´ ë§ˆì—ìŠ¤íŠ¸ë¡œ", type: "subject-master", isNew: true });
    }
    if (subjectMasters.length >= 9) {
        badges.push({ icon: "ğŸ‘‘", text: "êµ­ì–´ ë ˆì „ë”ë¦¬", type: "subject-master", isNew: true });
    }
    
    // 
    return badges;
}

        // ë±ƒì§€ ì„¤ëª… ë°ì´í„°
var badgeDescriptions = {
    // ë“±ê¸‰ ê´€ë ¨ ë±ƒì§€
    "1ë“±ê¸‰ ë‹¬ì„±": "êµ­ì–´ ëª¨ì˜ê³ ì‚¬ì—ì„œ ìµœê³  ë“±ê¸‰ì¸ 1ë“±ê¸‰ì„ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤! ìƒìœ„ 4% ì•ˆì— ë“œëŠ” ë›°ì–´ë‚œ ì„±ì·¨ì…ë‹ˆë‹¤.",
    "ìƒìœ„ë“±ê¸‰ ë‹¬ì„±": "2ë“±ê¸‰ ì´ìƒì˜ ìƒìœ„ ë“±ê¸‰ì„ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤. ê¾¸ì¤€í•œ ë…¸ë ¥ì˜ ê²°ê³¼ì…ë‹ˆë‹¤!",
    "3ë“±ê¸‰ ì´ë‚´": "3ë“±ê¸‰ ì´ë‚´ì˜ ì¤€ìˆ˜í•œ ì„±ì ì„ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤. ìƒìœ„ê¶Œ ì§„ì…ì˜ ë°œíŒì´ ë˜ì—ˆë„¤ìš”!",
    "ìš°ìˆ˜í•œ ë“±ê¸‰": "í‰ê·  2.5ë“±ê¸‰ ì´ìƒì˜ ìš°ìˆ˜í•œ ì„±ì ì„ ìœ ì§€í•˜ê³  ìˆìŠµë‹ˆë‹¤.",
    "ìµœìƒìœ„ ë“±ê¸‰": "í‰ê·  1.5ë“±ê¸‰ ì´ìƒ! ìµœìƒìœ„ê¶Œ í•™ìƒì˜ ì¦ê±°ì…ë‹ˆë‹¤.",
    
    // ì ìˆ˜ ê´€ë ¨ ë±ƒì§€
    "95ì  ì´ìƒ": "95ì  ì´ìƒì˜ ê³ ë“ì ì„ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤! ê±°ì˜ ë§Œì ì— ê°€ê¹Œìš´ ì‹¤ë ¥ì´ë„¤ìš”.",
    "ê³ ë“ì ì": "í‰ê·  85ì  ì´ìƒì˜ ì•ˆì •ì ì¸ ê³ ë“ì ì„ ìœ ì§€í•˜ê³  ìˆìŠµë‹ˆë‹¤.",
    "ë§Œì  ë‹¬ì„±": "100ì  ë§Œì ì„ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤! ì™„ë²½í•œ ì‹¤ë ¥ì„ ë³´ì—¬ì£¼ì—ˆë„¤ìš”.",
    "ìš°ìˆ˜í•œ í‰ê· ": "í‰ê·  90ì  ì´ìƒì˜ ë›°ì–´ë‚œ ì‹¤ë ¥ì„ ë³´ì—¬ì£¼ê³  ìˆìŠµë‹ˆë‹¤.",
    
    // ì„±ì  ë³€í™” ë±ƒì§€
    "ì—°ì† ìƒìŠ¹": "2íšŒ ì—°ì†ìœ¼ë¡œ ì„±ì ì´ ìƒìŠ¹í–ˆìŠµë‹ˆë‹¤. ê¾¸ì¤€í•œ ë°œì „ì´ ë‹ë³´ì…ë‹ˆë‹¤!",
    "3ì—°ì† ìƒìŠ¹": "3íšŒ ì—°ì† ìƒìŠ¹! ì§€ì†ì ì¸ ì„±ì¥ ê³¡ì„ ì„ ê·¸ë¦¬ê³  ìˆìŠµë‹ˆë‹¤.",
    "4ì—°ì† í­í’ ìƒìŠ¹": "4íšŒ ì—°ì† ìƒìŠ¹ì˜ ë†€ë¼ìš´ ê¸°ë¡! ë©ˆì¶œ ìˆ˜ ì—†ëŠ” ìƒìŠ¹ì„¸ì…ë‹ˆë‹¤.",
    
    // ì ìˆ˜ ê°œì„  ë±ƒì§€
    "ëŒ€í­ ìƒìŠ¹": "ì´ì „ ì‹œí—˜ ëŒ€ë¹„ 15ì  ì´ìƒ ìƒìŠ¹í–ˆìŠµë‹ˆë‹¤. í° ë°œì „ì´ë„¤ìš”!",
    "í­ë°œì  ìƒìŠ¹": "25ì  ì´ìƒì˜ í­ë°œì ì¸ ìƒìŠ¹ì„ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤!",
    "ê¸°ì ì˜ ìƒìŠ¹": "35ì  ì´ìƒì˜ ê¸°ì  ê°™ì€ ìƒìŠ¹! ë†€ë¼ìš´ ë°œì „ì…ë‹ˆë‹¤.",
    
    // ì¶œì„ ë° ì„±ì‹¤ì„± ë±ƒì§€
    "ì„±ì‹¤í•œ ì‘ì‹œ": "5íšŒ ì´ìƒì˜ ëª¨ì˜ê³ ì‚¬ì— ì„±ì‹¤í•˜ê²Œ ì°¸ì—¬í–ˆìŠµë‹ˆë‹¤.",
    "ê¾¸ì¤€í•œ ë„ì „": "8íšŒ ì´ìƒ ê¾¸ì¤€íˆ ëª¨ì˜ê³ ì‚¬ì— ë„ì „í•˜ëŠ” ì„±ì‹¤í•¨ì„ ë³´ì˜€ìŠµë‹ˆë‹¤.",
    "ì™„ë²½í•œ ì¶œì„": "ëª¨ë“  ëª¨ì˜ê³ ì‚¬ì— ë¹ ì§ì—†ì´ ì°¸ì—¬í–ˆìŠµë‹ˆë‹¤. ì„±ì‹¤ì„±ì˜ ìƒì§•!",
    
                   
    // ì•ˆì •ì„± ë±ƒì§€
    "ì•ˆì •ì  ì„±ì·¨": "ì„±ì ì˜ í¸ì°¨ê°€ ì ì–´ ì•ˆì •ì ì¸ ì‹¤ë ¥ì„ ë³´ì—¬ì£¼ê³  ìˆìŠµë‹ˆë‹¤.",
    "ì™„ë²½í•œ ì•ˆì •": "ë§¤ìš° ì•ˆì •ì ì¸ ì„±ì  ìœ ì§€! ì‹¤ë ¥ì´ í™•ê³ íˆ ìë¦¬ì¡ì•˜ìŠµë‹ˆë‹¤.",
    
   // ë“±ê¸‰ ê´€ë ¨ ë±ƒì§€ ì„¹ì…˜ì— ì¶”ê°€
    "1ë“±ê¸‰ ë§ˆìŠ¤í„°": "1ë“±ê¸‰ì„ 5íšŒ ì—°ì†ìœ¼ë¡œ ë‹¬ì„±í•œ ì§„ì •í•œ ìµœìƒìœ„ê¶Œ í•™ìƒì…ë‹ˆë‹¤! ê¾¸ì¤€í•¨ê³¼ ì‹¤ë ¥ì„ ëª¨ë‘ ê°–ì¶˜ ë§ˆìŠ¤í„°ì…ë‹ˆë‹¤.",
    
    // íšŒë³µ/ì„±ì¥ ë±ƒì§€
    "ê·¹ì  íšŒë³µ": "ì—°ì† í•˜ë½ í›„ ê·¹ì ìœ¼ë¡œ íšŒë³µí•œ ë“œë¼ë§ˆí‹±í•œ ìŠ¤í† ë¦¬ë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤!",
    "ì¥ê¸° ì„±ì¥": "ì¥ê¸°ê°„ì— ê±¸ì³ 20ì  ì´ìƒì˜ ê¾¸ì¤€í•œ ì„±ì¥ì„ ë³´ì˜€ìŠµë‹ˆë‹¤.",
    
    // í•œë²ˆì˜ í° ì í”„ ë±ƒì§€
    "ë†€ë¼ìš´ ì í”„": "í•œ ë²ˆì— 35ì  ì´ìƒì˜ ë†€ë¼ìš´ ì ìˆ˜ í–¥ìƒì„ ì´ë¤˜ìŠµë‹ˆë‹¤!",
    "í° ë„ì•½": "25ì  ì´ìƒì˜ í° ë„ì•½ì„ í•´ëƒˆìŠµë‹ˆë‹¤!",
    "ì„±ê³µì  ì í”„": "15ì  ì´ìƒì˜ ì„±ê³µì ì¸ ì ìˆ˜ í–¥ìƒì„ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤.",
    
    // ì „ì²´ ì„±ì¥ ë±ƒì§€
    "ì—­ì „ì˜ ìŠ¤í† ë¦¬": "ìµœì €ì ì—ì„œ ìµœê³ ì ê¹Œì§€, ê°ë™ì ì¸ ì—­ì „ ë“œë¼ë§ˆë¥¼ ì¨ëƒˆìŠµë‹ˆë‹¤!",
    "ê¾¸ì¤€í•œ ìƒìŠ¹ì„¸": "ì „ì²´ì ìœ¼ë¡œ ê¾¸ì¤€í•œ ìƒìŠ¹ì„¸ë¥¼ ë³´ì´ë©° ì„±ì¥í•˜ê³  ìˆìŠµë‹ˆë‹¤.",
    
    // ê³ 3 ê³¼ëª©ë³„ ë§ˆìŠ¤í„° ë±ƒì§€
    "ë…ì„œ(ì¸ë¬¸ ì´ë¡ ) ë§ˆìŠ¤í„°": "ë…ì„œ(ì¸ë¬¸ ì´ë¡ ) ì˜ì—­ì—ì„œ ìµœê·¼ 4íšŒ ì—°ì† ë§Œì ! ì™„ë²½í•œ ë§ˆìŠ¤í„°ì…ë‹ˆë‹¤.",
    "ë…ì„œ(ì‚¬íšŒ) ë§ˆìŠ¤í„°": "ë…ì„œ(ì‚¬íšŒ) ì˜ì—­ ìµœê·¼ 4íšŒ ì—°ì† ë§Œì ! ì‚¬íšŒ í˜„ìƒ ì´í•´ë ¥ì´ ìš°ìˆ˜í•©ë‹ˆë‹¤.",
    "ë…ì„œ(ê³¼í•™) ë§ˆìŠ¤í„°": "ë…ì„œ(ê³¼í•™) ì˜ì—­ ìµœê·¼ 4íšŒ ì—°ì† ë§Œì ! ê³¼í•™ì  ì‚¬ê³ ë ¥ì´ íƒì›”í•©ë‹ˆë‹¤.",
    "ë¬¸í•™(í˜„ëŒ€ì‹œ) ë§ˆìŠ¤í„°": "í˜„ëŒ€ì‹œ ì˜ì—­ ìµœê·¼ 4íšŒ ì—°ì† ë§Œì ! ì‹œì  ê°ìˆ˜ì„±ì´ ë›°ì–´ë‚©ë‹ˆë‹¤.",
    "ë¬¸í•™(í˜„ëŒ€ì†Œì„¤) ë§ˆìŠ¤í„°": "í˜„ëŒ€ì†Œì„¤ ì˜ì—­ ìµœê·¼ 4íšŒ ì—°ì† ë§Œì ! ì„œì‚¬ ì´í•´ë ¥ì´ ì™„ë²½í•©ë‹ˆë‹¤.",
    "ë¬¸í•™(ê³ ì „ì‹œê°€) ë§ˆìŠ¤í„°": "ê³ ì „ì‹œê°€ ì˜ì—­ ìµœê·¼ 4íšŒ ì—°ì† ë§Œì ! ê³ ì „ ë¬¸í•™ì˜ ì§„ìˆ˜ë¥¼ ì´í•´í–ˆìŠµë‹ˆë‹¤.",
    "ë¬¸í•™(ê³ ì „ì†Œì„¤) ë§ˆìŠ¤í„°": "ê³ ì „ì†Œì„¤ ì˜ì—­ ìµœê·¼ 4íšŒ ì—°ì† ë§Œì ! ê³ ì „ ì„œì‚¬ì˜ ëŒ€ê°€ì…ë‹ˆë‹¤.",
    "ì–¸ì–´ í™”ë²• ë§ˆìŠ¤í„°": "ì–¸ì–´ í™”ë²• ì˜ì—­ì—ì„œ ìµœê·¼ 4íšŒ ì—°ì† ë§Œì ! ì˜ì‚¬ì†Œí†µì˜ ë‹¬ì¸ì…ë‹ˆë‹¤.",
    "ë§¤ì²´ ì‘ë¬¸ ë§ˆìŠ¤í„°": "ë§¤ì²´ ì‘ë¬¸ ì˜ì—­ì—ì„œ ìµœê·¼ 4íšŒ ì—°ì† ë§Œì ! í˜„ëŒ€ì  ì†Œí†µì˜ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.",
    
    // ì¢…í•© ë±ƒì§€
    "êµ­ì–´ ì˜¬ë¼ìš´ë”": "3ê°œ ì´ìƒì˜ ê³¼ëª©ì—ì„œ ë§ˆìŠ¤í„° ë‹¬ì„±! êµ­ì–´ì˜ ë‹¤ì–‘í•œ ì˜ì—­ì— ëŠ¥í†µí•©ë‹ˆë‹¤.",
    "êµ­ì–´ ë§ˆì—ìŠ¤íŠ¸ë¡œ": "5ê°œ ì´ìƒì˜ ê³¼ëª©ì—ì„œ ë§ˆìŠ¤í„° ë‹¬ì„±! êµ­ì–´ ì‹¤ë ¥ì´ ëŒ€ê°€ ìˆ˜ì¤€ì…ë‹ˆë‹¤.",
    "êµ­ì–´ ë ˆì „ë”ë¦¬": "ëª¨ë“  9ê°œ ê³¼ëª©ì—ì„œ ë§ˆìŠ¤í„° ë‹¬ì„±! êµ­ì–´ê³„ì˜ ì „ì„¤ì´ ë˜ì—ˆìŠµë‹ˆë‹¤!"
};

        // íˆ´íŒ ê´€ë¦¬ ë³€ìˆ˜
var currentTooltip = null;
var tooltipTimeout = null;

// ë±ƒì§€ íˆ´íŒ í‘œì‹œ í•¨ìˆ˜
function showBadgeTooltip(event, badgeText) {
    console.log('íˆ´íŒ í‘œì‹œ ì‹œë„:', badgeText);
    
    // ê¸°ì¡´ íˆ´íŒ ì œê±°
    hideBadgeTooltip();
    
    var description = badgeDescriptions[badgeText];
    if (!description) {
        console.log('ì„¤ëª…ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ:', badgeText);
        return;
    }
    
    console.log('íˆ´íŒ ìƒì„± ì¤‘:', description);
    
    // íˆ´íŒ ìƒì„±
    var tooltip = document.createElement('div');
    tooltip.className = 'badge-tooltip';
    tooltip.innerHTML = '<strong>' + badgeText + '</strong><br>' + description;
    document.body.appendChild(tooltip);
    
    // ëª¨ë°”ì¼ ì²´í¬
    var isMobile = window.innerWidth <= 768;
    console.log('isMobile:', isMobile);
    

    // ê°„ë‹¨í•œ ìœ„ì¹˜ ì„¤ì •
    var rect = event.target.getBoundingClientRect();
    tooltip.style.left = (rect.left + rect.width / 2) + 'px';
    tooltip.style.top = (rect.top - 10) + 'px';
    tooltip.style.transform = 'translateX(-50%) translateY(-100%)';
    
    // ì• ë‹ˆë©”ì´ì…˜ìœ¼ë¡œ í‘œì‹œ
    requestAnimationFrame(function() {
        tooltip.classList.add('visible');
    });
    
    currentTooltip = tooltip;
    
    // ëª¨ë°”ì¼ì—ì„œëŠ” 3ì´ˆ í›„ ìë™ ìˆ¨ê¹€
    if (isMobile) {
        tooltipTimeout = setTimeout(hideBadgeTooltip, 3000);
    }
    
    console.log('íˆ´íŒ í‘œì‹œ ì™„ë£Œ');
}

// ë±ƒì§€ íˆ´íŒ ìˆ¨ê¹€ í•¨ìˆ˜
function hideBadgeTooltip() {
    if (currentTooltip) {
        currentTooltip.classList.remove('visible');
        setTimeout(function() {
            if (currentTooltip && currentTooltip.parentNode) {
                currentTooltip.parentNode.removeChild(currentTooltip);
            }
            currentTooltip = null;
        }, 300);
    }
    
    if (tooltipTimeout) {
        clearTimeout(tooltipTimeout);
        tooltipTimeout = null;
    }
}

// ë±ƒì§€ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€í•˜ëŠ” í•¨ìˆ˜
function addBadgeTooltipEvents() {
    var badges = document.querySelectorAll('.achievement-badge');
    console.log('ë±ƒì§€ íˆ´íŒ ì´ë²¤íŠ¸ ì„¤ì • ì¤‘... ë°œê²¬ëœ ë±ƒì§€ ìˆ˜:', badges.length);
    
    badges.forEach(function(badge, index) {
        // ê¸°ì¡´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
        badge.removeEventListener('mouseenter', badge._mouseenterHandler);
        badge.removeEventListener('mouseleave', badge._mouseleaveHandler);
        badge.removeEventListener('click', badge._clickHandler);
        
        // ë” ì•ˆì „í•œ í…ìŠ¤íŠ¸ ì¶”ì¶œ ë°©ë²•
        var badgeText = '';
        var textNodes = [];
        
        // ëª¨ë“  í…ìŠ¤íŠ¸ ë…¸ë“œ ìˆ˜ì§‘
        function collectTextNodes(node) {
            if (node.nodeType === 3) { // TEXT_NODE
                textNodes.push(node.nodeValue);
            } else {
                for (var i = 0; i < node.childNodes.length; i++) {
                    collectTextNodes(node.childNodes[i]);
                }
            }
        }
        
        collectTextNodes(badge);
        badgeText = textNodes.join(' ')
            .replace('NEW!', '')
            .replace(/\s+/g, ' ')
            .trim();
        
        console.log('ë±ƒì§€ ì„¤ì •:', index, '"' + badgeText + '"');
        
        // ëª¨ë°”ì¼: í´ë¦­ ì´ë²¤íŠ¸
        badge._clickHandler = function(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log('ë±ƒì§€ í´ë¦­:', '"' + badgeText + '"');
            
            if (currentTooltip) {
                hideBadgeTooltip();
            } else {
                showBadgeTooltip(e, badgeText);
            }
        };
        
        badge.addEventListener('click', badge._clickHandler);
    });
}

// ì „ì—­ í´ë¦­ ì´ë²¤íŠ¸ë¡œ íˆ´íŒ ìˆ¨ê¹€ (ëª¨ë°”ì¼)
document.addEventListener('click', function(e) {
    // ë±ƒì§€ë‚˜ íˆ´íŒì„ í´ë¦­í•œ ê²½ìš°ê°€ ì•„ë‹ˆë¼ë©´ íˆ´íŒ ìˆ¨ê¹€
    if (currentTooltip && 
        !e.target.classList.contains('achievement-badge') && 
        !e.target.closest('.achievement-badge') &&
        !e.target.closest('.badge-tooltip')) {
        hideBadgeTooltip();
    }
});
        
        // ğŸ“… D-day ê³„ì‚°
        function calculateDday() {
            var today = new Date();
            
            // ê³ 2/ê³ 3 êµ¬ë¶„ (í˜ì´ì§€ ì œëª©ìœ¼ë¡œ íŒë‹¨)
            var iswinter3 = document.title.includes('ê³ 3');
            
            var examDate;
            if (iswinter3) {
                examDate = new Date('2025-11-13'); // ê³ 3: 25ë…„ 11.13.(ëª©)
            } else {
                examDate = new Date('2026-11-19'); // ê³ 2: 26ë…„ 11.19.(ëª©)
            }
            
            var diffTime = examDate - today;
            var diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            return {
                days: diffDays,
                examDate: examDate,
                iswinter3: iswinter3
            };
        }
        
        // ğŸ“ˆ ì„±ì  ê·¸ë˜í”„ ìƒì„±
        function createGradeChart(student) {
            var grades = student.grades;
            var gradeKeys = Object.keys(grades);
            
            if (gradeKeys.length < 2) return null;
            
            var labels = [];
            var scoreData = [];
            var gradeData = [];
            
            gradeKeys.forEach(function(testName) {
                var gradeInfo = grades[testName];
                labels.push(testName);
                scoreData.push(gradeInfo.score || 0);
                gradeData.push(gradeInfo.grade || 9);
            });
            
            return {
                labels: labels,
                datasets: [
                    {
                        label: 'ì ìˆ˜',
                        data: scoreData,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4,
                        yAxisID: 'y'
                    },
                    {
                        label: 'ë“±ê¸‰',
                        data: gradeData,
                        borderColor: '#ef4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        tension: 0.4,
                        yAxisID: 'y1'
                    }
                ]
            };
        }
        
        // í†µí•© ëŒ€ì‹œë³´ë“œ í‘œì‹œ í•¨ìˆ˜
        function displayDashboard(student) {
            var stats = calculateStatistics(student);
            var badges = generateAchievementBadges(student, stats);
            var dday = calculateDday();
            
            if (!stats) return '';
            
            var changeIcon = stats.scoreChange > 0 ? 'ğŸ“ˆ' : stats.scoreChange < 0 ? 'ğŸ“‰' : 'â¡ï¸';
            var changeClass = stats.scoreChange > 0 ? 'stat-positive' : stats.scoreChange < 0 ? 'stat-negative' : 'stat-neutral';
            var changeText = stats.scoreChange > 0 ? '+' + stats.scoreChange : stats.scoreChange;
            
            return `
                <!-- D-day ì¹´ìš´í„° -->
                <div class="dday-counter">
                    <div class="dday-text">${dday.iswinter3 ? 'ğŸ¯ ìˆ˜ëŠ¥' : 'ğŸ“š ìˆ˜ëŠ¥'}ê¹Œì§€</div>
                    <div class="dday-number">D-${dday.days}</div>
                    <div style="font-size: 1em; opacity: 0.9;">
                        ${dday.examDate.toLocaleDateString('ko-KR', {year: 'numeric', month: 'long', day: 'numeric', weekday: 'long'})}
                    </div>
                </div>
                
                <div class="dashboard-grid">
                    <!-- ğŸ“Š í†µê³„ ëŒ€ì‹œë³´ë“œ -->
                    <div class="dashboard-card">
                        <h3>ğŸ“Š ì„±ì  í†µê³„</h3>
                        <div class="stat-item">
                            <span class="stat-label">í‰ê·  ì ìˆ˜</span>
                            <span class="stat-value">${stats.avgScore}ì </span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">í‰ê·  ë“±ê¸‰</span>
                            <span class="stat-value">${stats.avgGrade}ë“±ê¸‰</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">ìµœê³  ì„±ì </span>
                            <span class="stat-value">${stats.bestGrade}ë“±ê¸‰ ${stats.bestScore}ì </span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">ìµœê·¼ ë³€í™”</span>
                            <span class="stat-value ${changeClass}">${changeIcon} ${changeText}ì </span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">ì˜ˆìƒ ìˆœìœ„</span>
                            <span class="stat-value">ìƒìœ„ ${stats.percentile}%</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">ì‘ì‹œìœ¨</span>
                            <span class="stat-value">${Math.round(stats.testCount/stats.totalTests*100)}% (${stats.testCount}/${stats.totalTests}íšŒ)</span>
                        </div>
                    </div>
                    
                    <!-- ğŸ† ì„±ì·¨ ë±ƒì§€ -->
<div class="dashboard-card">
    <h3>ğŸ† ì„±ì·¨ ë±ƒì§€ <span style="font-size: 0.8em; color: #667eea;">(${badges.length}/40ê°œ íšë“)</span></h3>
    
  
${badges.length >= 25 ? 
`<div style="
    background: linear-gradient(135deg, #ffd700, #ff8c00); 
    color: white; 
    border-radius: 15px; 
    padding: 20px; 
    margin: 15px 0; 
    text-align: center; 
    box-shadow: 0 8px 25px rgba(255, 215, 0, 0.3);
    animation: grand-master-glow 2s infinite alternate;
">
    <div style="font-size: 2em; margin-bottom: 10px;">ğŸŠğŸ‘‘ğŸŠ</div>
    <div style="font-size: 1.3em; font-weight: bold; margin-bottom: 10px;">
        ì¶•í•˜í•©ë‹ˆë‹¤! 25ê°œ ì´ìƒì˜ ë±ƒì§€ë¥¼ ëª¨ì•„<br>
        êµ­ì–´ ê·¸ëœë“œ ë§ˆìŠ¤í„°ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ†
    </div>
    <div style="font-size: 1.1em; opacity: 0.95;">
        ì´ëŒ€ê±´Tì—ê²Œ ê°€ì„œ ì„ ë¬¼ì„ ìˆ˜ë ¹í•˜ì„¸ìš”! ğŸ
    </div>
</div>` : 
''
}

${badges.length > 0 ? 
    '<div class="badge-summary">ì´ ' + badges.length + '/40ê°œì˜ ë±ƒì§€ë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤!' + 
    (badges.length >= 35 ? ' ğŸ”¥ ì‚¬ë‘í•œë‹¤ ì œìì•¼. ê³ ìƒë§ì•˜ì–´.!' : 
     badges.length >= 30 ? ' ğŸŒŸ ê±°ì˜ ë‹¤ ëª¨ì•˜ì–´ìš”!' : 
     badges.length >= 25 ? ' ğŸ‰ êµ­ì–´ ê·¸ëœë“œ ë§ˆìŠ¤í„° ë‹¬ì„±!' : 
     badges.length >= 15 ? ' ğŸ’ª ë§ì´ ëª¨ì•˜ë„¤ìš”!' : '') + '</div>' +
        '<div class="badge-container">' +
        badges.map(badge => 
           `<div class="achievement-badge ${badge.type} ${badge.isNew ? 'badge-new' : ''}">
                <span>${badge.icon}</span>
                <span>${badge.text}</span>
                ${badge.isNew ? '<span style="font-size: 0.7em;">NEW!</span>' : ''}
            </div>`
        ).join('') +
        '</div>' :
    '<p style="color: #666; text-align: center; padding: 20px;">ë” ë§ì€ ì‹œí—˜ì„ ì¹˜ë¥´ë©´ ë±ƒì§€ë¥¼ íšë“í•  ìˆ˜ ìˆì–´ìš”!</p>'
    }
    
    <div style="margin-top: 15px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 8px; font-size: 0.85em; text-align: center;">
        ğŸ’¡ <strong>PC:</strong> ë±ƒì§€ë¥¼ í´ë¦­í•˜ë©´ ì„¤ëª…ì„ ë³¼ ìˆ˜ ìˆì–´ìš”!<br>
        ğŸ“± <strong>ëª¨ë°”ì¼:</strong> ë±ƒì§€ë¥¼ í„°ì¹˜í•˜ë©´ ì„¤ëª…ì´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤!
    </div>
</div>
                
                <!-- ğŸ“ˆ ì„±ì  ë³€í™” ê·¸ë˜í”„ -->
                <div class="dashboard-card" style="margin: 25px 0;">
                    <h3>ğŸ“ˆ ì„±ì  ë³€í™” ì¶”ì´</h3>
                    <div class="chart-container">
                        <canvas id="gradeChart_${student.attendanceNumber}"></canvas>
                    </div>
                </div>
            `;
        }
        
        // Chart.js ê·¸ë˜í”„ ìƒì„±
        function createChart(student) {
            var chartData = createGradeChart(student);
            if (!chartData) return;
            
            var ctx = document.getElementById('gradeChart_' + student.attendanceNumber);
            if (!ctx) return;
            
            new Chart(ctx, {
                type: 'line',
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'ì ìˆ˜'
                            },
                            min: 0,
                            max: 100
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'ë“±ê¸‰'
                            },
                            min: 1,
                            max: 9,
                            reverse: true,
                            grid: {
                                drawOnChartArea: false,
                            },
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    }
                }
            });
        }
        
        var studentByNumber = {};
        var isDataLoaded = false;
        var githubConfig = {};
        var dataUrl = '';
        var isAdminAuthenticated = false;
        
        var maxScores = {}; // í•˜ë“œì½”ë”©ëœ ê°’ ì œê±°, ì—‘ì…€ì—ì„œ ì¶”ì¶œí•œ ê°’ë§Œ ì‚¬ìš©
        
        
        // ë¶„ì„ í•¨ìˆ˜
        function generateAIAnalysis(student) {
            console.log('ë¶„ì„ ì‹œì‘:', student.name);
            
            // ë¶„ì„ ì„¹ì…˜ í‘œì‹œ
            var aiAnalysisDiv = document.getElementById('aiAnalysis');
            var aiContentDiv = document.getElementById('aiContent');
            
            aiAnalysisDiv.style.display = 'block';
            
            // ë¡œë”© ìƒíƒœ í‘œì‹œ
            aiContentDiv.innerHTML = `
                <div class="ai-loading">
                    <span>ğŸ§  ì„±ì ì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤</span>
                    <div class="loading-dots">
                        <div class="loading-dot"></div>
                        <div class="loading-dot"></div>
                        <div class="loading-dot"></div>
                    </div>
                </div>
            `;
            
            // ì‹¤ì œ ë¶„ì„ ì‹¤í–‰ (ì‹œë®¬ë ˆì´ì…˜)
setTimeout(function() {
    var analysis = performAIAnalysis(student);
    displayAIAnalysis(analysis);
    
    // AI ë¶„ì„ ì™„ë£Œ í›„ í•™ìŠµ ê³„íšì„œ ìë™ ìƒì„±
    setTimeout(function() {
        generateAutoStudyPlan(student);
    }, 1000);
}, 2000); // 2ì´ˆ í›„ ë¶„ì„ ê²°ê³¼ í‘œì‹œ
        }
        
        function performAIAnalysis(student) {
            var grades = student.grades;
            var gradeKeys = Object.keys(grades);
            
            if (gradeKeys.length === 0) {
                return {
                    summary: "ë¶„ì„í•  ì„±ì  ë°ì´í„°ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.",
                    strengths: [],
                    weaknesses: [],
                    trends: [],
                    recommendations: [],
                    gradeStrategy: null
                };
            }
            
            // ë“±ê¸‰ ë° ì ìˆ˜ ë¶„ì„
            var gradeValues = [];
            var scoreValues = [];
            var subjectScores = {};
            var subjectRatios = {};
            var testDetails = {}; // ì‹œí—˜ë³„ ìƒì„¸ ì •ë³´ ì €ì¥
            
            gradeKeys.forEach(function(testName) {
                var gradeData = grades[testName];
                if (gradeData.grade) gradeValues.push(parseInt(gradeData.grade));
                if (gradeData.score) scoreValues.push(parseInt(gradeData.score));
                
                // ì‹œí—˜ë³„ ìƒì„¸ ì •ë³´ ì €ì¥ (ìµœê³  ì„±ì  ì°¾ê¸°ìš©)
                testDetails[testName] = {
                    grade: parseInt(gradeData.grade),
                    score: parseInt(gradeData.score),
                    source: gradeData.source || '',
                    subjectType: gradeData.subjectType || ''
                };
                
                // ê³¼ëª©ë³„ ì ìˆ˜ ë° ë¹„ìœ¨ ìˆ˜ì§‘
                if (gradeData.details) {
                    Object.keys(gradeData.details).forEach(function(subject) {
                        if (!subjectScores[subject]) subjectScores[subject] = [];
                        if (!subjectRatios[subject]) subjectRatios[subject] = [];
                        
                        subjectScores[subject].push(gradeData.details[subject]);
                        if (gradeData.ratios && gradeData.ratios[subject]) {
                            subjectRatios[subject].push(gradeData.ratios[subject]);
                        }
                    });
                }
            });
            
            // í†µê³„ ê³„ì‚°
            var avgGrade = gradeValues.length > 0 ? Math.round(gradeValues.reduce((a, b) => a + b) / gradeValues.length * 10) / 10 : 0;
            var avgScore = scoreValues.length > 0 ? Math.round(scoreValues.reduce((a, b) => a + b) / scoreValues.length) : 0;
            var bestGrade = gradeValues.length > 0 ? Math.min(...gradeValues) : 0;
            var bestScore = scoreValues.length > 0 ? Math.max(...scoreValues) : 0;
            var latestGrade = gradeValues.length > 0 ? gradeValues[gradeValues.length - 1] : 0;
            
            // ìµœê³  ì„±ì  ì‹œí—˜ ì°¾ê¸°
            var bestTest = '';
            var bestTestSource = '';
            var bestTestSubjectType = '';
            Object.keys(testDetails).forEach(function(testName) {
                var testInfo = testDetails[testName];
                if (testInfo.score === bestScore) {
                    bestTest = testName;
                    bestTestSource = testInfo.source;
                    bestTestSubjectType = testInfo.subjectType;
                }
            });
            
            // ê³¼ëª©ë³„ í‰ê·  ê³„ì‚°
            var subjectAverages = {};
            Object.keys(subjectRatios).forEach(function(subject) {
                var ratios = subjectRatios[subject];
                if (ratios.length > 0) {
                    subjectAverages[subject] = Math.round(ratios.reduce((a, b) => a + b) / ratios.length * 10) / 10;
                }
            });
            
            // ê°•ì  ê³¼ëª© ì°¾ê¸° (í‰ê·  70% ì´ìƒ)
            var strengths = [];
            Object.keys(subjectAverages).forEach(function(subject) {
                if (subjectAverages[subject] >= 70) {
                    strengths.push({
                        subject: subject,
                        average: subjectAverages[subject]
                    });
                }
            });
            strengths.sort((a, b) => b.average - a.average);
            
            // ê°œì„  í•„ìš” ê³¼ëª© ë¶„ì„ (ê¸°ì¡´ + ë‹¤ì¸µ ë¶„ì„)
            var weaknesses = analyzeWeaknesses(subjectRatios, subjectAverages);
            
            // ì„±ì  ì¶”ì´ ë¶„ì„ (í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼ë²•)
            var trends = [];
            Object.keys(subjectRatios).forEach(function(subject) {
                var ratios = subjectRatios[subject];
                if (ratios.length >= 3) {
                    var hybridResult = calculateHybridTrend(ratios);
                    
                    if (hybridResult && Math.abs(hybridResult.shortTermTrend) > 5) {
                        trends.push({
                            subject: subject,
                            shortTermTrend: hybridResult.shortTermTrend,
                            stability: hybridResult.stability,
                            pattern: hybridResult.pattern,
                            type: hybridResult.shortTermTrend > 0 ? 'up' : 'down',
                            intensity: getIntensityDescription(hybridResult.shortTermTrend)
                        });
                    }
                }
            });
            
            // ì¶”ì²œì‚¬í•­ ìƒì„±
            var recommendations = [];
            
            if (weaknesses.length > 0) {
                recommendations.push({
                    priority: "ë†’ìŒ",
                    action: weaknesses[0].subject + " ì§‘ì¤‘ í•™ìŠµ",
                    reason: weaknesses[0].description
                });
            }
            
            if (bestGrade <= 2 && latestGrade > bestGrade) {
                recommendations.push({
                    priority: "ì¤‘ê°„",
                    action: "ìµœê³  ì„±ì  íšŒë³µì„ ìœ„í•œ ì „ëµ ìˆ˜ë¦½",
                    reason: "ìµœê³  " + bestGrade + "ë“±ê¸‰ì—ì„œ í˜„ì¬ " + latestGrade + "ë“±ê¸‰ìœ¼ë¡œ í•˜ë½"
                });
            }
            
            if (trends.filter(t => t.type === 'up').length > 0) {
                var upTrend = trends.filter(t => t.type === 'up').sort((a, b) => b.shortTermTrend - a.shortTermTrend)[0];
                recommendations.push({
                    priority: "ë‚®ìŒ",
                    action: upTrend.subject + " ìƒìŠ¹ì„¸ ìœ ì§€",
                    reason: upTrend.intensity + " í–¥ìƒ ì¶”ì„¸"
                });
            }
            
            // êµ¬ì²´ì  ë“±ê¸‰ ìƒìŠ¹ ì „ëµ ìƒì„±
            var gradeStrategy = generateGradeStrategy(student, gradeKeys, subjectRatios, subjectAverages);
            
            return {
                summary: {
                    name: student.name,
                    attendanceNumber: student.attendanceNumber,
                    testCount: gradeKeys.length,
                    totalTests: window.discoveredTestSheets ? window.discoveredTestSheets.length : 12,
                    avgGrade: avgGrade,
                    avgScore: avgScore,
                    bestGrade: bestGrade,
                    bestScore: bestScore,
                    bestTest: bestTest,
                    bestTestSource: bestTestSource,
                    bestTestSubjectType: bestTestSubjectType,
                    latestGrade: latestGrade
                },
                strengths: strengths.slice(0, 3),
                weaknesses: weaknesses.slice(0, 3),
                trends: trends,
                recommendations: recommendations,
                gradeStrategy: gradeStrategy
            };
        }
        
        // êµ¬ì²´ì  ë“±ê¸‰ ìƒìŠ¹ ì „ëµ ìƒì„± í•¨ìˆ˜
        function generateGradeStrategy(student, gradeKeys, subjectRatios, subjectAverages) {
            if (gradeKeys.length < 2) return null;
            
            // ìµœê·¼ 4íšŒ ì‹œí—˜ ë°ì´í„° ì¶”ì¶œ
            var recentTests = gradeKeys.slice(-4);
            var recentData = [];
            
            recentTests.forEach(function(testName) {
                var gradeData = student.grades[testName];
                if (gradeData) {
                    recentData.push({
                    name: testName,
                    grade: parseInt(gradeData.grade),
                    score: parseInt(gradeData.score),
                    subjectType: gradeData.subjectType || ''
                });
                }
            });
            
            if (recentData.length < 2) return null;
            
            // ìµœê·¼ 4íšŒ í‰ê·  ê³„ì‚°
            var recentAvgGrade = Math.round(recentData.reduce((sum, test) => sum + test.grade, 0) / recentData.length * 10) / 10;
            var recentAvgScore = Math.round(recentData.reduce((sum, test) => sum + test.score, 0) / recentData.length);
            
            // ëª©í‘œ ë“±ê¸‰ ì„¤ì • (í˜„ì¬ í‰ê· ë³´ë‹¤ í•œ ë“±ê¸‰ ìœ„)
            var targetGrade = Math.max(1, Math.floor(recentAvgGrade));
            var targetScore = getTargetScore(targetGrade);
            var neededPoints = targetScore - recentAvgScore;
            
            // ë‹¬ì„± ê°€ëŠ¥ì„± í‰ê°€
            var possibility = 'medium';
            if (neededPoints <= 5) possibility = 'high';
            else if (neededPoints > 15) possibility = 'low';
            
            // ê³¼ëª©ë³„ ì ìˆ˜ í™•ë³´ ì „ëµ
            var subjectStrategies = [];
            var totalPossibleGain = 0;
            
            Object.keys(subjectAverages).forEach(function(subject) {
                var avg = subjectAverages[subject];
                var recent4Ratios = subjectRatios[subject] ? subjectRatios[subject].slice(-4) : [];
                
                if (recent4Ratios.length === 0) return;
                
                var recent4Avg = recent4Ratios.reduce((a, b) => a + b) / recent4Ratios.length;
                var maxRatio = Math.max(...recent4Ratios);
                var potential = Math.max(0, maxRatio - recent4Avg);
                
                var strategy = '';
                var strategyColor = '';
                var possibleGain = 0;
                
                if (recent4Avg < 60) {
                    strategy = 'ê¸°ë³¸ê¸° ë³´ê°• í•„ìš”';
                    strategyColor = '#ef4444'; // ë¹¨ê°„ìƒ‰
                    possibleGain = Math.min(4, potential * 0.2); // 20% ì„±ì·¨ë„ í–¥ìƒ = ì•½ 4ì 
                } else if (recent4Avg < 80) {
                    strategy = 'ì•ˆì •í™” í•„ìš”';
                    strategyColor = '#f59e0b'; // ì£¼í™©ìƒ‰
                    possibleGain = Math.min(3, potential * 0.15);
                } else if (recent4Avg < 95) {
                    strategy = 'ì‹¤ìˆ˜ ë°©ì§€ ì§‘ì¤‘';
                    strategyColor = '#10b981'; // ë…¹ìƒ‰
                    possibleGain = Math.min(2, potential * 0.1);
                } else {
                    strategy = 'í˜„ì¬ ìˆ˜ì¤€ ìœ ì§€';
                    strategyColor = '#6366f1'; // ë³´ë¼ìƒ‰
                    possibleGain = 1;
                }
                
                if (possibleGain > 0.5) {
                    console.log('ê³¼ëª©ë³„ ì ìˆ˜ í™•ë³´:', subject, possibleGain + 'ì ');
                    subjectStrategies.push({
                        subject: subject,
                        currentAvg: Math.round(recent4Avg),
                        strategy: strategy,
                        strategyColor: strategyColor,
                        possibleGain: Math.round(possibleGain * 10) / 10
                    });
                    totalPossibleGain += possibleGain;
                    console.log('ëˆ„ì  ì´í•©:', totalPossibleGain);
                }
            });
            
            console.log('ìµœì¢… ê³„ì‚° ê²°ê³¼:', totalPossibleGain);
            console.log('í‘œì‹œë  ê°’:', Math.round(totalPossibleGain * 10) / 10);
            
            // ê°€ëŠ¥ì„± ì¬í‰ê°€
            if (totalPossibleGain >= neededPoints * 1.2) possibility = 'high';
            else if (totalPossibleGain < neededPoints * 0.8) possibility = 'low';
            
            subjectStrategies.sort((a, b) => b.possibleGain - a.possibleGain);

            // ìƒìœ„ 4ê³¼ëª©ë§Œ ì„ íƒ
            var top4Strategies = subjectStrategies.slice(0, 4);
            
            // ìƒìœ„ 4ê³¼ëª©ì˜ ì ìˆ˜ë§Œ í•©ì‚°
            var top4TotalGain = 0;
            top4Strategies.forEach(function(strategy) {
                top4TotalGain += strategy.possibleGain;
            });
            
            console.log('ìƒìœ„ 4ê³¼ëª© ì ìˆ˜ í™•ë³´ í•©ê³„:', top4TotalGain);
            
            return {
                recentTests: recentData,
                recentAvgGrade: recentAvgGrade,
                recentAvgScore: recentAvgScore,
                targetGrade: targetGrade,
                targetScore: targetScore,
                neededPoints: neededPoints,
                possibility: possibility,
                subjectStrategies: top4Strategies,
                totalPossibleGain: Math.round(top4TotalGain * 10) / 10
            };
        }
        
        // ë“±ê¸‰ë³„ ëª©í‘œ ì ìˆ˜ ë°˜í™˜
        function getTargetScore(grade) {
            var scoreMap = {
                1: 90,
                2: 80,
                3: 70,
                4: 60,
                5: 50,
                6: 40
            };
            return scoreMap[grade] || 90;
        }
        
       // ë‹¤ì¸µ ë¶„ì„ ë°©ì‹ìœ¼ë¡œ ê°œì„  í•„ìš” ê³¼ëª© ì°¾ê¸°
function analyzeWeaknesses(subjectRatios, subjectAverages) {
    var weaknesses = [];
    var studentAvg = Object.values(subjectAverages).reduce((a, b) => a + b, 0) / Object.values(subjectAverages).length;
    
    // ğŸ†• ê³¼ëª©ë³„ ìµœê·¼ 4íšŒ í‰ê·  ê³„ì‚°
    var recentAverages = {};
    Object.keys(subjectRatios).forEach(function(subject) {
        var ratios = subjectRatios[subject];
        if (ratios.length > 0) {
            var recentRatios = ratios.slice(-4);
            recentAverages[subject] = recentRatios.reduce((a, b) => a + b) / recentRatios.length;
        }
    });
    
    // ğŸ†• í•™ìƒì˜ ìµœê·¼ 4íšŒ ê³¼ëª©ë³„ í‰ê· ë“¤ì˜ í‰ê·  ê³„ì‚°
    var studentRecentAvg = Object.values(recentAverages).reduce((a, b) => a + b, 0) / Object.values(recentAverages).length;
    
    Object.keys(subjectRatios).forEach(function(subject) {
        var ratios = subjectRatios[subject];
        if (ratios.length === 0) return;
        
        var recentRatios = ratios.slice(-4);
        var recentAvg = recentAverages[subject];
        
        // ğŸ”§ ìƒˆë¡œìš´ ê°œì„  ê¸°ì¤€
        var criteria = {
            // 1. ì ˆëŒ€ì  ê¸°ì¤€ (ì™„í™”)
            absoluteLow: recentAvg < 70,                          // ê¸°ë³¸ 70% ë¯¸ë§Œ
            
            // 2. ğŸ†• ìƒëŒ€ì  ê¸°ì¤€ (ê°œì¸ ë‚´ ë¹„êµ) - í•µì‹¬!
            relativeToSelf: recentAvg < studentRecentAvg - 10,    // ê°œì¸ í‰ê· ë³´ë‹¤ 10% ì´ìƒ ë‚®ìŒ
            relativeToSelfStrict: recentAvg < studentRecentAvg * 0.85,  // ê°œì¸ í‰ê· ì˜ 85% ë¯¸ë§Œ
            
            // 3. ğŸ†• ë‹¤ë¥¸ ê³¼ëª©ê³¼ì˜ ê²©ì°¨
            bigGap: checkSubjectGap(recentAvg, recentAverages),   // ë‹¤ë¥¸ ê³¼ëª©ë“¤ê³¼ í° ê²©ì°¨
            
            // 4. í•˜ë½ ì¶”ì„¸ (ê¸°ì¡´ ìœ ì§€, ì™„í™”)
            declining: calculateSimpleTrend(ratios) < -8,         // 8% ì´ìƒ í•˜ë½ ì¶”ì„¸
            
            // 5. ğŸ†• ì¼ê´€ì„± ë¶€ì¡± (ì•ˆì •ì„± ëŒ€ì‹ )
            inconsistent: Math.max(...recentRatios) - Math.min(...recentRatios) > 25  // í¸ì°¨ 25% ì´ìƒ
        };
        
        var criteriaCount = Object.values(criteria).filter(Boolean).length;
        
        // ğŸ”§ ê°œì„  í•„ìš” íŒì •: 1ê°œ ì´ìƒ ì¡°ê±´ ì¶©ì¡±
        if (criteriaCount >= 1) {
            var description = generateWeaknessDescription(criteria, recentAvg, studentRecentAvg);
            
            weaknesses.push({
                subject: subject,
                average: Math.round(recentAvg * 10) / 10,
                criteriaCount: criteriaCount,
                description: description,
                // ğŸ”§ ìš°ì„ ìˆœìœ„ ì¬ì¡°ì •
                urgency: criteria.relativeToSelf || criteria.bigGap ? 'high' : 
                        criteria.absoluteLow || criteriaCount >= 3 ? 'medium' : 'low'
            });
        }
    });
    
    // ğŸ”§ ì •ë ¬: ìƒëŒ€ì  ì•½ì  â†’ ì ˆëŒ€ì  ì•½ì  â†’ ê¸°ì¤€ ì¶©ì¡± ê°œìˆ˜ ìˆœ
    weaknesses.sort((a, b) => {
        // ìƒëŒ€ì  ì•½ì (ê°œì¸ ë‚´ ë¹„êµ) ìš°ì„ 
        var aRelative = a.description.includes('ê°œì¸ í‰ê· ë³´ë‹¤') || a.description.includes('ë‹¤ë¥¸ ê³¼ëª© ëŒ€ë¹„');
        var bRelative = b.description.includes('ê°œì¸ í‰ê· ë³´ë‹¤') || b.description.includes('ë‹¤ë¥¸ ê³¼ëª© ëŒ€ë¹„');
        
        if (aRelative !== bRelative) {
            return bRelative - aRelative;
        }
        
        return b.criteriaCount - a.criteriaCount;
    });
    
    return weaknesses;
}

// ğŸ†• ë‹¤ë¥¸ ê³¼ëª©ê³¼ì˜ ê²©ì°¨ ì²´í¬ í•¨ìˆ˜
function checkSubjectGap(subjectAvg, allAverages) {
    var otherAverages = Object.values(allAverages).filter(avg => avg !== subjectAvg);
    if (otherAverages.length === 0) return false;
    
    var otherAvg = otherAverages.reduce((a, b) => a + b) / otherAverages.length;
    
    // ë‹¤ë¥¸ ê³¼ëª© í‰ê· ë³´ë‹¤ 15% ì´ìƒ ë‚®ìœ¼ë©´ ê²©ì°¨ ìˆìŒ
    return subjectAvg < otherAvg - 15;
}

// ğŸ†• ì•½ì  ì„¤ëª… ìƒì„± í•¨ìˆ˜
function generateWeaknessDescription(criteria, recentAvg, studentRecentAvg) {
    var reasons = [];
    
    if (criteria.relativeToSelf) {
        var gap = Math.round((studentRecentAvg - recentAvg) * 10) / 10;
        reasons.push("ê°œì¸ í‰ê· ë³´ë‹¤ " + gap + "% ë‚®ìŒ");
    }
    
    if (criteria.bigGap) {
        reasons.push("ë‹¤ë¥¸ ê³¼ëª© ëŒ€ë¹„ í° ê²©ì°¨");
    }
    
    if (criteria.absoluteLow) {
        reasons.push("ì ˆëŒ€ì  ê°œì„  í•„ìš”");
    }
    
    if (criteria.declining) {
        reasons.push("í•˜ë½ ì¶”ì„¸");
    }
    
    if (criteria.inconsistent) {
        reasons.push("ì„±ì·¨ë„ í¸ì°¨ í¼");
    }
    
    if (criteria.relativeToSelfStrict && !criteria.relativeToSelf) {
        reasons.push("ê°œì¸ í‰ê·  ëŒ€ë¹„ ì €ì¡°");
    }
    
    return reasons.join(', ') + " (ìµœê·¼ 4íšŒ: " + Math.round(recentAvg * 10) / 10 + "%)";
}
        
        // í•˜ì´ë¸Œë¦¬ë“œ ì¶”ì„¸ ë¶„ì„
        function calculateHybridTrend(ratios) {
            if (ratios.length < 4) return null;
            
            // 1. ìµœê·¼ 4íšŒ vs ì´ì „ ë°ì´í„° ë¹„êµ
            var recent4 = ratios.slice(-4);
            var earlier = ratios.slice(0, -4);
            
            var recentAvg = recent4.reduce((a, b) => a + b) / recent4.length;
            var earlierAvg = earlier.length > 0 ? 
                earlier.reduce((a, b) => a + b) / earlier.length : recentAvg;
            
            var shortTermTrend = Math.round((recentAvg - earlierAvg) * 10) / 10;
            
            // 2. ìµœê³ ì  ëŒ€ë¹„ í˜„ì¬ ìœ„ì¹˜
            var maxScore = Math.max(...ratios);
            var currentScore = ratios[ratios.length - 1];
            var peakMaintenance = Math.round((currentScore / maxScore) * 100);
            
            // 3. ì•ˆì •ì„± ê³„ì‚°
            var avg = ratios.reduce((a, b) => a + b) / ratios.length;
            var variance = ratios.reduce((sum, val) => sum + Math.pow(val - avg, 2), 0) / ratios.length;
            var stability = Math.max(0, Math.round((100 - Math.sqrt(variance)) * 10) / 10);
            
            // 4. íŒ¨í„´ ì¸ì‹
            var pattern = determinePattern(ratios);
            
            return {
                shortTermTrend: shortTermTrend,
                peakMaintenance: peakMaintenance,
                stability: stability,
                pattern: pattern
            };
        }
        
        // ê°„ë‹¨í•œ ì¶”ì„¸ ê³„ì‚° (ë‹¤ì¸µ ë¶„ì„ìš©)
        function calculateSimpleTrend(ratios) {
            if (ratios.length < 3) return 0;
            var recent = ratios.slice(-3);
            var earlier = ratios.slice(0, -3);
            if (earlier.length === 0) return 0;
            
            var recentAvg = recent.reduce((a, b) => a + b) / recent.length;
            var earlierAvg = earlier.reduce((a, b) => a + b) / earlier.length;
            return recentAvg - earlierAvg;
        }
        
        // ì•ˆì •ì„± ê³„ì‚°
        function calculateStability(ratios) {
            var avg = ratios.reduce((a, b) => a + b) / ratios.length;
            var variance = ratios.reduce((sum, val) => sum + Math.pow(val - avg, 2), 0) / ratios.length;
            return Math.max(0, 100 - Math.sqrt(variance));
        }
        
        // íŒ¨í„´ ê²°ì •
        function determinePattern(ratios) {
            var improvements = 0;
            var declines = 0;
            
            for (var i = 1; i < ratios.length; i++) {
                var change = ratios[i] - ratios[i-1];
                if (change > 3) improvements++;
                else if (change < -3) declines++;
            }
            
            if (improvements > declines) return 'improving';
            else if (declines > improvements) return 'declining';
            else return 'stable';
        }
        
        // ê°•ë„ í‘œí˜„ í•¨ìˆ˜
        function getIntensityDescription(trendValue) {
            var abs = Math.abs(trendValue);
            if (abs >= 20) return trendValue > 0 ? 'ëšœë ·í•œ ê¸‰ìƒìŠ¹' : 'ëšœë ·í•œ ê¸‰ë½';
            else if (abs >= 15) return trendValue > 0 ? 'ê¸‰ìƒìŠ¹' : 'ê¸‰ë½';
            else if (abs >= 10) return trendValue > 0 ? 'ìƒìŠ¹' : 'í•˜ë½';
            else return trendValue > 0 ? 'ì™„ë§Œí•œ ìƒìŠ¹' : 'ì™„ë§Œí•œ í•˜ë½';
        }
        
        function displayAIAnalysis(analysis) {
            var aiContentDiv = document.getElementById('aiContent');
            var summary = analysis.summary;
            
            var html = `
                <div class="analysis-grid">
                    <div class="analysis-card">
                        <h4>ğŸ“Š í˜„ì¬ ì„±ì  í˜„í™© (ê³ 3)</h4>
                        <p><strong>ì‘ì‹œ í˜„í™©:</strong> ${summary.testCount}/${summary.totalTests}íšŒ ëª¨ì˜ê³ ì‚¬</p>
                        <p><strong>ìµœê³  ì„±ì :</strong> ${summary.bestGrade}ë“±ê¸‰ ${summary.bestScore}ì  (${summary.bestTest}${summary.bestTestSource ? ' ' + summary.bestTestSource : ''})</p>
                        ${summary.bestTestSubjectType ? '<p><strong>ì„ íƒê³¼ëª©:</strong> <span class="subject-type ' + summary.bestTestSubjectType.replace(/\s/g, '_') + '">' + summary.bestTestSubjectType + '</span></p>' : ''}
                        <p><strong>í‰ê·  ë“±ê¸‰:</strong> ${summary.avgGrade}ë“±ê¸‰</p>
                        <p><strong>í‰ê·  ì ìˆ˜:</strong> ${summary.avgScore}ì </p>
                        <p><strong>í˜„ì¬ ë“±ê¸‰:</strong> <span class="grade-${summary.latestGrade}">${summary.latestGrade}ë“±ê¸‰</span></p>
                    </div>
                    
                    <div class="analysis-card">
                        <h4>ğŸ¯ ê°•ì  ê³¼ëª© ë¶„ì„</h4>
                        ${analysis.strengths.length > 0 ? 
                            analysis.strengths.map((s, i) => `
                                <div style="margin: 8px 0;">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span>${i + 1}. ${s.subject}</span>
                                        <span style="font-weight: bold; color: #10b981;">${s.average}%</span>
                                    </div>
                                    <div class="progress-bar-container">
                                        <div class="progress-bar-fill grade-excellent" style="width: ${s.average}%"></div>
                                    </div>
                                </div>
                            `).join('') : 
                            '<p style="color: rgba(255,255,255,0.8);">ê°•ì  ê³¼ëª©ì„ ë¶„ì„í•˜ë ¤ë©´ ë” ë§ì€ ë°ì´í„°ê°€ í•„ìš”í•©ë‹ˆë‹¤.</p>'
                        }
                    </div>
                </div>
                
                <div class="analysis-grid">
                    <div class="analysis-card">
                        <h4>âš ï¸ ê°œì„  í•„ìš” ê³¼ëª©</h4>
                        ${analysis.weaknesses.length > 0 ? 
                            analysis.weaknesses.map((w, i) => `
                                <div style="margin: 8px 0;">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span>${i + 1}. ${w.subject}</span>
                                        <span style="font-weight: bold; color: #f87171; font-size: 0.9em;">${w.average}%</span>
                                    </div>
                                    <div style="font-size: 0.8em; color: rgba(255,255,255,0.8); margin-top: 4px;">
                                        ${w.description}
                                    </div>
                                    <div class="progress-bar-container">
                                        <div class="progress-bar-fill grade-poor" style="width: ${w.average}%"></div>
                                    </div>
                                </div>
                            `).join('') : 
                            '<p style="color: rgba(255,255,255,0.8);">ëª¨ë“  ê³¼ëª©ì´ ì–‘í˜¸í•œ ìƒíƒœì…ë‹ˆë‹¤.</p>'
                        }
                    </div>
                    
                    <div class="analysis-card">
                        <h4>ğŸ“ˆ ì„±ì  ì¶”ì´ ë¶„ì„</h4>
                        ${analysis.trends.length > 0 ? 
                            analysis.trends.map(t => `
                                <div style="margin: 8px 0; display: flex; align-items: center; gap: 8px;">
                                    <span class="trend-${t.type}">${t.type === 'up' ? 'ğŸ“ˆ' : 'ğŸ“‰'}</span>
                                    <span style="flex: 1;">${t.subject}</span>
                                    <div style="display: flex; flex-direction: column; align-items: end;">
                                        <span style="font-weight: bold; color: ${t.type === 'up' ? '#10b981' : '#f87171'};">
                                            ${t.intensity}
                                        </span>
                                        <span style="font-size: 0.75em; opacity: 0.8;">
                                            (${t.shortTermTrend > 0 ? '+' : ''}${t.shortTermTrend}%)
                                        </span>
                                    </div>
                                </div>
                            `).join('') : 
                            '<p style="color: rgba(255,255,255,0.8);">ì¶”ì´ ë¶„ì„ì„ ìœ„í•´ ë” ë§ì€ ì‹œí—˜ ë°ì´í„°ê°€ í•„ìš”í•©ë‹ˆë‹¤.</p>'
                        }
                    </div>
                </div>
            `;
            
            // êµ¬ì²´ì  ë“±ê¸‰ ìƒìŠ¹ ì „ëµ ì„¹ì…˜ ì¶”ê°€
            if (analysis.gradeStrategy) {
                var strategy = analysis.gradeStrategy;
                var possibilityClass = 'possibility-' + strategy.possibility;
                var possibilityText = strategy.possibility === 'high' ? 'ë§¤ìš° ë†’ìŒ' : 
                                    strategy.possibility === 'medium' ? 'ë³´í†µ' : 'ë‚®ìŒ';
                
                html += `
                    <div class="grade-strategy">
                        <h4>ğŸ¯ êµ¬ì²´ì  ë“±ê¸‰ ìƒìŠ¹ ì „ëµ</h4>
                        
                        <div style="margin-bottom: 20px;">
                            <h5 style="margin-bottom: 10px; color: rgba(255,255,255,0.9);">ğŸ“Š ìµœê·¼ 4íšŒ ì‹œí—˜ í˜„í™©</h5>
                            <div class="recent-tests-grid">
                                ${strategy.recentTests.map(test => `
                                    <div class="recent-test-item">
                                        <div class="recent-test-name">${test.name}</div>
                                        <div class="recent-test-grade grade-${test.grade}">${test.grade}ë“±ê¸‰</div>
                                        <div class="recent-test-score">${test.score}ì </div>
                                    ${test.subjectType ? '<div style="font-size: 0.7em; opacity: 0.8;">' + test.subjectType + '</div>' : ''}
                                    </div>
                                `).join('')}
                            </div>
                            <div style="text-align: center; margin-top: 10px; font-size: 0.9em; opacity: 0.9;">
                                í‰ê· : ${strategy.recentAvgGrade}ë“±ê¸‰ ${strategy.recentAvgScore}ì 
                            </div>
                        </div>
                        
                        <div class="target-analysis">
                            <div class="target-header">
                                <div>
                                    <div class="target-grade">${strategy.targetGrade}ë“±ê¸‰ ë‹¬ì„± ì „ëµ</div>
                                    <div style="font-size: 1.0em; opacity: 0.9; margin-top: 5px;">
                                        ëª©í‘œ ì ìˆ˜: <strong>${strategy.targetScore}ì  ì´ìƒ</strong> 
                                        <span style="font-size: 1.2em; font-weight: bold; color: #10b981; padding: 2px 8px; border-radius: 12px; margin-left: 8px;">
                                            í˜„ì¬ í‰ê·  ëŒ€ë¹„ ${strategy.neededPoints > 0 ? '+' : ''}${strategy.neededPoints}ì 
                                        </span>
                                    </div>
                                </div>
                                <div class="target-possibility ${possibilityClass}">
                                    ${strategy.possibility === 'high' ? 'ğŸ’š' : strategy.possibility === 'medium' ? 'ğŸ’›' : 'ğŸ”¶'} ë‹¬ì„± ê°€ëŠ¥ì„±: ${possibilityText}
                                </div>
                            </div>
                        </div>
                        
                        ${strategy.subjectStrategies.length > 0 ? `
                            <div>
                                <h5 style="margin: 15px 0 10px 0; color: rgba(255,255,255,0.9);">ğŸ“ˆ ê³¼ëª©ë³„ ì ìˆ˜ í™•ë³´ ì „ëµ</h5>
                                <div class="subject-strategy-list">
                                    ${strategy.subjectStrategies.map((subj, i) => `
                                        <div class="subject-strategy-item">
                                            <div class="subject-strategy-left">
                                                <div class="subject-name">${i + 1}. ${subj.subject}</div>
                                                <div class="subject-detail">
                                                    ì„±ì·¨ë„ ${subj.currentAvg}% 
                                                    <span style="color: ${subj.strategyColor}; font-weight: bold; padding: 2px 6px; border-radius: 8px; margin-left: 5px;">
                                                        ${subj.strategy}
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="subject-strategy-right">
                                                <div class="points-gain">+${subj.possibleGain}ì  í™•ë³´ ê°€ëŠ¥</div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                                
                                <div class="total-strategy">
                                    <div class="total-points">
                                        <span>ğŸ’¡ ì´ í™•ë³´ ê°€ëŠ¥ ì ìˆ˜: +${strategy.totalPossibleGain}ì </span>
                                        <span style="color: ${strategy.totalPossibleGain >= strategy.neededPoints ? '#10b981' : '#f59e0b'};">
                                            ${strategy.totalPossibleGain >= strategy.neededPoints ? 
                                                'ëª©í‘œ ë‹¬ì„±ì„ ìœ„í•œ ' + strategy.neededPoints + 'ì  í™•ë³´ ì¶©ë¶„íˆ ê°€ëŠ¥!' : 
                                                'ëª©í‘œ ë‹¬ì„±ì„ ìœ„í•´ ì¶”ê°€ ë…¸ë ¥ í•„ìš”'}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `;
            }
            
            if (analysis.recommendations.length > 0) {
                html += `
                    <div class="ai-recommendations">
                        <h4>ğŸ’¡ ì •ë™ë¯¼êµ­ì–´ë…¼ìˆ í•™ì› ë§ì¶¤ í•™ìŠµ ì „ëµ</h4>
                        ${analysis.recommendations.map(r => `
                            <div class="recommendation-item">
                                <div class="recommendation-priority">ìš°ì„ ìˆœìœ„: ${r.priority}</div>
                                <div style="font-weight: bold;">${r.action}</div>
                                <div style="font-size: 0.9em; opacity: 0.9;">${r.reason}</div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            aiContentDiv.innerHTML = html;
        }

        // HEX ìƒ‰ìƒì„ RGBë¡œ ë³€í™˜í•˜ëŠ” í—¬í¼ í•¨ìˆ˜
        function hexToRgb(hex) {
            var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            if (result) {
                var r = parseInt(result[1], 16);
                var g = parseInt(result[2], 16);
                var b = parseInt(result[3], 16);
                return r + ',' + g + ',' + b;
            }
            return '0,0,0';
        }

        // ê´€ë¦¬ì ì¸ì¦ í™•ì¸
        function checkAdminPassword() {
            var password = document.getElementById('adminPassword').value.trim();
            
            if (password === '1212') {
                isAdminAuthenticated = true;
                localStorage.setItem('winter3-adminAuth', 'true');
                
                document.getElementById('adminAuthSection').style.display = 'none';
                document.getElementById('githubSetup').style.display = 'block';
                
                showStatus('âœ… ê´€ë¦¬ì ì¸ì¦ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                
                // ê¸°ì¡´ ì„¤ì •ì´ ìˆë‹¤ë©´ ë¡œë“œ
                loadExistingConfig();
            } else {
                showStatus('âŒ ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'error');
                document.getElementById('adminPassword').value = '';
            }
        }
        
        // ê´€ë¦¬ì ì ‘ê·¼ ì´ˆê¸°í™”
        function resetAdminAccess() {
            isAdminAuthenticated = false;
            localStorage.removeItem(''winter3-adminAuth');        // âœ… ìˆ˜ì •
            localStorage.removeItem(''winter3-githubConfig');     // âœ… ìˆ˜ì •
            localStorage.removeItem(''winter3-dataUrl');          // âœ… ìˆ˜ì •
            
            document.getElementById('adminAuthSection').style.display = 'block';
            document.getElementById('githubSetup').style.display = 'none';
            document.getElementById('uploadSection').style.display = 'none';
            
            document.getElementById('adminPassword').value = '';
            showStatus('ğŸ”„ ê´€ë¦¬ì ì ‘ê·¼ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'warning');
        }
        
        // ê¸°ì¡´ ì„¤ì • ë¡œë“œ
        function loadExistingConfig() {
            var savedConfig = localStorage.getItem('winter3-githubConfig');
            var savedDataUrl = localStorage.getItem('winter3-dataUrl');
            
            if (savedConfig && savedDataUrl) {
                try {
                    githubConfig = JSON.parse(savedConfig);
                    dataUrl = savedDataUrl;
                    
                    // ì…ë ¥ í•„ë“œì— ê¸°ì¡´ ê°’ ì±„ìš°ê¸°
                    document.getElementById('githubUsername').value = githubConfig.username || '';
                    document.getElementById('githubRepo').value = githubConfig.repo || '';
                    if (githubConfig.token) {
                        document.getElementById('githubToken').value = githubConfig.token;
                    }
                    
                    // UI ì „í™˜
                    document.getElementById('githubSetup').style.display = 'none';
                    document.getElementById('uploadSection').style.display = 'block';
                    
                    // ë°ì´í„° ë¡œë“œ ì‹œë„
                    loadDataFromGitHub();
                } catch (error) {
                    console.error('ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:', error);
                }
            }
        }

        function switchTab(tabName) {
            var tabs = document.querySelectorAll('.tab');
            var contents = document.querySelectorAll('.tab-content');
            
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            for (var i = 0; i < contents.length; i++) {
                contents[i].classList.remove('active');
            }
            
            if (tabName === 'student') {
                document.querySelector('.tab').classList.add('active');
                document.getElementById('studentTab').classList.add('active');
            } else {
                document.querySelectorAll('.tab')[1].classList.add('active');
                document.getElementById('adminTab').classList.add('active');
                
                // ê´€ë¦¬ì íƒ­ ì ‘ê·¼ ì‹œ ì¸ì¦ ìƒíƒœ í™•ì¸
                checkAdminAuthStatus();
            }
        }
        
        // ê´€ë¦¬ì ì¸ì¦ ìƒíƒœ í™•ì¸
        function checkAdminAuthStatus() {
            var savedAuth = localStorage.getItem('winter3-adminAuth');
            
            if (savedAuth === 'true') {
                isAdminAuthenticated = true;
                document.getElementById('adminAuthSection').style.display = 'none';
                document.getElementById('githubSetup').style.display = 'block';
                loadExistingConfig();
            } else {
                isAdminAuthenticated = false;
                document.getElementById('adminAuthSection').style.display = 'block';
                document.getElementById('githubSetup').style.display = 'none';
                document.getElementById('uploadSection').style.display = 'none';
            }
        }

        // GitHub ì„¤ì • ì €ì¥
        function saveGitHubConfig() {
            if (!isAdminAuthenticated) {
                showStatus('âŒ ê´€ë¦¬ì ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'error');
                return;
            }
            
            var username = document.getElementById('githubUsername').value.trim();
            var repo = document.getElementById('githubRepo').value.trim();
            var token = document.getElementById('githubToken').value.trim();
            
            if (!username || !repo) {
                showStatus('GitHub ì‚¬ìš©ìëª…ê³¼ ì €ì¥ì†Œ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            githubConfig = {
                username: username,
                repo: repo,
                token: token
            };
            
            dataUrl = 'https://raw.githubusercontent.com/' + username + '/' + repo + '/main/winter3-data.json';
            
            localStorage.setItem('winter3-githubConfig', JSON.stringify(githubConfig));
            localStorage.setItem('winter3-dataUrl', dataUrl);
            
            showStatus('GitHub ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            
            document.getElementById('githubSetup').style.display = 'none';
            document.getElementById('uploadSection').style.display = 'block';
            
            loadDataFromGitHub();
        }
        
        // GitHub ì—°ê²° í…ŒìŠ¤íŠ¸
        function testGitHubConnection() {
            if (!isAdminAuthenticated) {
                showStatus('âŒ ê´€ë¦¬ì ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'error');
                return;
            }
            
            var username = document.getElementById('githubUsername').value.trim();
            var repo = document.getElementById('githubRepo').value.trim();
            
            if (!username || !repo) {
                showStatus('ì‚¬ìš©ìëª…ê³¼ ì €ì¥ì†Œ ì´ë¦„ì„ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            var testUrl = 'https://api.github.com/repos/' + username + '/' + repo;
            
            showStatus('ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...', 'warning');
            
            fetch(testUrl)
                .then(function(response) {
                    if (response.ok) {
                        showStatus('âœ… ì €ì¥ì†Œ ì—°ê²° ì„±ê³µ! ì„¤ì •ì„ ì €ì¥í•´ì£¼ì„¸ìš”.', 'success');
                    } else if (response.status === 404) {
                        showStatus('âŒ ì €ì¥ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì‚¬ìš©ìëª…ê³¼ ì €ì¥ì†Œ ì´ë¦„ì„ í™•ì¸í•´ì£¼ì„¸ìš”.', 'error');
                    } else {
                        showStatus('âŒ ì—°ê²° ì‹¤íŒ¨. ì €ì¥ì†Œê°€ Publicì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.', 'error');
                    }
                })
                .catch(function(error) {
                    showStatus('âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                });
        }
        
        // GitHubì—ì„œ ë°ì´í„° ë¡œë“œ
        function loadDataFromGitHub() {
            if (!dataUrl) {
                console.log('ë°ì´í„° URLì´ ì„¤ì •ë˜ì§€ ì•ŠìŒ');
                return false;
            }
            
            updateDataStatus('ì˜¨ë¼ì¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...');
            console.log('ë°ì´í„° ë¡œë“œ ì‹œë„:', dataUrl);
            
            var requestUrl = dataUrl + '?t=' + Date.now() + '&cache=' + Math.random();
            
            fetch(requestUrl)
                .then(function(response) {
                    console.log('ì‘ë‹µ ìƒíƒœ:', response.status);
                    if (!response.ok) {
                        if (response.status === 404) {
                            throw new Error('ë°ì´í„° íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê´€ë¦¬ìê°€ ì•„ì§ ë°ì´í„°ë¥¼ ì—…ë¡œë“œí•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                        } else {
                            throw new Error('ì„œë²„ ì˜¤ë¥˜ (' + response.status + ')');
                        }
                    }
                    return response.text();
                })
                .then(function(text) {
                    console.log('ë°›ì€ ë°ì´í„° í¬ê¸°:', text.length);
                    
                    var data;
                    try {
                        data = JSON.parse(text);
                    } catch (parseError) {
                        console.error('JSON íŒŒì‹± ì˜¤ë¥˜:', parseError);
                        throw new Error('ë°ì´í„° í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                    }
                    
                    console.log('íŒŒì‹±ëœ ë°ì´í„°:', data);
                    
                    if (!data || typeof data !== 'object') {
                        throw new Error('ë°ì´í„° êµ¬ì¡°ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                    }
                    
                    studentByNumber = data.students || {};
                    maxScores = Object.assign({}, maxScores, data.maxScores || {});
                    window.discoveredTestSheets = data.testSheets || [];
                    window.attendanceToNameMap = data.attendanceMap || {};
                    
                    var studentCount = Object.keys(studentByNumber).length;
                    console.log('ë¡œë“œëœ í•™ìƒ ìˆ˜:', studentCount);
                    
                    isDataLoaded = studentCount > 0;
                    
                    if (isDataLoaded) {
                        updateDataStatus('âœ… ì„±ì  ë°ì´í„°ê°€ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤!', true, data.lastUpdated);
                        console.log('ë°ì´í„° ë¡œë“œ ì„±ê³µ!');
                    } else {
                        updateDataStatus('ì—…ë¡œë“œëœ ë°ì´í„°ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.');
                        console.log('ë°ì´í„°ëŠ” ìˆì§€ë§Œ í•™ìƒ ì •ë³´ê°€ ì—†ìŒ');
                    }
                    
                    updateStudentTab();
                    return true;
                })
                .catch(function(error) {
                    console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                    updateDataStatus('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ' + error.message);
                    isDataLoaded = false;
                    updateStudentTab();
                    return false;
                });
        }
        
        // GitHubì— ë°ì´í„° ì—…ë¡œë“œ
        function uploadToGitHub(jsonData) {
            if (!githubConfig.username || !githubConfig.repo) {
                throw new Error('GitHub ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.');
            }
            
            var apiUrl = 'https://api.github.com/repos/' + githubConfig.username + '/' + githubConfig.repo + '/contents/winter3-data.json';
            
            return fetch(apiUrl)
                .then(function(response) {
                    if (response.ok) {
                        return response.json();
                    }
                    return null;
                })
                .then(function(existingFile) {
                    var requestBody = {
                        message: 'ê³ 3 ì„±ì  ë°ì´í„° ì—…ë°ì´íŠ¸ - ' + new Date().toLocaleString('ko-KR'),
                        content: btoa(unescape(encodeURIComponent(JSON.stringify(jsonData, null, 2))))
                    };
                    
                    if (existingFile && existingFile.sha) {
                        requestBody.sha = existingFile.sha;
                    }
                    
                    var headers = {
                        'Content-Type': 'application/json'
                    };
                    
                    if (githubConfig.token) {
                        headers['Authorization'] = 'token ' + githubConfig.token;
                    }
                    
                    return fetch(apiUrl, {
                        method: 'PUT',
                        headers: headers,
                        body: JSON.stringify(requestBody)
                    });
                })
                .then(function(response) {
                    if (!response.ok) {
                        if (response.status === 401) {
                            throw new Error('GitHub í† í°ì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                        } else if (response.status === 403) {
                            throw new Error('ì €ì¥ì†Œì— ì“°ê¸° ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. í† í° ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                        } else {
                            throw new Error('ì—…ë¡œë“œ ì‹¤íŒ¨ (' + response.status + ')');
                        }
                    }
                    return response.json();
                });
        }

        // ë“œë˜ê·¸ì•¤ë“œë¡­ ì´ë²¤íŠ¸ ì„¤ì •
        var uploadArea = document.getElementById('uploadArea');
        var fileInput = document.getElementById('fileInput');
        var processBtn = document.getElementById('processBtn');
        
        if (uploadArea) {
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                var files = e.dataTransfer.files;
                if (files.length > 0) {
                    fileInput.files = files;
                    processBtn.disabled = false;
                }
            });
        }
        
        if (fileInput) {
            fileInput.addEventListener('change', function() {
                processBtn.disabled = !fileInput.files.length;
            });
        }

        function processFileAndUpload() {
            if (!isAdminAuthenticated) {
                showStatus('âŒ ê´€ë¦¬ì ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'error');
                return;
            }
            
            var file = fileInput.files[0];
            if (!file) {
                showStatus('íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            if (!githubConfig.username || !githubConfig.repo) {
                showStatus('GitHub ì„¤ì •ì„ ë¨¼ì € ì™„ë£Œí•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            showProgress(true);
            updateProgress(10, 'íŒŒì¼ ì½ëŠ” ì¤‘...');
            
            var reader = new FileReader();
            reader.onload = function(e) {
                try {
                    updateProgress(30, 'ë°ì´í„° íŒŒì‹± ì¤‘...');
                    var data = new Uint8Array(e.target.result);
                    var workbook = XLSX.read(data, {type: 'array'});
                    
                    updateProgress(50, 'ê³ 3 í•™ìƒ ë°ì´í„° ì²˜ë¦¬ ì¤‘...');
                    parseExcelDatawinter3(workbook);
                    
                    updateProgress(70, 'GitHubì— ì—…ë¡œë“œ ì¤‘...');
                    
                    var uploadData = {
                    students: studentByNumber,
                    maxScores: maxScores,
                    testSheets: window.discoveredTestSheets,
                    attendanceMap: window.attendanceToNameMap,
                    lastUpdated: new Date().toISOString()
                };
                    
                    uploadToGitHub(uploadData)
                        .then(function(result) {
                            updateProgress(100, 'ì™„ë£Œ!');
                            setTimeout(function() {
                                showProgress(false);
                                showStatus('âœ… ê³ 3 ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ GitHubì— ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                                
                                setTimeout(function() {
                                    loadDataFromGitHub();
                                }, 1000);
                                
                                updateDataSummary();
                                updateStudentTab();
                            }, 500);
                        })
                        .catch(function(error) {
                            showProgress(false);
                            showStatus('GitHub ì—…ë¡œë“œ ì‹¤íŒ¨: ' + error.message, 'error');
                            console.error('ì—…ë¡œë“œ ì˜¤ë¥˜:', error);
                        });
                    
                } catch (error) {
                    showProgress(false);
                    showStatus('íŒŒì¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
                }
            };
            
            reader.readAsArrayBuffer(file);
        }

        
        
            
               
        // parseExcelDatawinter3 í•¨ìˆ˜ ìˆ˜ì • (ê¸°ì¡´ ë“±ê¸‰ì»· ì²˜ë¦¬ ë¶€ë¶„ êµì²´)
        function parseExcelDatawinter3(workbook) {
            var attendanceToNameMap = {};
            var studentsByName = {};
            var testSources = {};
            
            console.log('=== ê³ 3 ì—‘ì…€ ë°ì´í„° íŒŒì‹± ì‹œì‘ ===');
            console.log('ì‹œíŠ¸ ëª©ë¡:', workbook.SheetNames);
            
                       
            // 2. ì²«ë²ˆì§¸ ì‹œíŠ¸ì—ì„œ ì‹œí—˜ ì¶œì²˜ ì •ë³´ ì¶”ì¶œ (ê³ 2 ë°©ì‹)
            extractTestSourcesFromFirstSheet(workbook);

            // ì²« ë²ˆì§¸ ì‹œíŠ¸ì—ì„œ ì¶œì²˜ ì •ë³´ ì¶”ì¶œí•˜ëŠ” í•¨ìˆ˜ (ê³ 2 ë°©ì‹)
            function extractTestSourcesFromFirstSheet(workbook) {
                var testSources = {};
                
                var firstSheetName = workbook.SheetNames[0];
                if (!workbook.Sheets[firstSheetName]) {
                    console.log('ì²« ë²ˆì§¸ ì‹œíŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', firstSheetName);
                    return testSources;
                }
                
                var firstSheet = workbook.Sheets[firstSheetName];
                var firstSheetData = XLSX.utils.sheet_to_json(firstSheet, {header: 1});
                
                console.log('ì²« ë²ˆì§¸ ì‹œíŠ¸ì—ì„œ ì¶œì²˜ ì •ë³´ ì¶”ì¶œ:', firstSheetName);
                
                var sourceStartRow = -1;
                var testNameColumn = 0;  // Aì—´
                var sourceColumn = 12;   // Mì—´ (ì¸ë±ìŠ¤ 12)
                
                // "ì‹œí—˜ì¶œì²˜" í—¤ë”ê°€ ìˆëŠ” í–‰ ì°¾ê¸°
                for (var i = 0; i < firstSheetData.length; i++) {
                    var row = firstSheetData[i];
                    if (row) {
                        for (var j = 0; j < row.length; j++) {
                            if (row[j] && row[j].toString().includes('ì‹œí—˜ì¶œì²˜')) {
                                sourceStartRow = i + 1; // ë°ì´í„°ëŠ” ë‹¤ìŒ í–‰ë¶€í„°
                                console.log('ì‹œí—˜ì¶œì²˜ í—¤ë” ë°œê²¬, ë°ì´í„° ì‹œì‘ í–‰:', sourceStartRow + 1);
                                break;
                            }
                        }
                        if (sourceStartRow !== -1) break;
                    }
                }
                
                if (sourceStartRow === -1) {
                    console.log('ì‹œí—˜ì¶œì²˜ í—¤ë”ë¥¼ ì°¾ì§€ ëª»í•¨');
                    return testSources;
                }
                
                // ì‹œí—˜ ì¶œì²˜ ë°ì´í„° ì¶”ì¶œ
                for (var i = sourceStartRow; i < firstSheetData.length; i++) {
                    var row = firstSheetData[i];
                    if (row && row[testNameColumn] && row[sourceColumn]) {
                        var testName = row[testNameColumn].toString().trim();
                        var source = row[sourceColumn].toString().trim();
                        
                        if (testName.includes('ëª¨í´') || testName.includes('ì´ê°') || testName.includes('ì§„ë‹¨')) {
                            testSources[testName] = source;
                            console.log('ì¶œì²˜ ë§¤í•‘:', testName, '->', source);
                        }
                    }
                }
                
                window.testSources = testSources;
                console.log('ìµœì¢… ìˆ˜ì§‘ëœ ì‹œí—˜ ì¶œì²˜:', testSources);
                
                return testSources;
            }
            
            // 3. ì¶œê²°ë²ˆí˜¸-ì´ë¦„ ë§¤í•‘ ì²˜ë¦¬
            var mappingSheetName = workbook.SheetNames[1];
            if (workbook.Sheets[mappingSheetName]) {
                var mappingSheet = workbook.Sheets[mappingSheetName];
                var mappingData = XLSX.utils.sheet_to_json(mappingSheet, {header: 1});
                
                console.log('ì¶œê²°ë²ˆí˜¸-ì´ë¦„ ë§¤í•‘ ì‹œíŠ¸:', mappingSheetName);
                
                for (var i = 1; i < mappingData.length; i++) {
                    var row = mappingData[i];
                    if (row && row[0] && row[1]) {
                        var name = row[0];
                        var attendanceNumber = row[1];
                        attendanceToNameMap[attendanceNumber] = name;
                        
                        if (!studentsByName[name]) {
                            studentsByName[name] = {
                                name: name,
                                attendanceNumber: attendanceNumber,
                                grades: {}
                            };
                        }
                    }
                }
                
                console.log('ì´ ë§¤í•‘ëœ í•™ìƒ ìˆ˜:', Object.keys(attendanceToNameMap).length);
            }
            
            // 4. ëª¨í´ ì‹œíŠ¸ ì°¾ê¸°
            var allSheetNames = workbook.SheetNames;
            var testSheetNames = [];
            
            for (var i = 0; i < allSheetNames.length; i++) {
                var sheetName = allSheetNames[i];
                if ((sheetName.includes('ëª¨í´') || sheetName.includes('ì´ê°') || sheetName.includes('ì§„ë‹¨í‰ê°€')) && 
                    !sheetName.includes('ì„±ì í‘œ') && sheetName !== 'ë“±ê¸‰ì»·' && sheetName !== 'ì¶œê²°ë²ˆí˜¸') {
                    testSheetNames.push(sheetName);
                }
            }
            
            testSheetNames.sort(function(a, b) {
                var numA = parseInt(a.match(/\d+/));
                var numB = parseInt(b.match(/\d+/));
                return numA - numB;
            });
            
            console.log('ë°œê²¬ëœ ëª¨í´ ì‹œíŠ¸ë“¤:', testSheetNames);
            
            // 5. ë§Œì  ì¶”ì¶œ
            console.log('=== ê³ 3 ë§Œì  ì¶”ì¶œ ì‹œì‘ ===');
            extractMaxScoreswinter3(workbook, testSheetNames);
            console.log('ì¶”ì¶œ ì™„ë£Œëœ maxScores:', maxScores);
            
            // 6. í•™ìƒ ë°ì´í„° ì²˜ë¦¬
            console.log('=== í•™ìƒ ë°ì´í„° ì²˜ë¦¬ ì‹œì‘ ===');
            for (var s = 0; s < testSheetNames.length; s++) {
                var sheetName = testSheetNames[s];
                if (!workbook.Sheets[sheetName]) continue;
                
                console.log('ì²˜ë¦¬ ì¤‘ì¸ ì‹œíŠ¸:', sheetName);
                
                var worksheet = workbook.Sheets[sheetName];
                var jsonData = XLSX.utils.sheet_to_json(worksheet, {header: 1});
                
                if (jsonData.length <= 1) continue;
                
                var headers = jsonData[0];
                var sheetMaxScores = maxScores[sheetName] || {};
                
                console.log(sheetName + ' í—¤ë”:', headers);
                console.log(sheetName + ' ì²« ë²ˆì§¸ ë°ì´í„° í–‰:', jsonData[1]);

                for (var i = 1; i < jsonData.length; i++) {
                    var row = jsonData[i];
                    if (!row || !row[0]) continue;
                    
                    var name = row[0];
                    if (!studentsByName[name]) continue;
                    
                    var attendanceNumber = row[1];
                    var subjectTypeFromSheet = row[2]; // Cì—´: ì„ íƒê³¼ëª© (ì§ì ‘ ì½ê¸°)
                    var gradeFromSheet = row[3]; // Dì—´: ë“±ê¸‰ (ì§ì ‘ ì½ê¸°)
                    var scoreFromSheet = row[4]; // Eì—´: ì ìˆ˜
                    
                    console.log('\n=== í•™ìƒ ì²˜ë¦¬:', name, '(' + attendanceNumber + ') ===');
                    console.log('ì„ íƒê³¼ëª©:', subjectTypeFromSheet);
                    console.log('ë“±ê¸‰:', gradeFromSheet);
                    console.log('ì ìˆ˜:', scoreFromSheet);
                    
                    // ì²« ë²ˆì§¸ ì‹œíŠ¸ì—ì„œ ì¶”ì¶œí•œ ì¶œì²˜ ì •ë³´ ì‚¬ìš©
                    var source = '';
                    if (window.testSources && window.testSources[sheetName]) {
                        source = window.testSources[sheetName];
                    }
                    console.log('ì‹œí—˜:', sheetName, 'ì¶œì²˜:', source);
                    
                    // ê³¼ëª©ë³„ ì ìˆ˜ ìˆ˜ì§‘ (Fì—´ë¶€í„°)
                    var details = {};
                    var ratios = {};
                    
                    for (var j = 5; j < Math.min(headers.length, row.length); j++) {
                        var subject = headers[j];
                        var subjectScore = row[j];
                        
                        if (subject && subjectScore !== null && subjectScore !== undefined && subjectScore !== '') {
                            details[subject] = subjectScore;
                            
                            var maxScore = sheetMaxScores[subject];
                            if (maxScore) {
                                ratios[subject] = Math.round((subjectScore / maxScore) * 100);
                            } else {
                                // í™”ë²•ê³¼ ì‘ë¬¸ ë§Œì  ì¶”ì •
                                if (subject.includes('í™”ë²•') || subject.includes('ì‘ë¬¸')) {
                                    var estimatedMax = 22;
                                    if (sheetName === 'ëª¨í´4íšŒ' || sheetName === 'ëª¨í´5íšŒ') {
                                        estimatedMax = 13;
                                    }
                                    ratios[subject] = Math.round((subjectScore / estimatedMax) * 100);
                                }
                            }
                        }
                    }
                    
                    // 1. ì„ íƒê³¼ëª©ì€ Cì—´ì—ì„œ ì§ì ‘ ì½ê¸°
                    var finalSubjectType = subjectTypeFromSheet || 'í™”ë²•ê³¼ ì‘ë¬¸';
                    
                    // 2. ë“±ê¸‰ì€ Dì—´ì—ì„œ ì§ì ‘ ì½ê¸° (nullì´ë©´ null ê·¸ëŒ€ë¡œ)
                    var finalGrade = null;
                    if (gradeFromSheet && gradeFromSheet !== '' && gradeFromSheet !== null) {
                        finalGrade = parseInt(gradeFromSheet);
                    }
                    
                   
                    
                    studentsByName[name].grades[sheetName] = {
                        grade: finalGrade,
                        score: scoreFromSheet,
                        subjectType: finalSubjectType,
                        details: details,
                        ratios: ratios,
                        source: source
                    };
                }
                
            }
            
            // 7. ìµœì¢… ë°ì´í„° êµ¬ì„±
            studentByNumber = {};
            for (var attendanceNumber in attendanceToNameMap) {
                var name = attendanceToNameMap[attendanceNumber];
                if (studentsByName[name]) {
                    studentByNumber[attendanceNumber] = studentsByName[name];
                }
            }
            
            window.discoveredTestSheets = testSheetNames;
            window.attendanceToNameMap = attendanceToNameMap;
            isDataLoaded = true;
            
            console.log('ìµœì¢… ì²˜ë¦¬ëœ í•™ìƒ ìˆ˜:', Object.keys(studentByNumber).length);
            console.log('ìµœì¢… ë“±ê¸‰ì»· ë°ì´í„°:', gradeCutData);
            
            // ë””ë²„ê¹…: ì²« ë²ˆì§¸ í•™ìƒì˜ ë°ì´í„° í™•ì¸
            var firstStudentKey = Object.keys(studentByNumber)[0];
            if (firstStudentKey) {
                console.log('ì²« ë²ˆì§¸ í•™ìƒ ë°ì´í„° í™•ì¸:', studentByNumber[firstStudentKey]);
            }
        }

        function extractMaxScoreswinter3(workbook, testSheetNames) {
            console.log('ê³ 3 ê° ì‹œíŠ¸ì—ì„œ ì§ì ‘ ë§Œì  ì¶”ì¶œ ì‹œì‘...');
            
            maxScores = {};
            
            for (var i = 0; i < testSheetNames.length; i++) {
                var sheetName = testSheetNames[i];
                if (!workbook.Sheets[sheetName]) continue;
                
                var worksheet = workbook.Sheets[sheetName];
                var sheetData = XLSX.utils.sheet_to_json(worksheet, {header: 1});
                
                if (sheetData.length <= 1) continue;
                
                var headers = sheetData[0];
                console.log(sheetName + ' í—¤ë”:', headers);
                
                maxScores[sheetName] = {};
                
                // ê³ 3ì€ 5ë²ˆì§¸ ì—´ë¶€í„° ê³¼ëª© ì‹œì‘ (0ë¶€í„° ì„¸ë©´ ì¸ë±ìŠ¤ 5)
                for (var colIndex = 5; colIndex < headers.length; colIndex++) {
                    var subject = headers[colIndex];
                    if (!subject) continue;
                    
                    var maxScore = 0;
                    var validScores = [];
                    
                    for (var rowIndex = 1; rowIndex < sheetData.length; rowIndex++) {
                        var row = sheetData[rowIndex];
                        if (row && row[colIndex] !== null && row[colIndex] !== undefined && row[colIndex] !== '') {
                            var score = parseFloat(row[colIndex]);
                            if (!isNaN(score) && score > 0) {
                                validScores.push(score);
                                maxScore = Math.max(maxScore, score);
                            }
                        }
                    }
                    
                    if (maxScore > 0) {
                        maxScores[sheetName][subject] = maxScore;
                        console.log('ê³ 3 ì§ì ‘ ì¶”ì¶œëœ ë§Œì :', sheetName, '"' + subject + '"', '=', maxScore + 'ì ', '(ìœ íš¨ ì ìˆ˜:', validScores.length + 'ê°œ)');
                    } else {
                        console.log('âš ï¸ ìœ íš¨í•œ ì ìˆ˜ ì—†ìŒ:', sheetName, subject);
                    }
                }
                
                console.log(sheetName + ' ì¶”ì¶œ ì™„ë£Œ:', maxScores[sheetName]);
            }
            
            console.log('ê³ 3 ëª¨ë“  ì‹œíŠ¸ ë§Œì  ì¶”ì¶œ ì™„ë£Œ:', maxScores);
        }
        
        function showProgress(show) {
            document.getElementById('progressContainer').style.display = show ? 'block' : 'none';
        }
        
        function updateProgress(percent, message) {
            var progressBar = document.getElementById('progressBar');
            progressBar.style.width = percent + '%';
            progressBar.textContent = message || (percent + '%');
        }
        
        function showStatus(message, type) {
            var statusDiv = document.getElementById('statusMessage');
            statusDiv.textContent = message;
            statusDiv.className = 'status ' + type;
            statusDiv.style.display = 'block';
            
            if (type === 'success') {
                setTimeout(function() {
                    statusDiv.style.display = 'none';
                }, 5000);
            }
        }
        
        function updateDataSummary() {
            var summaryDiv = document.getElementById('dataSummary');
            var gridDiv = document.getElementById('summaryGrid');
            
            var totalStudents = Object.keys(studentByNumber).length;
            var mappingCount = window.attendanceToNameMap ? Object.keys(window.attendanceToNameMap).length : 0;
            var discoveredSheets = window.discoveredTestSheets ? window.discoveredTestSheets.length : 0;
            
            
            var html = '<div class="summary-item"><div class="summary-value">' + mappingCount + '</div><div class="summary-label">ë§¤í•‘ í…Œì´ë¸” í•™ìƒìˆ˜</div></div>';
            html += '<div class="summary-item"><div class="summary-value">' + totalStudents + '</div><div class="summary-label">ì„±ì  ë°ì´í„° í•™ìƒìˆ˜</div></div>';
            html += '<div class="summary-item"><div class="summary-value">' + discoveredSheets + '</div><div class="summary-label">ë°œê²¬ëœ ì‹œíŠ¸ ìˆ˜</div></div>';
            html += '<div class="summary-item"><div class="summary-value">' + gradeCutCount + '</div><div class="summary-label">ë“±ê¸‰ì»· ì‹œí—˜ ìˆ˜</div></div>';
            
            if (githubConfig.username && githubConfig.repo) {
                html += '<div class="summary-item"><div class="summary-value" style="font-size: 0.9em;">' + githubConfig.username + '/' + githubConfig.repo + '</div><div class="summary-label">GitHub ì €ì¥ì†Œ</div></div>';
            }
            
            gridDiv.innerHTML = html;
            summaryDiv.style.display = 'block';
        }
        
        function updateDataStatus(message, isSuccess, lastUpdated) {
            var statusMessage = document.getElementById('dataStatusMessage');
            var noDataDiv = document.getElementById('noData');
            
            if (isSuccess && lastUpdated) {
                var updateDate = new Date(lastUpdated);
                var formattedDate = updateDate.toLocaleDateString('ko-KR') + ' ' + updateDate.toLocaleTimeString('ko-KR', {hour: '2-digit', minute: '2-digit'});
                statusMessage.innerHTML = message + '<br><small style="color: #666;">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ' + formattedDate + '</small>';
                noDataDiv.style.background = '#d4edda';
                noDataDiv.style.color = '#155724';
                noDataDiv.style.border = '1px solid #c3e6cb';
            } else {
                statusMessage.innerHTML = message;
                noDataDiv.style.background = '#f8f9fa';
                noDataDiv.style.color = '#666';
                noDataDiv.style.border = 'none';
            }
        }
        
        function updateStudentTab() {
            var noDataDiv = document.getElementById('noData');
            var searchBtn = document.getElementById('searchBtn');
            
            if (isDataLoaded && Object.keys(studentByNumber).length > 0) {
                searchBtn.disabled = false;
                
                if (githubConfig.username && githubConfig.repo) {
                    var shareableUrl = window.location.origin + window.location.pathname + 
                                     '?username=' + githubConfig.username + '&repo=' + githubConfig.repo;
                    document.getElementById('shareableUrl').textContent = shareableUrl;
                    document.getElementById('urlInfo').style.display = 'block';
                }
            } else {
                searchBtn.disabled = true;
                document.getElementById('urlInfo').style.display = 'none';
            }
        }

        function searchStudent() {
            if (!isDataLoaded) {
                alert('ë°ì´í„°ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return;
            }
            
            var query = document.getElementById('searchInput').value.trim();
            var resultsDiv = document.getElementById('results');
            var noResultsDiv = document.getElementById('noResults');
            var noDataDiv = document.getElementById('noData');
            
            resultsDiv.style.display = 'none';
            noResultsDiv.style.display = 'none';
            noDataDiv.style.display = 'none';
            
            if (!query) {
                alert('ì¶œê²°ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            var student = studentByNumber[query];
            
            if (!student) {
                noResultsDiv.style.display = 'block';
                return;
            }
            
            displayStudentInfo(student);
            generateAIAnalysis(student); // AI ë¶„ì„ ì‹¤í–‰
            displaySummaryTable(student);
            displayGrades(student.grades);
            resultsDiv.style.display = 'block';

           // ë±ƒì§€ íˆ´íŒ ì´ë²¤íŠ¸ë¥¼ ë” ê¸´ ì§€ì—° í›„ ì‹¤í–‰
            setTimeout(addBadgeTooltipEvents, 500);

            // ê·¸ë˜í”„ ìƒì„± (ì•½ê°„ì˜ ì§€ì—° í›„)
            setTimeout(function() {
                createChart(student);
            }, 100);
            
        }

        function displayStudentInfo(student) {
            var studentInfoDiv = document.getElementById('studentInfo');
            var gradeKeys = Object.keys(student.grades);
            var totalTests = window.discoveredTestSheets ? window.discoveredTestSheets.length : 12;
            var attendedTests = gradeKeys.length;
            
            // ì„ íƒê³¼ëª© ì •ë³´ ì¶”ì¶œ
            var subjectTypes = [];
            console.log('=== ì„ íƒê³¼ëª© ì •ë³´ ì¶”ì¶œ ì‹œì‘ ===');
            gradeKeys.forEach(function(testName) {
                var gradeData = student.grades[testName];
                console.log('ì‹œí—˜:', testName, 'ì„ íƒê³¼ëª©:', gradeData.subjectType);
                if (gradeData.subjectType && subjectTypes.indexOf(gradeData.subjectType) === -1) {
                    subjectTypes.push(gradeData.subjectType);
                }
            });
            console.log('ìµœì¢… subjectTypes ë°°ì—´:', subjectTypes);
            
            var subjectTypeDisplay = '';
            if (subjectTypes.length > 0) {
                subjectTypeDisplay = '<div style="display: flex; justify-content: space-between;"><span style="font-weight: 600; color: #555;">ì„ íƒê³¼ëª©:</span><span style="color: #333; font-weight: bold;">' + subjectTypes.join(', ') + '</span></div>';
            }
            
            studentInfoDiv.innerHTML = 
                '<div class="student-info">' +
                '<h2>ğŸ‘¨â€ğŸ“ ' + student.name + ' (ê³ 3)</h2>' +
                '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">' +
                '<div style="display: flex; justify-content: space-between;"><span style="font-weight: 600; color: #555;">ì¶œê²°ë²ˆí˜¸:</span><span style="color: #333; font-weight: bold;">' + student.attendanceNumber + '</span></div>' +
                '<div style="display: flex; justify-content: space-between;"><span style="font-weight: 600; color: #555;">ì‘ì‹œ í˜„í™©:</span><span style="color: #333; font-weight: bold;">' + attendedTests + '/' + totalTests + 'íšŒ</span></div>' +
                subjectTypeDisplay +
                '</div></div>' +
               displayStudyFortune(student.name) +
                displayDashboard(student);
            
                   // ğŸ†• í•™ìŠµ ê³„íšì„œ ì„¹ì…˜ í‘œì‹œ
document.getElementById('studyPlanSection').style.display = 'block';
        }

        function displaySummaryTable(student) {
            var summaryTableDiv = document.getElementById('summaryTable');
            
            var allTests = window.discoveredTestSheets || ['ëª¨í´1íšŒ', 'ëª¨í´2íšŒ', 'ëª¨í´3íšŒ'];
            var totalTests = allTests.length;
            
            var tableHtml = '<div class="summary-table">';
            tableHtml += '<h3>ğŸ“Š ì „ì²´ ì„±ì  í˜„í™© (ê³ 3 - ' + totalTests + 'ê°œ ì‹œí—˜)</h3>';
            tableHtml += '<table class="grade-table">';
            tableHtml += '<thead><tr>';
            tableHtml += '<th class="test-name">ì‹œí—˜</th>';
            tableHtml += '<th>ì„ íƒê³¼ëª©</th>';
            tableHtml += '<th>ì¶œì²˜</th>';
            tableHtml += '</tr></thead><tbody>';
            
            for (var i = 0; i < allTests.length; i++) {
                var testName = allTests[i];
                var gradeData = student.grades[testName];
                
                // ë¯¸ì‘ì‹œí•œ ì‹œí—˜ì€ ê±´ë„ˆë›°ê¸°
                if (!gradeData) continue;
                
                tableHtml += '<tr>';
                tableHtml += '<td class="test-name">' + testName + '</td>';
                
                var subjectTypeClass = (gradeData.subjectType || '').replace(/\s/g, '_');
                tableHtml += '<td class="source-cell"><span class="subject-type ' + subjectTypeClass + '">' + (gradeData.subjectType || '-') + '</span></td>';
                tableHtml += '<td class="grade-cell grade-' + gradeData.grade + '">' + gradeData.grade + '</td>';
                tableHtml += '<td class="score-cell">' + gradeData.score + '</td>';
                tableHtml += '<td class="source-cell">' + (gradeData.source || '-') + '</td>';
                
                tableHtml += '</tr>';
            }
            
            tableHtml += '</tbody></table></div>';
            
            tableHtml += '<div class="summary-table" style="margin-top: 30px;">';
            tableHtml += '<h3>ğŸ“ˆ ê³¼ëª©ë³„ ì„±ì·¨ë„ ë¹„ìœ¨ í˜„í™©</h3>';
            tableHtml += '<div style="overflow-x: auto;">';
            tableHtml += '<table class="grade-table" style="min-width: 1200px; font-size: 0.8em;">';
            tableHtml += '<thead><tr>';
            tableHtml += '<th style="min-width: 80px; font-size: 0.85em;">ì‹œí—˜</th>';
            tableHtml += '<th style="min-width: 80px; font-size: 0.85em;">ì„ íƒê³¼ëª©</th>';
            tableHtml += '<th style="min-width: 50px; font-size: 0.85em;">ë“±ê¸‰</th>';
            tableHtml += '<th style="min-width: 50px; font-size: 0.85em;">ì ìˆ˜</th>';
            tableHtml += '<th style="min-width: 80px; font-size: 0.85em;">ë…ì„œ(ì¸ë¬¸ì´ë¡ )</th>';
            tableHtml += '<th style="min-width: 60px; font-size: 0.85em;">ë…ì„œ(ì‚¬íšŒ)</th>';
            tableHtml += '<th style="min-width: 80px; font-size: 0.85em;">ë…ì„œ(ê³¼í•™)</th>';
            tableHtml += '<th style="min-width: 80px; font-size: 0.85em;">ë¬¸í•™(í˜„ëŒ€ì‹œ)</th>';
            tableHtml += '<th style="min-width: 90px; font-size: 0.85em;">ë¬¸í•™(í˜„ëŒ€ì†Œì„¤)</th>';
            tableHtml += '<th style="min-width: 90px; font-size: 0.85em;">ë¬¸í•™(ê³ ì „ì‹œê°€)</th>';
            tableHtml += '<th style="min-width: 90px; font-size: 0.85em;">ë¬¸í•™(ê³ ì „ì†Œì„¤)</th>';
            tableHtml += '<th style="min-width: 70px; font-size: 0.85em;">ì–¸ì–´í™”ë²•</th>';
            tableHtml += '<th style="min-width: 70px; font-size: 0.85em;">ë§¤ì²´ì‘ë¬¸</th>';
            tableHtml += '<th style="min-width: 70px; font-size: 0.85em;">ì‹œí—˜ì¶œì²˜</th>';
            tableHtml += '</tr></thead><tbody>';
            
            for (var i = 0; i < allTests.length; i++) {
                    var testName = allTests[i];
                    var gradeData = student.grades[testName];
                    
                    // ë¯¸ì‘ì‹œí•œ ì‹œí—˜ì€ ê±´ë„ˆë›°ê¸°
                    if (!gradeData) continue;
                    
                    tableHtml += '<tr>';
                    tableHtml += '<td class="test-name" style="font-size: 0.85em;">' + testName + '</td>';
                    var subjectTypeClass2 = (gradeData.subjectType || '').replace(/\s/g, '_');
                    tableHtml += '<td class="source-cell" style="font-size: 0.8em;"><span class="subject-type ' + subjectTypeClass2 + '">' + (gradeData.subjectType || '-') + '</span></td>';
                    tableHtml += '<td class="grade-cell grade-' + gradeData.grade + '" style="font-size: 0.85em;">' + gradeData.grade + '</td>';
                    tableHtml += '<td class="score-cell" style="font-size: 0.85em;">' + gradeData.score + '</td>';
                    
                    var subjectOrder = ['ë…ì„œ(ì¸ë¬¸ ì´ë¡ )', 'ë…ì„œ(ì‚¬íšŒ)', 'ë…ì„œ(ê³¼í•™)', 
                                       'ë¬¸í•™(í˜„ëŒ€ì‹œ)', 'ë¬¸í•™(í˜„ëŒ€ì†Œì„¤)', 'ë¬¸í•™(ê³ ì „ì‹œê°€)', 'ë¬¸í•™(ê³ ì „ì†Œì„¤)',
                                       'ì–¸ì–´ í™”ë²•', 'ë§¤ì²´ ì‘ë¬¸'];
                    
                    for (var j = 0; j < subjectOrder.length; j++) {
                        var targetSubject = subjectOrder[j];
                        var ratio = 0;
                        
                        // ê³¼ëª©ëª… ë§¤í•‘ í…Œì´ë¸”
                        var subjectMapping = {
                            'ë…ì„œ(ì¸ë¬¸ ì´ë¡ )': ['ë…ì„œ(ì¸ë¬¸ ì´ë¡ )', 'ë…ì„œ(ì¸ë¬¸ì´ë¡ )', 'ë…ì„œì¸ë¬¸', 'ì¸ë¬¸'],
                            'ë…ì„œ(ì‚¬íšŒ)': ['ë…ì„œ(ì‚¬íšŒ)', 'ë…ì„œì‚¬íšŒ', 'ì‚¬íšŒ'],
                            'ë…ì„œ(ê³¼í•™)': ['ë…ì„œ(ê³¼í•™)', 'ë…ì„œê³¼í•™', 'ê³¼í•™'],
                            'ë¬¸í•™(í˜„ëŒ€ì‹œ)': ['ë¬¸í•™(í˜„ëŒ€ì‹œ)', 'ë¬¸í•™í˜„ëŒ€ì‹œ', 'í˜„ëŒ€ì‹œ', 'í˜„ì‹œ'],
                            'ë¬¸í•™(í˜„ëŒ€ì†Œì„¤)': ['ë¬¸í•™(í˜„ëŒ€ì†Œì„¤)', 'ë¬¸í•™í˜„ëŒ€ì†Œì„¤', 'í˜„ëŒ€ì†Œì„¤', 'í˜„ì†Œ'],
                            'ë¬¸í•™(ê³ ì „ì‹œê°€)': ['ë¬¸í•™(ê³ ì „ì‹œê°€)', 'ë¬¸í•™ê³ ì „ì‹œê°€', 'ê³ ì „ì‹œê°€', 'ê³ ì‹œ'],
                            'ë¬¸í•™(ê³ ì „ì†Œì„¤)': ['ë¬¸í•™(ê³ ì „ì†Œì„¤)', 'ë¬¸í•™ê³ ì „ì†Œì„¤', 'ê³ ì „ì†Œì„¤', 'ê³ ì†Œ'],
                            'ì–¸ì–´ í™”ë²•': ['ì–¸ì–´ í™”ë²•', 'ì–¸ì–´í™”ë²•', 'í™”ë²•'],
                            'ë§¤ì²´ ì‘ë¬¸': ['ë§¤ì²´ ì‘ë¬¸', 'ë§¤ì²´ì‘ë¬¸', 'ì‘ë¬¸']
                        };
                        
                        // ë§¤ì¹­ë˜ëŠ” ê³¼ëª© ì°¾ê¸°
                        var possibleNames = subjectMapping[targetSubject] || [targetSubject];
                        
                        for (var actualSubject in gradeData.ratios) {
                            var found = false;
                            
                            // ì •í™•í•œ ë§¤ì¹­ ìš°ì„ 
                            for (var k = 0; k < possibleNames.length; k++) {
                                if (actualSubject === possibleNames[k]) {
                                    ratio = gradeData.ratios[actualSubject] || 0;
                                    found = true;
                                    break;
                                }
                            }
                            
                            // ì •í™•í•œ ë§¤ì¹­ì´ ì—†ìœ¼ë©´ ë¶€ë¶„ ë§¤ì¹­
                            if (!found) {
                                for (var k = 0; k < possibleNames.length; k++) {
                                    if (actualSubject.includes(possibleNames[k]) || possibleNames[k].includes(actualSubject)) {
                                        ratio = gradeData.ratios[actualSubject] || 0;
                                        found = true;
                                        break;
                                    }
                                }
                            }
                            
                            if (found) break;
                        }
                        
                        var ratioColor = ratio >= 90 ? '#e74c3c' : ratio >= 80 ? '#f39c12' : ratio >= 70 ? '#f1c40f' : 
                                        ratio >= 60 ? '#2ecc71' : ratio >= 50 ? '#3498db' : '#95a5a6';
                        var ratioText = ratio > 0 ? ratio + '%' : '-';
                        
                        tableHtml += '<td style="color: ' + ratioColor + '; font-weight: bold; text-align: center; font-size: 0.85em;">' + ratioText + '</td>';
                    }
                    
                    tableHtml += '<td class="source-cell" style="font-size: 0.85em;">' + (gradeData.source || '-') + '</td>';
               tableHtml += '<td class="source-cell" style="font-size: 0.85em;">' + (gradeData.source || '-') + '</td>';
                
                tableHtml += '</tr>';
            }
            
            tableHtml += '</tbody></table></div></div>';
            
            summaryTableDiv.innerHTML = tableHtml;
        }

        function displayGrades(grades) {
            var gradeCardsDiv = document.getElementById('gradeCards');
            gradeCardsDiv.innerHTML = '';
            
            var testNames = Object.keys(grades);
            
            for (var i = 0; i < testNames.length; i++) {
                var testName = testNames[i];
                var gradeData = grades[testName];
                var gradeCard = document.createElement('div');
                gradeCard.className = 'grade-card';
                
                var detailsHtml = '';
                if (gradeData.details) {
                    var detailKeys = Object.keys(gradeData.details);
                    for (var j = 0; j < detailKeys.length; j++) {
                        var subject = detailKeys[j];
                        var score = gradeData.details[subject];
                        var ratio = gradeData.ratios[subject] || 0;
                        var ratioColor = ratio >= 80 ? '#e74c3c' : ratio >= 60 ? '#f39c12' : ratio >= 40 ? '#f1c40f' : '#95a5a6';
                        
                        detailsHtml += 
                        '<div class="grade-item" style="padding: 4px 8px; font-size: 0.8em;">' +
                        '<span class="grade-label" style="font-size: 0.75em;">' + subject + '</span>' +
                        '<span class="grade-value" style="font-size: 0.8em;">' + score + 'ì  ' +
                        '<span style="color: ' + ratioColor + '; font-size: 0.7em;">(' + ratio + '%)</span>' +
                        '</span></div>';
                    }
                }

                                
                var cutInfo = '';
                
                // ì„ íƒê³¼ëª© ì •ë³´ ì¶”ê°€
                if (gradeData.subjectType) {
                    cutInfo += '<div class="grade-summary-item"><div class="grade-summary-value" style="font-size: 0.9em; color: #667eea;">' + gradeData.subjectType + '</div><div class="grade-summary-label">ì„ íƒê³¼ëª©</div></div>';
                }
                
             
            
            var sourceInfo = '';
            if (gradeData.source && gradeData.source.trim() !== '') {
                sourceInfo = '<div class="grade-summary-item"><div class="grade-summary-value" style="font-size: 0.8em; color: #666;">' + gradeData.source + '</div><div class="grade-summary-label" style="font-size: 0.75em;">ì¶œì²˜</div></div>';
            }
                
                gradeCard.innerHTML = 
                '<h3 style="font-size: 1.1em; margin-bottom: 12px;">ğŸ“ ' + testName + '</h3>' +
                '<div class="grade-summary" style="grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap: 8px; margin-bottom: 12px; padding: 10px;">' +
                '<div class="grade-summary-item"><div class="grade-summary-value grade-' + gradeData.grade + '" style="font-size: 1.1em;">' + gradeData.grade + 'ë“±ê¸‰</div><div class="grade-summary-label" style="font-size: 0.75em;">ë‚´ ë“±ê¸‰</div></div>' +
                '<div class="grade-summary-item"><div class="grade-summary-value" style="font-size: 1.1em;">' + gradeData.score + 'ì </div><div class="grade-summary-label" style="font-size: 0.75em;">ë‚´ ì ìˆ˜</div></div>' +
                cutInfo + sourceInfo + '</div>' +
                (detailsHtml ? '<div style="margin: 10px 0; padding: 8px; background: #f8f9fa; border-radius: 6px;"><h4 style="margin-bottom: 8px; color: #333; font-size: 0.85em;">ğŸ“Š ê³¼ëª©ë³„ ì„±ì·¨ë„ (ì ìˆ˜ ë° ë¹„ìœ¨)</h4><div class="grade-details" style="grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 6px;">' + detailsHtml + '</div></div>' : '');
              
                gradeCardsDiv.appendChild(gradeCard);
            }
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.getElementById('searchInput').addEventListener('input', function(e) {
            e.target.value = e.target.value.replace(/[^0-9]/g, '');
            if (e.target.value.length > 4) {
                e.target.value = e.target.value.slice(0, 4);
            }
        });

        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchStudent();
            }
        });

        // ë“±ê¸‰ì»· ì‹œíŠ¸ì—ì„œ ì¶œì²˜ ì •ë³´ ì¶”ì¶œí•˜ëŠ” ìƒˆ í•¨ìˆ˜
                function extractTestSourcesFromGradeCuts(workbook) {
                    var testSources = {};
                    
                    // 3ë²ˆì§¸ ì‹œíŠ¸ì—ì„œ ì¶œì²˜ ì •ë³´ ì¶”ì¶œ
                    var gradeCutSheetName = workbook.SheetNames[2];
                    if (!workbook.Sheets[gradeCutSheetName]) {
                        console.log('ë“±ê¸‰ì»· ì‹œíŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', gradeCutSheetName);
                        return testSources;
                    }
                    
                    var gradeCutSheet = workbook.Sheets[gradeCutSheetName];
                    var gradeCutSheetData = XLSX.utils.sheet_to_json(gradeCutSheet, {header: 1});
                    
                    console.log('ë“±ê¸‰ì»· ì‹œíŠ¸ì—ì„œ ì¶œì²˜ ì •ë³´ ì¶”ì¶œ:', gradeCutSheetName);
                    
                    for (var i = 1; i < gradeCutSheetData.length; i++) {
                        var row = gradeCutSheetData[i];
                        if (!row || !row[0] || !row[1]) continue;
                        
                        var testName = row[0].toString().trim();
                        var source = row[1].toString().trim();
                        
                        var normalizedTestName = testName.replace(/\s/g, '');
                        
                        if (!testSources[normalizedTestName]) {
                            testSources[normalizedTestName] = source;
                            console.log('ì¶œì²˜ ë§¤í•‘:', normalizedTestName, '->', source);
                        }
                    }
                    
                    window.testSources = testSources;
                    console.log('ìµœì¢… ìˆ˜ì§‘ëœ ì‹œí—˜ ì¶œì²˜:', testSources);
                    
                    return testSources;
                }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        window.onload = function() {
            console.log('í˜ì´ì§€ ë¡œë“œ ì‹œì‘');
            
            // URL íŒŒë¼ë¯¸í„°ì—ì„œ ì„¤ì • í™•ì¸
            var urlParams = new URLSearchParams(window.location.search);
            var urlUsername = urlParams.get('username');
            var urlRepo = urlParams.get('repo');
            
            var autoConfig = null;
            
            // URL íŒŒë¼ë¯¸í„°ì—ì„œ ì„¤ì •ì„ ì°¾ì•˜ì„ ë•Œ
            if (urlUsername && urlRepo) {
                console.log('URL íŒŒë¼ë¯¸í„°ì—ì„œ ì„¤ì • ë°œê²¬:', urlUsername, urlRepo);
                autoConfig = {
                    username: urlUsername,
                    repo: urlRepo,
                    token: ''
                };
            } else {
                // GitHub Pages ìë™ ê°ì§€
                var hostname = window.location.hostname;
                var pathname = window.location.pathname;
                
                if (hostname.includes('.github.io')) {
                    var username = hostname.split('.')[0];
                    var repo = pathname.split('/')[1] || 'winter3-data';
                    
                    if (username && repo) {
                        console.log('GitHub Pagesì—ì„œ ìë™ ê°ì§€ëœ ì„¤ì •:', username, repo);
                        autoConfig = {
                            username: username,
                            repo: repo,
                            token: ''
                        };
                    }
                }
            }
            
            // ì €ì¥ëœ GitHub ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
            var savedConfig = localStorage.getItem('winter3-githubConfig');
            var savedDataUrl = localStorage.getItem('winter3-dataUrl');
            
            var finalConfig = null;
            var configSource = '';
            
            if (savedConfig && savedDataUrl) {
                try {
                    finalConfig = JSON.parse(savedConfig);
                    configSource = 'ì €ì¥ëœ ì„¤ì •';
                } catch (error) {
                    console.error('ì €ì¥ëœ ì„¤ì • íŒŒì‹± ì‹¤íŒ¨:', error);
                }
            } else if (autoConfig) {
                finalConfig = autoConfig;
                configSource = 'ìë™ ê°ì§€';
            }
            
            if (finalConfig && finalConfig.username && finalConfig.repo) {
                console.log('ì„¤ì • ì‚¬ìš© (' + configSource + '):', finalConfig);
                
                githubConfig = finalConfig;
                dataUrl = 'https://raw.githubusercontent.com/' + finalConfig.username + '/' + finalConfig.repo + '/main/winter3-data.json';
                
                // localStorageì— ì €ì¥ (ë‹¤ìŒì— ë” ë¹ ë¥´ê²Œ ë¡œë“œí•˜ê¸° ìœ„í•´)
                localStorage.setItem('winter3-githubConfig', JSON.stringify(githubConfig));
                localStorage.setItem('winter3-dataUrl', dataUrl);
                
                console.log('ë°ì´í„° ë¡œë“œ ì‹œì‘...');
                // ì•½ê°„ì˜ ì§€ì—° í›„ ë°ì´í„° ë¡œë“œ ì‹œë„
                setTimeout(function() {
                    loadDataFromGitHub();
                }, 1000);
                
            } else {
                console.log('ì„¤ì •ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                updateDataStatus('GitHub ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤. ê´€ë¦¬ì íƒ­ì—ì„œ ì„¤ì •í•´ì£¼ì„¸ìš”.');
            }
            
            updateStudentTab();
        };


        
    </script>
</body>
</html>
